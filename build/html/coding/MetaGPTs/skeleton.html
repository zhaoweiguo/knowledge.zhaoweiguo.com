

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>å…¥å£ &mdash; æ–°æºª-gordon V1.7.17 æ–‡æ¡£</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
    <link rel="index" title="ç´¢å¼•" href="../genindex.html" />
    <link rel="search" title="æœç´¢" href="../search.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>
  <script src="../_static/js/jquery.min.js"></script>


<!-- è¯„è®ºæ’ä»¶ gittalk start -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> -->
<!-- è¯„è®ºæ’ä»¶ gittalk end -->


</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> æ–°æºª-gordon
          

          
          </a>

          
            
            
              <div class="version">
                V1.7.17
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">å¼€æºä»£ç å­¦ä¹ </span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../open-tracing.html">open-tracing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../open-tracings/01overview.html">ç®€ä»‹</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../MetaGPT.html">MetaGPT</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Llama_index.html">LLamaIndex</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">æ–°æºª-gordon</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>å…¥å£</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/MetaGPTs/skeleton.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            <nav id="local-table-of-contents" role="navigation" aria-labelledby="local-table-of-contents-title">
              <h4 id="local-table-of-contents-title">On This Page</h4>
              <ul>
<li><a class="reference internal" href="#">å…¥å£</a></li>
<li><a class="reference internal" href="#team">Team()</a></li>
<li><a class="reference internal" href="#rolex">Rolex()ç¤ºä¾‹</a><ul>
<li><a class="reference internal" href="#role-set-actions">Role::set_actions</a><ul>
<li><a class="reference internal" href="#actionx">Actionx()ç¤ºä¾‹</a></li>
<li><a class="reference internal" href="#role-init-action">Role::_init_action</a><ul>
<li><a class="reference internal" href="#role-get-prefix">Role::_get_prefix</a></li>
<li><a class="reference internal" href="#action-set-prefix">Action::set_prefix</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#role-watch">Role::_watch</a><ul>
<li><a class="reference internal" href="#id11">Actionx()ç¤ºä¾‹</a></li>
<li><a class="reference internal" href="#id12">Role::_watch</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#team-hire-rolex">Team.hire(Rolexâ€¦)</a><ul>
<li><a class="reference internal" href="#environment-add-roles">Environment.add_roles</a><ul>
<li><a class="reference internal" href="#role-set-env">Role::set_env</a><ul>
<li><a class="reference internal" href="#environment-set-addresses">Environment.set_addresses</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#team-invest-investment">team.invest(investment)</a></li>
<li><a class="reference internal" href="#team-run-project-idea">team.run_project(idea)</a><ul>
<li><a class="reference internal" href="#environment-publish-message">Environment::publish_message</a><ul>
<li><a class="reference internal" href="#util-is-send-to">Util::is_send_to</a></li>
<li><a class="reference internal" href="#role-put-message">Role::put_message</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#team-run">team.run()</a><ul>
<li><a class="reference internal" href="#team-check-balance">Team::_check_balance</a></li>
<li><a class="reference internal" href="#environment-run">Environment::run()</a></li>
<li><a class="reference internal" href="#role-run">Role::run()</a><ul>
<li><a class="reference internal" href="#role-observe">Role::_observe()</a><ul>
<li><a class="reference internal" href="#memory-add-batch">Memory::add_batch</a></li>
</ul>
</li>
<li><a class="reference internal" href="#role-react">Role::react()</a><ul>
<li><a class="reference internal" href="#role-think">Role::_think()</a></li>
<li><a class="reference internal" href="#role-act">Role::_act()</a><ul>
<li><a class="reference internal" href="#rolecontext-history">RoleContext::history()</a></li>
<li><a class="reference internal" href="#action-run">Action::runç¤ºä¾‹</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
  <table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference external" href="/index.html">ä¸»é¡µ</a></p></td>
<td><p><a class="reference internal" href="../genindex.html"><span class="std std-ref">ç´¢å¼•</span></a></p></td>
<td><p><a class="reference internal" href="../py-modindex.html"><span class="std std-ref">æ¨¡å—ç´¢å¼•</span></a></p></td>
<td><p><a class="reference internal" href="../search.html"><span class="std std-ref">æœç´¢é¡µé¢</span></a></p></td>
</tr>
</tbody>
</table>
<section id="id2">
<h1>å…¥å£<a class="headerlink" href="#id2" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h1>
<p>ctx = Context(config=config)
team = Team(context=ctx)
team.hire([Role1(), Role2()]
company.invest(investment)
company.run_project(idea)
asyncio.run(company.run(n_round=n_round))</p>
</section>
<section id="team">
<h1>Team()<a class="headerlink" href="#team" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h1>
<dl class="simple">
<dt>class Team(BaseModel):</dt><dd><p>self.env = Environment(context=ctx)</p>
</dd>
</dl>
</section>
<section id="rolex">
<h1>Rolex()ç¤ºä¾‹<a class="headerlink" href="#rolex" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h1>
<dl>
<dt>class ProductManager(Role):</dt><dd><p>name: str = â€œAliceâ€
profile: str = â€œProduct Managerâ€
goal: str = â€œefficiently create a successful product that meets market demands and user expectationsâ€
constraints: str = â€œutilize the same language as the user requirements for seamless communicationâ€</p>
<dl class="simple">
<dt>def __init__(self, <a href="#id3"><span class="problematic" id="id4">**</span></a>kwargs) -&gt; None:</dt><dd><p>super().__init__(<a href="#id5"><span class="problematic" id="id6">**</span></a>kwargs)
self.set_actions([PrepareDocuments, WritePRD])
self._watch([UserRequirement, PrepareDocuments])
self.todo_action = any_to_name(PrepareDocuments)</p>
</dd>
</dl>
</dd>
<dt>class ProjectManager(Role):</dt><dd><p>name: str = â€œEveâ€
profile: str = â€œProject Managerâ€
goal: str = (</p>
<blockquote>
<div><p>â€œbreak down tasks according to PRD/technical design, generate a task list, and analyze task â€
â€œdependencies to start with the prerequisite modulesâ€</p>
</div></blockquote>
<p>)
constraints: str = â€œuse same language as user requirementâ€</p>
<dl class="simple">
<dt>def __init__(self, <a href="#id7"><span class="problematic" id="id8">**</span></a>kwargs) -&gt; None:</dt><dd><p>self.set_actions([WriteTasks])
self._watch([WriteDesign])</p>
</dd>
</dl>
</dd>
</dl>
<section id="role-set-actions">
<h2>Role::set_actions<a class="headerlink" href="#role-set-actions" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h2>
<dl class="simple">
<dt>class Role(SerializationMixin, ContextMixin, BaseModel):</dt><dd><dl class="simple">
<dt>def set_actions(self, actions: list[Union[Action, Type[Action]]]):  ğŸŸ£</dt><dd><dl class="simple">
<dt>for action in actions:</dt><dd><p>i = action()
self._init_action(i)
self.actions.append(i)
self.states.append(fâ€{len(self.actions) - 1}. {action}â€)</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<section id="actionx">
<h3>Actionx()ç¤ºä¾‹<a class="headerlink" href="#actionx" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h3>
<dl class="simple">
<dt>class WriteTasks(Action):</dt><dd><p>self.name = cls.__name__</p>
</dd>
</dl>
</section>
<section id="role-init-action">
<h3>Role::_init_action<a class="headerlink" href="#role-init-action" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h3>
<dl class="simple">
<dt>class Role(SerializationMixin, ContextMixin, BaseModel):</dt><dd><dl class="simple">
<dt>def _init_action(self, action: Action):</dt><dd><p>action.set_llm(self.llm, override=False)
action.set_prefix(self._get_prefix())</p>
</dd>
</dl>
</dd>
</dl>
<section id="role-get-prefix">
<h4>Role::_get_prefix<a class="headerlink" href="#role-get-prefix" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h4>
<dl>
<dt>class Role(SerializationMixin, ContextMixin, BaseModel):</dt><dd><dl>
<dt>def _get_prefix(self):  ğŸŸ£</dt><dd><dl class="simple">
<dt>if self.desc:</dt><dd><p>return self.desc</p>
</dd>
</dl>
<p>prefix = PREFIX_TEMPLATE.format(<a href="#id9"><span class="problematic" id="id10">**</span></a>{â€œprofileâ€: self.profile, â€œnameâ€: self.name, â€œgoalâ€: self.goal})
â€¦
return prefix</p>
</dd>
</dl>
</dd>
</dl>
</section>
<section id="action-set-prefix">
<h4>Action::set_prefix<a class="headerlink" href="#action-set-prefix" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h4>
<dl>
<dt>class Action(SerializationMixin, ContextMixin, BaseModel):</dt><dd><dl>
<dt>def set_prefix(self, prefix):</dt><dd><p>self.prefix = prefix
self.llm.system_prompt = prefix
if self.node:</p>
<blockquote>
<div><p>self.node.llm = self.llm</p>
</div></blockquote>
<p>return self</p>
</dd>
</dl>
</dd>
</dl>
</section>
</section>
</section>
<section id="role-watch">
<h2>Role::_watch<a class="headerlink" href="#role-watch" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h2>
<p>self._watch([WriteDesign])</p>
<section id="id11">
<h3>Actionx()ç¤ºä¾‹<a class="headerlink" href="#id11" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h3>
<dl class="simple">
<dt>class WriteDesign(Action):</dt><dd><p>self.name = cls.__name__</p>
</dd>
</dl>
</section>
<section id="id12">
<h3>Role::_watch<a class="headerlink" href="#id12" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h3>
<dl class="simple">
<dt>class Role(SerializationMixin, ContextMixin, BaseModel):</dt><dd><dl class="simple">
<dt>def _watch(self, actions: Iterable[Type[Action]] | Iterable[Action]):</dt><dd><p>self.rc.watch = {any_to_str(t) for t in actions}</p>
</dd>
</dl>
</dd>
</dl>
</section>
</section>
</section>
<section id="team-hire-rolex">
<h1>Team.hire(Rolexâ€¦)<a class="headerlink" href="#team-hire-rolex" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h1>
<dl class="simple">
<dt>class Team(BaseModel):</dt><dd><dl class="simple">
<dt>def hire(self, roles: list[Role]):</dt><dd><p>self.env.add_roles(roles)</p>
</dd>
</dl>
</dd>
</dl>
<section id="environment-add-roles">
<h2>Environment.add_roles<a class="headerlink" href="#environment-add-roles" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h2>
<dl>
<dt>class Environment(ExtEnv):</dt><dd><dl>
<dt>def add_roles(self, roles: Iterable[â€œRoleâ€]):</dt><dd><dl>
<dt>for role in roles:</dt><dd><p>self.roles[role.profile] = role</p>
<p>role.context = self.context
role.set_env(self)</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<section id="role-set-env">
<h3>Role::set_env<a class="headerlink" href="#role-set-env" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h3>
<dl>
<dt>class Role(SerializationMixin, ContextMixin, BaseModel):</dt><dd><dl>
<dt>def set_env(self, env: â€œEnvironmentâ€):</dt><dd><p>self.rc.env = env
if env:</p>
<blockquote>
<div><p>env.set_addresses(self, self.addresses)
self.llm.system_prompt = self._get_prefix()  â¬†ï¸
self.llm.cost_manager = self.context.cost_manager
self.set_actions(self.actions)  â¬†ï¸    # reset actions to update llm and prefix</p>
</div></blockquote>
</dd>
</dl>
</dd>
</dl>
<section id="environment-set-addresses">
<h4>Environment.set_addresses<a class="headerlink" href="#environment-set-addresses" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h4>
<dl class="simple">
<dt>class Environment(ExtEnv):</dt><dd><dl class="simple">
<dt>def set_addresses(self, obj, addresses):</dt><dd><p>self.member_addrs[obj] = addresses</p>
</dd>
</dl>
</dd>
</dl>
</section>
</section>
</section>
</section>
<section id="team-invest-investment">
<h1>team.invest(investment)<a class="headerlink" href="#team-invest-investment" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h1>
<dl class="simple">
<dt>class Team(BaseModel):</dt><dd><dl class="simple">
<dt>def invest(self, investment: float):</dt><dd><p>self.investment = investment
self.cost_manager.max_budget = investment</p>
</dd>
</dl>
</dd>
</dl>
</section>
<section id="team-run-project-idea">
<h1>team.run_project(idea)<a class="headerlink" href="#team-run-project-idea" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h1>
<dl>
<dt>class Team(BaseModel):</dt><dd><dl>
<dt>def run_project(self, idea, send_to: str = â€œâ€):</dt><dd><p>self.idea = idea</p>
<dl class="simple">
<dt>self.env.publish_message(</dt><dd><p>Message(role=â€Humanâ€, content=idea, cause_by=UserRequirement, send_to=send_to or MESSAGE_ROUTE_TO_ALL),
peekable=False,</p>
</dd>
</dl>
<p>)</p>
</dd>
</dl>
</dd>
</dl>
<section id="environment-publish-message">
<h2>Environment::publish_message<a class="headerlink" href="#environment-publish-message" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h2>
<dl>
<dt>class Environment(ExtEnv):</dt><dd><dl>
<dt>def publish_message(self, message: Message, peekable: bool = True) -&gt; bool:  ğŸŸ£</dt><dd><dl class="simple">
<dt>for role, addrs in self.member_addrs.items():</dt><dd><dl class="simple">
<dt>if is_send_to(message, addrs):</dt><dd><p>role.put_message(message)</p>
</dd>
</dl>
</dd>
</dl>
<p>self.history += fâ€n{message}â€  # For debug
return True</p>
</dd>
</dl>
</dd>
</dl>
<section id="util-is-send-to">
<h3>Util::is_send_to<a class="headerlink" href="#util-is-send-to" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h3>
<dl>
<dt>def is_send_to(message: â€œMessageâ€, addresses: set):</dt><dd><dl class="simple">
<dt>if MESSAGE_ROUTE_TO_ALL in message.send_to:</dt><dd><p>return True</p>
</dd>
<dt>for i in addresses:</dt><dd><dl class="simple">
<dt>if i in message.send_to:</dt><dd><p>return True</p>
</dd>
</dl>
</dd>
</dl>
<p>return False</p>
</dd>
</dl>
</section>
<section id="role-put-message">
<h3>Role::put_message<a class="headerlink" href="#role-put-message" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h3>
<dl class="simple">
<dt>class Role(SerializationMixin, ContextMixin, BaseModel):</dt><dd><dl class="simple">
<dt>def put_message(self, message):</dt><dd><p>self.rc.msg_buffer.push(message)</p>
</dd>
</dl>
</dd>
</dl>
</section>
</section>
</section>
<section id="team-run">
<h1>team.run()<a class="headerlink" href="#team-run" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h1>
<dl>
<dt>class Team(BaseModel):</dt><dd><dl>
<dt>async def run(self, n_round=3, idea=â€â€, send_to=â€â€, auto_archive=True):</dt><dd><dl class="simple">
<dt>while n_round &gt; 0:</dt><dd><p>n_round -= 1
self._check_balance()
await self.env.run()</p>
</dd>
</dl>
<p>self.env.archive(auto_archive)
return self.env.history</p>
</dd>
</dl>
</dd>
</dl>
<section id="team-check-balance">
<h2>Team::_check_balance<a class="headerlink" href="#team-check-balance" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h2>
<dl class="simple">
<dt>class Team(BaseModel):</dt><dd><dl class="simple">
<dt>def _check_balance(self):</dt><dd><dl class="simple">
<dt>if self.cost_manager.total_cost &gt;= self.cost_manager.max_budget:</dt><dd><p>raise NoMoneyException(self.cost_manager.total_cost, fâ€Insufficient funds: {self.cost_manager.max_budget}â€)</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</section>
<section id="environment-run">
<h2>Environment::run()<a class="headerlink" href="#environment-run" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h2>
<dl>
<dt>class Environment(ExtEnv):</dt><dd><dl>
<dt>async def run(self, k=1):</dt><dd><dl>
<dt>for _ in range(k):</dt><dd><p>futures = []
for role in self.roles.values():</p>
<blockquote>
<div><p>future = role.run()
futures.append(future)</p>
</div></blockquote>
<p>await asyncio.gather(<a href="#id13"><span class="problematic" id="id14">*</span></a>futures)</p>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</section>
<section id="role-run">
<h2>Role::run()<a class="headerlink" href="#role-run" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h2>
<dl class="simple">
<dt>class Role(SerializationMixin, ContextMixin, BaseModel):</dt><dd><dl class="simple">
<dt>async def run(self) -&gt; Message | None:</dt><dd><p>self._observe()
rsp = await self.react()
self.set_todo(None)
self.publish_message(rsp)  â¬†ï¸
return rsp</p>
</dd>
</dl>
</dd>
</dl>
<section id="role-observe">
<h3>Role::_observe()<a class="headerlink" href="#role-observe" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h3>
<dl>
<dt>class Role(SerializationMixin, ContextMixin, BaseModel):</dt><dd><dl>
<dt>async def _observe(self, ignore_memory=False) -&gt; int:</dt><dd><p>news = []
if self.recovered:</p>
<blockquote>
<div><p>news = [self.latest_observed_msg] if self.latest_observed_msg else []</p>
</div></blockquote>
<dl class="simple">
<dt>if not news:</dt><dd><p>news = self.rc.msg_buffer.pop_all()</p>
</dd>
</dl>
<p>old_messages = [] if ignore_memory else self.rc.memory.get()
self.rc.memory.add_batch(news)</p>
<dl class="simple">
<dt>self.rc.news = [</dt><dd><p>n for n in news if (n.cause_by in self.rc.watch or self.name in n.send_to) and n not in old_messages</p>
</dd>
</dl>
<p>]
self.latest_observed_msg = self.rc.news[-1] if self.rc.news else None  # record the latest observed msg</p>
<p>return len(self.rc.news)</p>
</dd>
</dl>
</dd>
</dl>
<section id="memory-add-batch">
<h4>Memory::add_batch<a class="headerlink" href="#memory-add-batch" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h4>
<dl>
<dt>class Memory(BaseModel):</dt><dd><dl>
<dt>def add_batch(self, messages: Iterable[Message]):</dt><dd><dl class="simple">
<dt>for message in messages:</dt><dd><p>self.add(message)</p>
</dd>
</dl>
</dd>
<dt>def add(self, message: Message):  ğŸŸ£</dt><dd><dl class="simple">
<dt>if message in self.storage:</dt><dd><p>return</p>
</dd>
</dl>
<p>self.storage.append(message)
if message.cause_by:</p>
<blockquote>
<div><p>self.index[message.cause_by].append(message)</p>
</div></blockquote>
</dd>
</dl>
</dd>
</dl>
</section>
</section>
<section id="role-react">
<h3>Role::react()<a class="headerlink" href="#role-react" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h3>
<dl class="simple">
<dt>class Role(SerializationMixin, ContextMixin, BaseModel):</dt><dd><dl class="simple">
<dt>async def react(self) -&gt; Message:</dt><dd><p>await self._think()
rsp = await self._act()
actions_taken += 1
self._set_state(state=-1)  # current reaction is complete, reset state to -1 and todo back to None
return rsp</p>
</dd>
</dl>
</dd>
</dl>
<section id="role-think">
<h4>Role::_think()<a class="headerlink" href="#role-think" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h4>
<dl class="simple">
<dt>class Role(SerializationMixin, ContextMixin, BaseModel):</dt><dd><dl class="simple">
<dt>async def _think(self):</dt><dd><p>self.rc.state = i
action = self.actions[i]
action.context = self.context
self.rc.todo = action</p>
</dd>
</dl>
</dd>
</dl>
</section>
<section id="role-act">
<h4>Role::_act()<a class="headerlink" href="#role-act" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h4>
<dl>
<dt>class Role(SerializationMixin, ContextMixin, BaseModel):</dt><dd><dl>
<dt>async def _act(self) -&gt; Message:</dt><dd><p>response = await self.rc.todo.run(self.rc.history)</p>
<dl>
<dt>if isinstance(response, (ActionOutput, ActionNode)):</dt><dd><dl class="simple">
<dt>msg = Message(</dt><dd><p>content=response.content,
instruct_content=response.instruct_content,
role=self._setting,
cause_by=self.rc.todo,   # æ‰§è¡Œçš„Action
sent_from=self,</p>
</dd>
</dl>
<p>)</p>
</dd>
<dt>elif isinstance(response, Message):</dt><dd><p>msg = response</p>
</dd>
<dt>else:</dt><dd><p>msg = Message(content=response or â€œâ€, role=self.profile, cause_by=self.rc.todo, sent_from=self)</p>
</dd>
</dl>
<p>self.rc.memory.add(msg)  â¬†ï¸</p>
<p>return msg</p>
</dd>
</dl>
</dd>
</dl>
<section id="rolecontext-history">
<h5>RoleContext::history()<a class="headerlink" href="#rolecontext-history" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h5>
<dl>
<dt>class RoleContext(BaseModel):</dt><dd><p>&#64;property
def history(self) -&gt; list[Message]:</p>
<blockquote>
<div><p>return self.memory.get()</p>
</div></blockquote>
</dd>
</dl>
</section>
<section id="action-run">
<h5>Action::runç¤ºä¾‹<a class="headerlink" href="#action-run" title="æ­¤æ ‡é¢˜çš„æ°¸ä¹…é“¾æ¥">Â¶</a></h5>
<dl class="simple">
<dt>class ConductResearch(Action):</dt><dd><dl class="simple">
<dt>async def run(self, topic: str, content: str, system_text: str = RESEARCH_BASE_SYSTEM)</dt><dd><p>prompt = CONDUCT_RESEARCH_PROMPT.format(topic=topic, content=content)
self.llm.auto_max_tokens = True
return await self._aask(prompt, [system_text])</p>
</dd>
</dl>
</dd>
</dl>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference external" href="/index.html">ä¸»é¡µ</a></p></td>
<td><p><a class="reference internal" href="../genindex.html"><span class="std std-ref">ç´¢å¼•</span></a></p></td>
<td><p><a class="reference internal" href="../py-modindex.html"><span class="std std-ref">æ¨¡å—ç´¢å¼•</span></a></p></td>
<td><p><a class="reference internal" href="../search.html"><span class="std std-ref">æœç´¢é¡µé¢</span></a></p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
  

  <hr/>
  
  <div id="gitalk-container"></div>
  <div role="contentinfo">
    <p>
        &copy; Copyright 2010-2024, æ–°æºª-gordon.

    </p>
  </div>
  <div>å¤‡æ¡ˆå· <a href="http://www.beian.miit.gov.cn">äº¬ICPå¤‡16018553å·</a></div><div>Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a></div>. 


</footer>

<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?042289284b8eb33866001347a3e0b129";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
</script>     
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'V1.7.17',
            LANGUAGE:'zh-CN',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/sphinx_highlight.js"></script>
      <script type="text/javascript" src="../_static/clipboard.min.js"></script>
      <script type="text/javascript" src="../_static/copybutton.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });


      // var gitalk = new Gitalk({
      //         clientID: '565177626b5d46427009',
      //         clientSecret: 'b2a36e67e1d2a73e43667f46d571c2624f8e1026',
      //         repo: 'knowledge',
      //         owner: 'zhaoweiguo',
      //         admin: ['zhaoweiguo'],
      //         id: location.pathname,      // Ensure uniqueness and length less than 50
      //         distractionFreeMode: false  // Facebook-like distraction free mode
      //       })
      // gitalk.render('gitalk-container')

  </script>


<script type="text/javascript" src="../_static/js/table-of-contents-sidebar.js"></script>
<!-- <script type="text/javascript" src="https://table-of-contents-sidebar.github.io/table-of-contents-sidebar-lib/table-of-contents-sidebar.js"></script> -->
<script type="text/javascript">
    window.onload = function(e){
        TableOfContents.init({
            basePath: "https://table-of-contents-sidebar.github.io/table-of-contents-sidebar-lib/",
            querySelector: "body" // or other css querySelector
        });
    }
</script> 

</body>
</html>