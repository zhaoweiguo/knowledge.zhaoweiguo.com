

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>


<!-- start added 2025-04-14   增加对markdown中公式的支持 -->
<script>
window.MathJax = {
    tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true
    },
    options: {
        ignoreHtmlClass: "tex2jax_ignore|mathjax_ignore",
        processHtmlClass: "tex2jax_process|mathjax_process|math|output_area"
    }
};
</script>
<script defer="defer" src="https://fastly.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<!-- end added 2025-04-14   增加对markdown中公式的支持 -->


  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.3.1. Golang 规范 &mdash; 新溪-gordon V2025.07 文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="2.3.2. PHP规范" href="php.html" />
    <link rel="prev" title="2.3. 语言相关" href="../lang.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>
  <script src="../../_static/js/jquery.min.js"></script>


<!-- 评论插件 gittalk start -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> -->
<!-- 评论插件 gittalk end -->


</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> 新溪-gordon
          

          
          </a>

          
            
            
              <div class="version">
                V2025.07
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../normal.html">1. 基本</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../normals/rdf.html">1.1. 知识图谱相关-RDF</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../standard.html">2. 规范</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../normal.html">2.1. 常用</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../normals/0normal.html">2.1.1. 常用</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/opensource.html">2.1.2. 开源规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/document.html">2.1.3. 文档规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/version.html">2.1.4. 版本规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/commit.html">2.1.5. Commit 规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/deploy.html">2.1.6. 发布规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/catalog.html">2.1.7. 目录结构规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/code.html">2.1.8. 代码规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/api.html">2.1.9. 接口规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/log.html">2.1.10. 日志规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/error-code.html">2.1.11. 错误码规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/rd-process.html">2.1.12. 研发流程</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/design-method.html">2.1.13. 设计方法</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/work-flow.html">2.1.14. 工作流规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/sdk.html">2.1.15. SDK 规范</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Semantic-Versioning.html">2.2. Semantic Versioning</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../lang.html">2.3. 语言相关</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.3.1. Golang 规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="php.html">2.3.2. PHP规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="erlang.html">2.3.3. Erlang规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="db.html">2.3.4. DB规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="android.html">2.3.5. Android规范</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../collect.html">3. 收集</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../collects/opensource.html">3.1. 开源项目</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/golang.html">3.1.1. Golang开源项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/node.html">3.1.2. Node开源项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/python.html">3.1.3. Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/rust.html">3.1.4. Rust开源项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/ui.html">3.1.5. UI开源项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/algorithm.html">3.1.6. 算法</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/course.html">3.1.7. 课程</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/book.html">3.1.8. 开源书籍</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/awesome.html">3.1.9. awesome</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/data_analysis.html">3.1.10. 数据分析</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/wiki.html">3.2. 名词 wiki</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/event.html">3.3. 事件</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../collects/events/2021.html">3.3.1. 2021年</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/events/2022.html">3.3.2. 2022年</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/common-sense.html">3.4. 常识</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/other.html">3.5. 常用</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/fame.html">3.5.1. 著名人物</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/fames/author.html">作者</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/fames/opensource.html">开源大佬</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/fames/quote.html">名言</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/fames/tmp.html">临时</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/corp.html">3.5.2. 公司</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/hashicorp.html">hashicorp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/STMicroelectronics.html">意法半导体</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/Tensilica.html">Tensilica</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/Marvell.html">Marvell迈威科技集团有限公司</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/%E5%BE%B7%E5%B7%9E%E4%BB%AA%E5%99%A8.html">德州仪器(TI)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/tmp.html">tmp</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/meeting.html">3.5.3. 会议</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/keyword.html">3.5.4. 关键词</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/website.html">3.5.5. 好的网站</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/concept.html">3.5.6. 定义</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E5%85%83%E7%BC%96%E7%A8%8B.html">元编程(Metaprogramming)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E5%8D%AB%E8%AF%AD%E5%8F%A5.html">卫语句</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E4%B9%92%E4%B9%93%E6%93%8D%E4%BD%9C.html">乒乓操作</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E5%9C%88%E5%A4%8D%E6%9D%82%E5%BA%A6.html">圈复杂度</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E4%BB%A3%E7%A0%81%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90.html">代码静态分析</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E4%BB%A3%E7%A0%81%E8%B5%B0%E6%9F%A5.html">代码走查</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/NP.html">NP非确定性多项式时间</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/fun.html">3.6. 娱乐</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/%E7%B4%A0%E6%9D%90.html">3.7. 素材</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../timeline.html">4. 时间线</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/normal.html">4.1. 常用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/architecture.html">4.2. 软件架构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/consensus.html">4.3. 共识相关</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/protocol.html">4.4. 协议相关</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/IoT.html">4.5. IoT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/AI.html">4.6. AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/blockchain.html">4.7. 区块链</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/robot.html">4.8. 机器人</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/security.html">4.9. 安全事件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/finance.html">4.10. 融资相关</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/politics.html">4.11. 政治</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/other.html">4.12. 其他</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">5. 技术路线图</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/normal.html">5.1. 常用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/normal.html#technology-roadmap">5.2. 技术路线图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/AI.html">5.3. AI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../roadmaps/AIs/knowledge-map.html">5.3.1. <strong>AI知识图谱</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/blockchain.html">5.4. 区块链</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/golang.html">5.5. Golang 路线图</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../roadmaps/golangs/knowledge-map.html">5.5.1. <strong>Golang知识图谱</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../skill.html">6. 技巧</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../difference.html">7. 区分</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">新溪-gordon</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../standard.html"><span class="section-number">2. </span>规范</a> &raquo;</li>
        
          <li><a href="../lang.html"><span class="section-number">2.3. </span>语言相关</a> &raquo;</li>
        
      <li><span class="section-number">2.3.1. </span>Golang 规范</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/stardards/langs/golang.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            <nav id="local-table-of-contents" role="navigation" aria-labelledby="local-table-of-contents-title">
              <h4 id="local-table-of-contents-title">On This Page</h4>
              <ul>
<li><a class="reference internal" href="#">2.3.1. Golang 规范</a><ul>
<li><a class="reference internal" href="#id2">1. 代码风格</a><ul>
<li><a class="reference internal" href="#id3">1.1 代码格式</a></li>
<li><a class="reference internal" href="#id4">1.2 声明、初始化和定义</a></li>
<li><a class="reference internal" href="#id5">1.3 错误处理</a></li>
<li><a class="reference internal" href="#panic">1.4 panic 处理</a></li>
<li><a class="reference internal" href="#id6">1.5 单元测试</a></li>
<li><a class="reference internal" href="#id7">1.6 类型断言失败处理</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id8">2. 命名规范</a><ul>
<li><a class="reference internal" href="#id9">2.1 包命名</a></li>
<li><a class="reference internal" href="#id10">2.2 函数命名</a></li>
<li><a class="reference internal" href="#id11">2.3 文件命名</a></li>
<li><a class="reference internal" href="#id12">2.4 结构体命名</a></li>
<li><a class="reference internal" href="#id13">2.5 接口命名</a></li>
<li><a class="reference internal" href="#id14">2.6 变量命名</a></li>
<li><a class="reference internal" href="#id15">2.7 常量命名</a></li>
<li><a class="reference internal" href="#error">2.8 Error 的命名</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id16">3. 注释规范</a><ul>
<li><a class="reference internal" href="#id17">3.1 包注释</a></li>
<li><a class="reference internal" href="#id18">3.2 变量 / 常量注释</a></li>
<li><a class="reference internal" href="#id19">3.3 结构体注释</a></li>
<li><a class="reference internal" href="#id20">3.4 方法注释</a></li>
<li><a class="reference internal" href="#id21">3.5 类型注释</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id22">4. 类型</a><ul>
<li><a class="reference internal" href="#id23">4.1 字符串</a></li>
<li><a class="reference internal" href="#id24">4.2 切片</a></li>
<li><a class="reference internal" href="#id25">4.3 结构体</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id26">5. 控制结构</a><ul>
<li><a class="reference internal" href="#if">5.1 if</a></li>
<li><a class="reference internal" href="#for">5.2 for</a></li>
<li><a class="reference internal" href="#range">5.3 range</a></li>
<li><a class="reference internal" href="#switch">5.4 switch</a></li>
<li><a class="reference internal" href="#goto">5.5 goto</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id27">6. 函数</a><ul>
<li><a class="reference internal" href="#id28">6.1 函数参数</a></li>
<li><a class="reference internal" href="#defer">6.2 defer</a></li>
<li><a class="reference internal" href="#id29">6.3 方法的接收器</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id30">6.4 嵌套</a></li>
<li><a class="reference internal" href="#id31">6.5 变量命名</a></li>
<li><a class="reference internal" href="#gopath">7. GOPATH 设置规范</a></li>
<li><a class="reference internal" href="#id32">8. 依赖管理</a></li>
<li><a class="reference internal" href="#id33">9. 最佳实践</a><ul>
<li><a class="reference internal" href="#id34">9.1 性能</a></li>
<li><a class="reference internal" href="#id35">9.2 注意事项</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
  <table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference external" href="/index.html">主页</a></p></td>
<td><p><a class="reference internal" href="../../genindex.html"><span class="std std-ref">索引</span></a></p></td>
<td><p><a class="reference internal" href="../../py-modindex.html"><span class="std std-ref">模块索引</span></a></p></td>
<td><p><a class="reference internal" href="../../search.html"><span class="std std-ref">搜索页面</span></a></p></td>
</tr>
</tbody>
</table>
<section id="golang">
<h1><span class="section-number">2.3.1. </span>Golang 规范<a class="headerlink" href="#golang" title="此标题的永久链接">¶</a></h1>
<section id="id2">
<h2>1. 代码风格<a class="headerlink" href="#id2" title="此标题的永久链接">¶</a></h2>
<section id="id3">
<h3>1.1 代码格式<a class="headerlink" href="#id3" title="此标题的永久链接">¶</a></h3>
<ul>
<li><p>代码都必须用 gofmt 进行格式化。</p></li>
<li><p>运算符和操作数之间要留空格。</p></li>
<li><p>建议一行代码不超过 120 个字符:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>超过部分，请采用合适的换行方式换行。
但也有些例外场景，例如 import 行、工具自动生成的代码、带 tag 的 struct 字段。
</pre></div>
</div>
</li>
<li><p>文件长度不能超过 800 行。</p></li>
<li><p>函数长度不能超过 80 行。</p></li>
</ul>
<p>import 规范:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. 代码都必须用 goimports 进行格式化
    建议将代码 Go 代码编辑器设置为：保存时运行 goimports
2. 不要使用相对路径引入包
    例如 import ../util/net
3. 包名称与导入路径的最后一个目录名不匹配时，或者多个相同包名冲突时，则必须使用导入别名。
    // bad
    &quot;github.com/dgrijalva/jwt-go/v4&quot;
    //good
    jwt &quot;github.com/dgrijalva/jwt-go/v4&quot;
4. 导入的包建议进行分组，匿名包的引用使用一个新的分组，并对匿名包引用进行说明。
    import (
      //go 标准包
      &quot;fmt&quot;
      // 第三方包
        &quot;github.com/jinzhu/gorm&quot;
        &quot;github.com/spf13/cobra&quot;
        &quot;github.com/spf13/viper&quot;
      // 匿名包单独分组，并对匿名包引用进行说明
        // import mysql driver
        _ &quot;github.com/jinzhu/gorm/dialects/mysql&quot;
      // 内部包
        v1 &quot;github.com/marmotedu/api/apiserver/v1&quot;
        metav1 &quot;github.com/marmotedu/apimachinery/pkg/meta/v1&quot;
        &quot;github.com/marmotedu/iam/pkg/cli/genericclioptions&quot;
    )
</pre></div>
</div>
</section>
<section id="id4">
<h3>1.2 声明、初始化和定义<a class="headerlink" href="#id4" title="此标题的永久链接">¶</a></h3>
<p>在函数外部声明必须使用 var ，不要采用 := ，容易踩到变量的作用域的问题:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="p">(</span>
  <span class="n">Width</span>  <span class="nb">int</span>
  <span class="n">Height</span> <span class="nb">int</span>
<span class="p">)</span>
</pre></div>
</div>
<p>在初始化结构引用时，请使用 &amp;T {} 代替 new (T)，以使其与结构体初始化一致:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="n">sptr</span> <span class="o">:=</span> <span class="n">new</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">sptr</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;bar&quot;</span>
<span class="o">//</span> <span class="n">good</span>
<span class="n">sptr</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">T</span><span class="p">{</span><span class="n">Name</span><span class="p">:</span> <span class="s2">&quot;bar&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>struct 声明和初始化格式采用多行，定义如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">User</span> <span class="n">struct</span><span class="p">{</span>
    <span class="n">Username</span>  <span class="n">string</span>
    <span class="n">Email</span>     <span class="n">string</span>
<span class="p">}</span>
<span class="n">user</span> <span class="o">:=</span> <span class="n">User</span><span class="p">{</span>
  <span class="n">Username</span><span class="p">:</span> <span class="s2">&quot;colin&quot;</span><span class="p">,</span>
  <span class="n">Email</span><span class="p">:</span> <span class="s2">&quot;colin404@foxmail.com&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>相似的声明放在一组，同样适用于常量、变量和类型声明:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="kn">import</span><span class="w"> </span><span class="s2">&quot;a&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="s2">&quot;b&quot;</span>
<span class="o">//</span> <span class="n">good</span>
<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
  <span class="s2">&quot;a&quot;</span>
  <span class="s2">&quot;b&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>尽可能指定容器容量，以便为容器预先分配内存，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">v</span> <span class="o">:=</span> <span class="n">make</span><span class="p">(</span><span class="nb">map</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="n">string</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">v</span> <span class="o">:=</span> <span class="n">make</span><span class="p">([]</span><span class="n">string</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>在顶层，使用标准 var 关键字。请勿指定类型，除非它与表达式的类型不同:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// bad
var _s string = F()
func F() string { return &quot;A&quot; }
// good
var _s = F()
// 由于 F 已经明确了返回一个字符串类型，因此我们没有必要显式指定_s 的类型
// 还是那种类型
func F() string { return &quot;A&quot; }
</pre></div>
</div>
<p>对于未导出的顶层常量和变量，使用 _ 作为前缀:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="n">const</span> <span class="p">(</span>
  <span class="n">defaultHost</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
  <span class="n">defaultPort</span> <span class="o">=</span> <span class="mi">8080</span>
<span class="p">)</span>
<span class="o">//</span> <span class="n">good</span>
<span class="n">const</span> <span class="p">(</span>
  <span class="n">_defaultHost</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
  <span class="n">_defaultPort</span> <span class="o">=</span> <span class="mi">8080</span>
<span class="p">)</span>
</pre></div>
</div>
<p>嵌入式类型（例如 mutex）应位于结构体内的字段列表的顶部，并且必须有一个空行将嵌入式字段与常规字段分隔开:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="nb">type</span> <span class="n">Client</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">version</span> <span class="nb">int</span>
  <span class="n">http</span><span class="o">.</span><span class="n">Client</span>
<span class="p">}</span>
<span class="o">//</span> <span class="n">good</span>
<span class="nb">type</span> <span class="n">Client</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">http</span><span class="o">.</span><span class="n">Client</span>
  <span class="n">version</span> <span class="nb">int</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id5">
<h3>1.3 错误处理<a class="headerlink" href="#id5" title="此标题的永久链接">¶</a></h3>
<p>error 作为函数的值返回，必须对 error 进行处理，或将返回值赋值给明确忽略:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">load</span><span class="p">()</span> <span class="n">error</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">bad</span>
<span class="n">load</span><span class="p">()</span>
<span class="o">//</span> <span class="n">good</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">load</span><span class="p">()</span>
</pre></div>
</div>
<p>error 作为函数的值返回且有多个返回值的时候，error 必须是最后一个参数:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="n">func</span> <span class="n">load</span><span class="p">()</span> <span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
<span class="p">}</span>
<span class="o">//</span> <span class="n">good</span>
<span class="n">func</span> <span class="n">load</span><span class="p">()</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
<span class="p">}</span>
</pre></div>
</div>
<p>尽早进行错误处理，并尽早返回，减少嵌套:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">error</span> <span class="n">code</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">good</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">error</span> <span class="n">handling</span>
  <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>
<span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
</pre></div>
</div>
<p>如果需要在 if 之外使用函数调用的结果，则应采用下面的方式:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="k">if</span> <span class="n">v</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">foo</span><span class="p">();</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">error</span> <span class="n">handling</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">good</span>
<span class="n">v</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">foo</span><span class="p">()</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">error</span> <span class="n">handling</span>
<span class="p">}</span>
</pre></div>
</div>
<p>错误要单独判断，不与其他逻辑组合判断:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="n">v</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">foo</span><span class="p">()</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="o">||</span> <span class="n">v</span>  <span class="o">==</span> <span class="n">nil</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">error</span> <span class="n">handling</span>
  <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">good</span>
<span class="n">v</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">foo</span><span class="p">()</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">error</span> <span class="n">handling</span>
  <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>
<span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">nil</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">error</span> <span class="n">handling</span>
  <span class="k">return</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s2">&quot;invalid value v&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>如果返回值需要初始化，则采用下面的方式:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">v</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">f</span><span class="p">()</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">error</span> <span class="n">handling</span>
    <span class="k">return</span> <span class="o">//</span> <span class="ow">or</span> <span class="k">continue</span><span class="o">.</span>
<span class="p">}</span>
<span class="o">//</span> <span class="n">use</span> <span class="n">v</span>
</pre></div>
</div>
<p>错误描述建议:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. 告诉用户他们可以做什么，而不是告诉他们不能做什么。
2. 当声明一个需求时，用 must 而不是 should
    例如，must be greater than 0、must match regex &#39;[a-z]+&#39;。
3. 当声明一个格式不对时，用 must not
    例如，must not contain。
4. 当声明一个动作时用 may not
    例如，may not be specified when otherField is empty、only name may be specified。

5. 引用文字字符串值时，请在单引号中指示文字。
    例如，must not contain &#39;..&#39;。
6. 当引用另一个字段名称时，请在反引号中指定该名称。
    例如，must be greater than `request`
7. 指定不等时，请使用单词而不是符号。
    例如，must be less than 256、must be greater than or equal to 0
    (不要用 larger than、bigger than、more than、higher than)。

8. 指定数字范围时，请尽可能使用包含范围。
9. 建议 Go 1.13 以上，error 生成方式为 fmt.Errorf(&quot;module xxx: %w&quot;, err)。
10. 错误描述用小写字母开头，结尾不要加标点符号，例如：
  // bad
  errors.New(&quot;Redis connection failed&quot;)
  errors.New(&quot;redis connection failed.&quot;)
  // good
  errors.New(&quot;redis connection failed&quot;)
</pre></div>
</div>
</section>
<section id="panic">
<h3>1.4 panic 处理<a class="headerlink" href="#panic" title="此标题的永久链接">¶</a></h3>
<ul>
<li><p>在业务逻辑处理中禁止使用 panic。</p></li>
<li><p>在 main 包中，只有当程序完全不可运行时使用 panic:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>例如无法打开文件、无法连接数据库导致程序无法正常运行。
</pre></div>
</div>
</li>
<li><p>在 main 包中，使用 log.Fatal 来记录错误:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>这样就可以由 log 来结束程序，或者将 panic 抛出的异常记录到日志文件中，方便排查问题。
</pre></div>
</div>
</li>
<li><p>可导出的接口一定不能有 panic。</p></li>
<li><p>包内建议采用 error 而不是 panic 来传递错误。</p></li>
</ul>
</section>
<section id="id6">
<h3>1.5 单元测试<a class="headerlink" href="#id6" title="此标题的永久链接">¶</a></h3>
<ul class="simple">
<li><p>单元测试文件名命名规范为 example_test.go。</p></li>
<li><p>每个重要的可导出函数都要编写测试用例。</p></li>
<li><p>因为单元测试文件内的函数都是不对外的，所以可导出的结构体、函数等可以不带注释。</p></li>
<li><p>如果存在 func (b *Bar) Foo ，单测函数可以为 func TestBar_Foo</p></li>
</ul>
</section>
<section id="id7">
<h3>1.6 类型断言失败处理<a class="headerlink" href="#id7" title="此标题的永久链接">¶</a></h3>
<p>type assertion 的单个返回值针对不正确的类型将产生 panic。请始终使用 “comma ok” 的惯用法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// bad
t := n.(int)

// good
t, ok := n.(int)
if !ok {
  // error handling
}
// normal code
</pre></div>
</div>
</section>
</section>
<section id="id8">
<h2>2. 命名规范<a class="headerlink" href="#id8" title="此标题的永久链接">¶</a></h2>
<p>命名规范是代码规范中非常重要的一部分，一个统一的、短小的、精确的命名规范可以大大提高代码的可读性，也可以借此规避一些不必要的 Bug。</p>
<section id="id9">
<h3>2.1 包命名<a class="headerlink" href="#id9" title="此标题的永久链接">¶</a></h3>
<ul class="simple">
<li><p>包名必须和目录名一致，尽量采取有意义、简短的包名，不要和标准库冲突</p></li>
<li><p>包名全部小写，没有大写或下划线，使用多级目录来划分层级</p></li>
<li><p>项目名可以通过中划线来连接多个单词</p></li>
<li><p>包名以及包所在的目录名，不要使用复数，例如，是 net/utl，而不是 net/urls</p></li>
<li><p>不要用 common、util、shared 或者 lib 这类宽泛的、无意义的包名</p></li>
<li><p>包名要简单明了，例如 net、time、log</p></li>
</ul>
</section>
<section id="id10">
<h3>2.2 函数命名<a class="headerlink" href="#id10" title="此标题的永久链接">¶</a></h3>
<ul class="simple">
<li><p>函数名采用驼峰式，首字母根据访问控制决定使用大写或小写，例如：MixedCaps 或者 mixedCaps。</p></li>
<li><p>代码生成工具自动生成的代码 (如 xxxx.pb.go) 和为了对相关测试用例进行分组，而采用的下划线 (如 TestMyFunction_WhatIsBeingTested) 排除此规则。</p></li>
</ul>
</section>
<section id="id11">
<h3>2.3 文件命名<a class="headerlink" href="#id11" title="此标题的永久链接">¶</a></h3>
<ul class="simple">
<li><p>文件名要简短有意义。</p></li>
<li><p>文件名应小写，并使用下划线分割单词。</p></li>
</ul>
</section>
<section id="id12">
<h3>2.4 结构体命名<a class="headerlink" href="#id12" title="此标题的永久链接">¶</a></h3>
<ul>
<li><p>采用驼峰命名方式，首字母根据访问控制决定使用大写或小写，例如 MixedCaps 或者 mixedCaps。</p></li>
<li><p>结构体名不应该是动词，应该是名词，比如 Node、NodeSpec。</p></li>
<li><p>避免使用 Data、Info 这类无意义的结构体名。</p></li>
<li><p>结构体的声明和初始化应采用多行，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">User</span> <span class="n">多行声明</span>
<span class="nb">type</span> <span class="n">User</span> <span class="n">struct</span> <span class="p">{</span>
    <span class="n">Name</span>  <span class="n">string</span>
    <span class="n">Email</span> <span class="n">string</span>
<span class="p">}</span>
<span class="o">//</span> <span class="n">多行初始化</span>
<span class="n">u</span> <span class="o">:=</span> <span class="n">User</span><span class="p">{</span>
    <span class="n">UserName</span><span class="p">:</span> <span class="s2">&quot;colin&quot;</span><span class="p">,</span>
    <span class="n">Email</span><span class="p">:</span>    <span class="s2">&quot;colin404@foxmail.com&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id13">
<h3>2.5 接口命名<a class="headerlink" href="#id13" title="此标题的永久链接">¶</a></h3>
<p>接口命名的规则，基本和结构体命名规则保持一致：</p>
<ul class="simple">
<li><p>单个函数的接口名以 “er”” 作为后缀（例如 Reader，Writer），有时候可能导致蹩脚的英文，但是没关系。</p></li>
<li><p>两个函数的接口名以两个函数名命名，例如 ReadWriter。</p></li>
<li><p>三个以上函数的接口名，类似于结构体名。</p></li>
</ul>
<p>例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Seeking</span> <span class="n">to</span> <span class="n">an</span> <span class="n">offset</span> <span class="n">before</span> <span class="n">the</span> <span class="n">start</span> <span class="n">of</span> <span class="n">the</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">an</span> <span class="n">error</span><span class="o">.</span>
<span class="o">//</span> <span class="n">Seeking</span> <span class="n">to</span> <span class="nb">any</span> <span class="n">positive</span> <span class="n">offset</span> <span class="ow">is</span> <span class="n">legal</span><span class="p">,</span> <span class="n">but</span> <span class="n">the</span> <span class="n">behavior</span> <span class="n">of</span> <span class="n">subsequent</span>
<span class="o">//</span> <span class="n">I</span><span class="o">/</span><span class="n">O</span> <span class="n">operations</span> <span class="n">on</span> <span class="n">the</span> <span class="n">underlying</span> <span class="nb">object</span> <span class="ow">is</span> <span class="n">implementation</span><span class="o">-</span><span class="n">dependent</span><span class="o">.</span>
<span class="nb">type</span> <span class="n">Seeker</span> <span class="n">interface</span> <span class="p">{</span>
    <span class="n">Seek</span><span class="p">(</span><span class="n">offset</span> <span class="n">int64</span><span class="p">,</span> <span class="n">whence</span> <span class="nb">int</span><span class="p">)</span> <span class="p">(</span><span class="n">int64</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<span class="p">}</span>
<span class="o">//</span> <span class="n">ReadWriter</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">interface</span> <span class="n">that</span> <span class="n">groups</span> <span class="n">the</span> <span class="n">basic</span> <span class="n">Read</span> <span class="ow">and</span> <span class="n">Write</span> <span class="n">methods</span><span class="o">.</span>
<span class="nb">type</span> <span class="n">ReadWriter</span> <span class="n">interface</span> <span class="p">{</span>
    <span class="n">Reader</span>
    <span class="n">Writer</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id14">
<h3>2.6 变量命名<a class="headerlink" href="#id14" title="此标题的永久链接">¶</a></h3>
<ul>
<li><p>变量名必须遵循驼峰式，首字母根据访问控制决定使用大写或小写。</p></li>
<li><p>在相对简单（对象数量少、针对性强）的环境中，可以将一些名称由完整单词简写为单个字母:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="n">可以简写为</span> <span class="n">u</span>
<span class="n">userID</span> <span class="n">可以简写</span> <span class="n">uid</span>
</pre></div>
</div>
</li>
<li><p>特有名词时，需要遵循以下规则:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>如果变量为私有，且特有名词为首个单词，则使用小写，如 apiClient。
其他情况都应当使用该名词原有的写法，如 APIClient、repoID、UserID。
</pre></div>
</div>
</li>
</ul>
<p>下面列举了一些常见的特有名词:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">A</span> <span class="n">GonicMapper</span> <span class="n">that</span> <span class="n">contains</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">common</span> <span class="n">initialisms</span> <span class="n">taken</span> <span class="kn">from</span><span class="w"> </span><span class="nn">golang</span><span class="o">/</span><span class="n">lint</span>
<span class="n">var</span> <span class="n">LintGonicMapper</span> <span class="o">=</span> <span class="n">GonicMapper</span><span class="p">{</span>
    <span class="s2">&quot;API&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;ASCII&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;CPU&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;CSS&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;DNS&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;EOF&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;GUID&quot;</span><span class="p">:</span>  <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;HTML&quot;</span><span class="p">:</span>  <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;HTTP&quot;</span><span class="p">:</span>  <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;HTTPS&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;ID&quot;</span><span class="p">:</span>    <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;IP&quot;</span><span class="p">:</span>    <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;JSON&quot;</span><span class="p">:</span>  <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;LHS&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;QPS&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;RAM&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;RHS&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;RPC&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;SLA&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;SMTP&quot;</span><span class="p">:</span>  <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;SSH&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;TLS&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;TTL&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;UI&quot;</span><span class="p">:</span>    <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;UID&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;UUID&quot;</span><span class="p">:</span>  <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;URI&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;URL&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;UTF8&quot;</span><span class="p">:</span>  <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;VM&quot;</span><span class="p">:</span>    <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;XML&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;XSRF&quot;</span><span class="p">:</span>  <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;XSS&quot;</span><span class="p">:</span>   <span class="n">true</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>若变量类型为 bool 类型，则名称应以 Has，Is，Can 或 Allow 开头，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">hasConflict</span> <span class="nb">bool</span>
<span class="n">var</span> <span class="n">isExist</span> <span class="nb">bool</span>
<span class="n">var</span> <span class="n">canManage</span> <span class="nb">bool</span>
<span class="n">var</span> <span class="n">allowGitHook</span> <span class="nb">bool</span>
</pre></div>
</div>
<ul class="simple">
<li><p>局部变量应当尽可能短小，比如使用 buf 指代 buffer，使用 i 指代 index。</p></li>
<li><p>代码生成工具自动生成的代码可排除此规则 (如 xxx.pb.go 里面的 Id)</p></li>
</ul>
</section>
<section id="id15">
<h3>2.7 常量命名<a class="headerlink" href="#id15" title="此标题的永久链接">¶</a></h3>
<ul>
<li><p>常量名必须遵循驼峰式，首字母根据访问控制决定使用大写或小写。</p></li>
<li><p>如果是枚举类型的常量，需要先创建相应类型:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Code</span> <span class="n">defines</span> <span class="n">an</span> <span class="n">error</span> <span class="n">code</span> <span class="nb">type</span><span class="o">.</span>
<span class="nb">type</span> <span class="n">Code</span> <span class="nb">int</span>
<span class="o">//</span> <span class="n">Internal</span> <span class="n">errors</span><span class="o">.</span>
<span class="n">const</span> <span class="p">(</span>
    <span class="o">//</span> <span class="n">ErrUnknown</span> <span class="o">-</span> <span class="mi">0</span><span class="p">:</span> <span class="n">An</span> <span class="n">unknown</span> <span class="n">error</span> <span class="n">occurred</span><span class="o">.</span>
    <span class="n">ErrUnknown</span> <span class="n">Code</span> <span class="o">=</span> <span class="n">iota</span>
    <span class="o">//</span> <span class="n">ErrFatal</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span> <span class="n">An</span> <span class="n">fatal</span> <span class="n">error</span> <span class="n">occurred</span><span class="o">.</span>
    <span class="n">ErrFatal</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="error">
<h3>2.8 Error 的命名<a class="headerlink" href="#error" title="此标题的永久链接">¶</a></h3>
<p>Error 类型应该写成 FooError 的形式:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">ExitError</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="o">//</span> <span class="o">....</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Error 变量写成 ErrFoo 的形式:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">ErrFormat</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s2">&quot;unknown format&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="id16">
<h2>3. 注释规范<a class="headerlink" href="#id16" title="此标题的永久链接">¶</a></h2>
<ul>
<li><p>每个可导出的名字都要有注释，该注释对导出的变量、函数、结构体、接口等进行简要介绍。</p></li>
<li><p>全部使用单行注释，禁止使用多行注释。</p></li>
<li><p>和代码的规范一样，单行注释不要过长，禁止超过 120 字符，超过的请使用换行展示，尽量保持格式优雅。</p></li>
<li><p>注释必须是完整的句子，以需要注释的内容作为开头，句点作为结尾，格式为 // 名称 描述.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="o">//</span> <span class="n">logs</span> <span class="n">the</span> <span class="n">flags</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">flagset</span><span class="o">.</span>
<span class="n">func</span> <span class="n">PrintFlags</span><span class="p">(</span><span class="n">flags</span> <span class="o">*</span><span class="n">pflag</span><span class="o">.</span><span class="n">FlagSet</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">good</span>
<span class="o">//</span> <span class="n">PrintFlags</span> <span class="n">logs</span> <span class="n">the</span> <span class="n">flags</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">flagset</span><span class="o">.</span>
<span class="n">func</span> <span class="n">PrintFlags</span><span class="p">(</span><span class="n">flags</span> <span class="o">*</span><span class="n">pflag</span><span class="o">.</span><span class="n">FlagSet</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>所有注释掉的代码在提交 code review 前都应该被删除，否则应该说明为什么不删除，并给出后续处理建议。</p></li>
<li><p>在多段注释之间可以使用空行分隔加以区分，如下所示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Package</span> <span class="n">superman</span> <span class="n">implements</span> <span class="n">methods</span> <span class="k">for</span> <span class="n">saving</span> <span class="n">the</span> <span class="n">world</span><span class="o">.</span>
<span class="o">//</span>
<span class="o">//</span> <span class="n">Experience</span> <span class="n">has</span> <span class="n">shown</span> <span class="n">that</span> <span class="n">a</span> <span class="n">small</span> <span class="n">number</span> <span class="n">of</span> <span class="n">procedures</span> <span class="n">can</span> <span class="n">prove</span>
<span class="o">//</span> <span class="n">helpful</span> <span class="n">when</span> <span class="n">attempting</span> <span class="n">to</span> <span class="n">save</span> <span class="n">the</span> <span class="n">world</span><span class="o">.</span>
<span class="n">package</span> <span class="n">superman</span>
</pre></div>
</div>
</li>
</ul>
<section id="id17">
<h3>3.1 包注释<a class="headerlink" href="#id17" title="此标题的永久链接">¶</a></h3>
<ul>
<li><p>每个包都有且仅有一个包级别的注释。</p></li>
<li><p>包注释统一用 // 进行注释，格式为 // Package 包名 包描述 ，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Package</span> <span class="n">genericclioptions</span> <span class="n">contains</span> <span class="n">flags</span> <span class="n">which</span> <span class="n">can</span> <span class="n">be</span> <span class="n">added</span> <span class="n">to</span> <span class="n">you</span> <span class="n">command</span><span class="p">,</span> <span class="n">bound</span><span class="p">,</span> <span class="n">completed</span><span class="p">,</span> <span class="ow">and</span> <span class="n">produce</span>
<span class="o">//</span> <span class="n">useful</span> <span class="n">helper</span> <span class="n">functions</span><span class="o">.</span>
<span class="n">package</span> <span class="n">genericclioptions</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id18">
<h3>3.2 变量 / 常量注释<a class="headerlink" href="#id18" title="此标题的永久链接">¶</a></h3>
<p>每个可导出的变量 / 常量都必须有注释说明，格式为 // 变量名 变量描述，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">ErrSigningMethod</span> <span class="n">defines</span> <span class="n">invalid</span> <span class="n">signing</span> <span class="n">method</span> <span class="n">error</span><span class="o">.</span>
<span class="n">var</span> <span class="n">ErrSigningMethod</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s2">&quot;Invalid signing method&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>出现大块常量或变量定义时，可在前面注释一个总的说明，然后在每一行常量的前一行或末尾详细注释该常量的定义，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// Code must start with 1xxxxx.
const (
    // ErrSuccess - 200: OK.
    ErrSuccess int = iota + 100001

    // ErrUnknown - 500: Internal server error.
    ErrUnknown
    // ErrBind - 400: Error occurred while binding the request body to the struct.
    ErrBind

    // ErrValidation - 400: Validation failed.
    ErrValidation
）
</pre></div>
</div>
</section>
<section id="id19">
<h3>3.3 结构体注释<a class="headerlink" href="#id19" title="此标题的永久链接">¶</a></h3>
<ul>
<li><p>每个需要导出的结构体或者接口都必须有注释说明，格式为 // 结构体名 结构体描述.。</p></li>
<li><p>结构体内的可导出成员变量名，如果意义不明确，必须要给出注释，放在成员变量的前一行或同一行的末尾。例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// User represents a user restful resource. It is also used as gorm model.
type User struct {
    // Standard object&#39;s metadata.
    metav1.ObjectMeta `json:&quot;metadata,omitempty&quot;`
    Nickname string `json:&quot;nickname&quot; gorm:&quot;column:nickname&quot;`
    Password string `json:&quot;password&quot; gorm:&quot;column:password&quot;`
    Email    string `json:&quot;email&quot; gorm:&quot;column:email&quot;`
    Phone    string `json:&quot;phone&quot; gorm:&quot;column:phone&quot;`
    IsAdmin  int    `json:&quot;isAdmin,omitempty&quot; gorm:&quot;column:isAdmin&quot;`
}
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id20">
<h3>3.4 方法注释<a class="headerlink" href="#id20" title="此标题的永久链接">¶</a></h3>
<p>每个需要导出的函数或者方法都必须有注释，格式为 // 函数名 函数描述.，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">BeforeUpdate</span> <span class="n">run</span> <span class="n">before</span> <span class="n">update</span> <span class="n">database</span> <span class="n">record</span><span class="o">.</span>
<span class="n">func</span> <span class="p">(</span><span class="n">p</span> <span class="o">*</span><span class="n">Policy</span><span class="p">)</span> <span class="n">BeforeUpdate</span><span class="p">()</span> <span class="p">(</span><span class="n">err</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
  <span class="k">return</span> <span class="n">nil</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id21">
<h3>3.5 类型注释<a class="headerlink" href="#id21" title="此标题的永久链接">¶</a></h3>
<p>每个需要导出的类型定义和类型别名都必须有注释说明，格式为 // 类型名 类型描述. ，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Code</span> <span class="n">defines</span> <span class="n">an</span> <span class="n">error</span> <span class="n">code</span> <span class="nb">type</span><span class="o">.</span>
<span class="nb">type</span> <span class="n">Code</span> <span class="nb">int</span>
</pre></div>
</div>
</section>
</section>
<section id="id22">
<h2>4. 类型<a class="headerlink" href="#id22" title="此标题的永久链接">¶</a></h2>
<section id="id23">
<h3>4.1 字符串<a class="headerlink" href="#id23" title="此标题的永久链接">¶</a></h3>
<p>空字符串判断:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
<span class="p">}</span>
<span class="o">//</span> <span class="n">good</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
<span class="p">}</span>
</pre></div>
</div>
<p>[] byte/string 相等比较:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">s1</span> <span class="p">[]</span><span class="n">byte</span>
<span class="n">var</span> <span class="n">s2</span> <span class="p">[]</span><span class="n">byte</span>

<span class="o">//</span> <span class="n">bad</span>
<span class="o">...</span>
<span class="nb">bytes</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
<span class="nb">bytes</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>

<span class="o">//</span> <span class="n">good</span>
<span class="o">...</span>
<span class="nb">bytes</span><span class="o">.</span><span class="n">Compare</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
<span class="nb">bytes</span><span class="o">.</span><span class="n">Compare</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>字符串是否包含子串或字符:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="n">strings</span><span class="o">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">subStr</span><span class="p">)</span>
<span class="n">strings</span><span class="o">.</span><span class="n">ContainsAny</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span>
<span class="n">strings</span><span class="o">.</span><span class="n">ContainRune</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<span class="o">//</span> <span class="n">good</span>
<span class="n">strings</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">subStr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">strings</span><span class="o">.</span><span class="n">IndexAny</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">char</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">strings</span><span class="o">.</span><span class="n">IndexRune</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
<p>去除前后子串:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="n">var</span> <span class="n">s1</span> <span class="o">=</span> <span class="s2">&quot;a string value&quot;</span>
<span class="n">var</span> <span class="n">s2</span> <span class="o">=</span> <span class="s2">&quot;a &quot;</span>
<span class="n">var</span> <span class="n">s3</span> <span class="o">=</span> <span class="n">strings</span><span class="o">.</span><span class="n">TrimPrefix</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span>
<span class="o">//</span> <span class="n">good</span>
<span class="n">var</span> <span class="n">s1</span> <span class="o">=</span> <span class="s2">&quot;a string value&quot;</span>
<span class="n">var</span> <span class="n">s2</span> <span class="o">=</span> <span class="s2">&quot;a &quot;</span>
<span class="n">var</span> <span class="n">s3</span> <span class="n">string</span>
<span class="k">if</span> <span class="n">strings</span><span class="o">.</span><span class="n">HasPrefix</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">s2</span><span class="p">):]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>复杂字符串使用 raw 字符串避免字符转义:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// bad
regexp.MustCompile(&quot;\\.&quot;)
// good
regexp.MustCompile(`\.`)
</pre></div>
</div>
</section>
<section id="id24">
<h3>4.2 切片<a class="headerlink" href="#id24" title="此标题的永久链接">¶</a></h3>
<p>空 slice 判断:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">slice</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
<span class="p">}</span>
<span class="o">//</span> <span class="n">good</span>
<span class="k">if</span> <span class="nb">slice</span> <span class="o">!=</span> <span class="n">nil</span> <span class="o">&amp;&amp;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">slice</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>上面判断同样适用于 map、channel。</p>
</div>
<p>声明 slice:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="n">s</span> <span class="o">:=</span> <span class="p">[]</span><span class="n">string</span><span class="p">{}</span>
<span class="n">s</span> <span class="o">:=</span> <span class="n">make</span><span class="p">([]</span><span class="n">string</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="o">//</span> <span class="n">good</span>
<span class="n">var</span> <span class="n">s</span> <span class="p">[]</span><span class="n">string</span>
</pre></div>
</div>
<p>slice 复制:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="n">var</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="p">[]</span><span class="n">byte</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="o">:=</span> <span class="nb">range</span> <span class="n">b1</span> <span class="p">{</span>
   <span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="p">}</span>
<span class="ow">or</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="nb">range</span> <span class="n">b1</span> <span class="p">{</span>
   <span class="n">b2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">b1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">good</span>
<span class="n">copy</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
</pre></div>
</div>
<p>slice 新增:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="n">var</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">[]</span><span class="nb">int</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="o">:=</span> <span class="nb">range</span> <span class="n">a</span> <span class="p">{</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">good</span>
<span class="n">var</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="p">[]</span><span class="nb">int</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id25">
<h3>4.3 结构体<a class="headerlink" href="#id25" title="此标题的永久链接">¶</a></h3>
<p>struct 以多行格式初始化:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">user</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">Id</span>   <span class="n">int64</span>
  <span class="n">Name</span> <span class="n">string</span>
<span class="p">}</span>
<span class="n">u1</span> <span class="o">:=</span> <span class="n">user</span><span class="p">{</span><span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;Colin&quot;</span><span class="p">}</span>
<span class="n">u2</span> <span class="o">:=</span> <span class="n">user</span><span class="p">{</span>
    <span class="n">Id</span><span class="p">:</span>   <span class="mi">200</span><span class="p">,</span>
    <span class="n">Name</span><span class="p">:</span> <span class="s2">&quot;Lex&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="id26">
<h2>5. 控制结构<a class="headerlink" href="#id26" title="此标题的永久链接">¶</a></h2>
<section id="if">
<h3>5.1 if<a class="headerlink" href="#if" title="此标题的永久链接">¶</a></h3>
<p>if 接受初始化语句，约定如下方式建立局部变量:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">loadConfig</span><span class="p">();</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">error</span> <span class="n">handling</span>
  <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>
</pre></div>
</div>
<p>if 对于 bool 类型的变量，应直接进行真假判断:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">isAllow</span> <span class="nb">bool</span>
<span class="k">if</span> <span class="n">isAllow</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="for">
<h3>5.2 for<a class="headerlink" href="#for" title="此标题的永久链接">¶</a></h3>
<p>采用短声明建立局部变量:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">sum</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
    <span class="nb">sum</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
<p>不要在 for 循环里面使用 defer，defer 只有在函数退出时才会执行:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">bad</span>
<span class="k">for</span> <span class="n">file</span> <span class="o">:=</span> <span class="nb">range</span> <span class="n">files</span> <span class="p">{</span>
  <span class="n">fd</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
  <span class="p">}</span>
  <span class="n">defer</span> <span class="n">fd</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
  <span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">good</span>
<span class="k">for</span> <span class="n">file</span> <span class="o">:=</span> <span class="nb">range</span> <span class="n">files</span> <span class="p">{</span>
  <span class="n">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">fd</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">os</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">err</span>
    <span class="p">}</span>
    <span class="n">defer</span> <span class="n">fd</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
    <span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
  <span class="p">}()</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="range">
<h3>5.3 range<a class="headerlink" href="#range" title="此标题的永久链接">¶</a></h3>
<p>如果只需要第一项（key），就丢弃第二个:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">key</span> <span class="o">:=</span> <span class="nb">range</span> <span class="n">keys</span> <span class="p">{</span>
<span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
<span class="p">}</span>
</pre></div>
</div>
<p>如果只需要第二项，则把第一项置为下划线:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">sum</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">value</span> <span class="o">:=</span> <span class="nb">range</span> <span class="n">array</span> <span class="p">{</span>
    <span class="nb">sum</span> <span class="o">+=</span> <span class="n">value</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="switch">
<h3>5.4 switch<a class="headerlink" href="#switch" title="此标题的永久链接">¶</a></h3>
<p>必须要有 default:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">switch</span> <span class="n">os</span> <span class="o">:=</span> <span class="n">runtime</span><span class="o">.</span><span class="n">GOOS</span><span class="p">;</span> <span class="n">os</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s2">&quot;linux&quot;</span><span class="p">:</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;Linux.&quot;</span><span class="p">)</span>
    <span class="k">case</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s2">&quot;OS X.&quot;</span><span class="p">)</span>
    <span class="n">default</span><span class="p">:</span>
        <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">os</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="goto">
<h3>5.5 goto<a class="headerlink" href="#goto" title="此标题的永久链接">¶</a></h3>
<ul class="simple">
<li><p>业务代码禁止使用 goto 。</p></li>
<li><p>框架或其他底层源码尽量不用。</p></li>
</ul>
</section>
</section>
<section id="id27">
<h2>6. 函数<a class="headerlink" href="#id27" title="此标题的永久链接">¶</a></h2>
<ul class="simple">
<li><p>传入变量和返回变量以小写字母开头。</p></li>
<li><p>函数参数个数不能超过 5 个。</p></li>
<li><p>函数分组与顺序</p></li>
<li><p>函数应按粗略的调用顺序排序。</p></li>
<li><p>同一文件中的函数应按接收者分组。</p></li>
<li><p>尽量采用值传递，而非指针传递。</p></li>
<li><p>传入参数是 map、slice、chan、interface ，不要传递指针。</p></li>
</ul>
<section id="id28">
<h3>6.1 函数参数<a class="headerlink" href="#id28" title="此标题的永久链接">¶</a></h3>
<p>如果函数返回相同类型的两个或三个参数，或者如果从上下文中不清楚结果的含义，使用命名返回，其他情况不建议使用命名返回，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">coordinate</span><span class="p">()</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="n">float64</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">normal</span> <span class="n">code</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>传入变量和返回变量都以小写字母开头。</p></li>
<li><p>尽量用值传递，非指针传递。</p></li>
<li><p>参数数量均不能超过 5 个。</p></li>
<li><p>多返回值最多返回三个，超过三个请使用 struct。</p></li>
</ul>
</section>
<section id="defer">
<h3>6.2 defer<a class="headerlink" href="#defer" title="此标题的永久链接">¶</a></h3>
<ul>
<li><p>当存在资源创建时，应紧跟 defer 释放资源 (可以大胆使用 defer，defer 在 Go1.14 版本中，性能大幅提升，defer 的性能损耗即使在性能敏感型的业务中，也可以忽略)。</p></li>
<li><p>先判断是否错误，再 defer 释放资源，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rep</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">http</span><span class="o">.</span><span class="n">Get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>
<span class="n">defer</span> <span class="n">resp</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id29">
<h3>6.3 方法的接收器<a class="headerlink" href="#id29" title="此标题的永久链接">¶</a></h3>
<ul class="simple">
<li><p>推荐以类名第一个英文首字母的小写作为接收器的命名。</p></li>
<li><p>接收器的命名在函数超过 20 行的时候不要用单字符。</p></li>
<li><p>接收器的命名不能采用 me、this、self 这类易混淆名称。</p></li>
</ul>
</section>
</section>
<section id="id30">
<h2>6.4 嵌套<a class="headerlink" href="#id30" title="此标题的永久链接">¶</a></h2>
<ul class="simple">
<li><p>嵌套深度不能超过 4 层。</p></li>
</ul>
</section>
<section id="id31">
<h2>6.5 变量命名<a class="headerlink" href="#id31" title="此标题的永久链接">¶</a></h2>
<ul>
<li><p>变量声明尽量放在变量第一次使用的前面，遵循就近原则。</p></li>
<li><p>如果魔法数字出现超过两次，则禁止使用，改用一个常量代替，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">PI</span> <span class="o">...</span>
<span class="n">const</span> <span class="n">Prise</span> <span class="o">=</span> <span class="mf">3.14</span>
<span class="n">func</span> <span class="n">getAppleCost</span><span class="p">(</span><span class="n">n</span> <span class="n">float64</span><span class="p">)</span> <span class="n">float64</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">Prise</span> <span class="o">*</span> <span class="n">n</span>
<span class="p">}</span>
<span class="n">func</span> <span class="n">getOrangeCost</span><span class="p">(</span><span class="n">n</span> <span class="n">float64</span><span class="p">)</span> <span class="n">float64</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">Prise</span> <span class="o">*</span> <span class="n">n</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="gopath">
<h2>7. GOPATH 设置规范<a class="headerlink" href="#gopath" title="此标题的永久链接">¶</a></h2>
<ul class="simple">
<li><p>Go 1.11 之后，弱化了 GOPATH 规则，已有代码（很多库肯定是在 1.11 之前建立的）肯定符合这个规则，建议保留 GOPATH 规则，便于维护代码。</p></li>
<li><p>建议只使用一个 GOPATH，不建议使用多个 GOPATH。如果使用多个 GOPATH，编译生效的 bin 目录是在第一个 GOPATH 下。</p></li>
</ul>
</section>
<section id="id32">
<h2>8. 依赖管理<a class="headerlink" href="#id32" title="此标题的永久链接">¶</a></h2>
<ul class="simple">
<li><p>Go 1.11 以上必须使用 Go Modules。</p></li>
<li><p>使用 Go Modules 作为依赖管理的项目时，不建议提交 vendor 目录。</p></li>
<li><p>使用 Go Modules 作为依赖管理的项目时，必须提交 go.sum 文件。</p></li>
</ul>
</section>
<section id="id33">
<h2>9. 最佳实践<a class="headerlink" href="#id33" title="此标题的永久链接">¶</a></h2>
<ul>
<li><p>尽量少用全局变量，而是通过参数传递，使每个函数都是 “无状态” 的。这样可以减少耦合，也方便分工和单元测试。</p></li>
<li><p>在编译时验证接口的符合性，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">LogHandler</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">h</span>   <span class="n">http</span><span class="o">.</span><span class="n">Handler</span>
  <span class="n">log</span> <span class="o">*</span><span class="n">zap</span><span class="o">.</span><span class="n">Logger</span>
<span class="p">}</span>
<span class="n">var</span> <span class="n">_</span> <span class="n">http</span><span class="o">.</span><span class="n">Handler</span> <span class="o">=</span> <span class="n">LogHandler</span><span class="p">{}</span>
</pre></div>
</div>
</li>
<li><p>服务器处理请求时，应该创建一个 context，保存该请求的相关信息（如 requestID），并在函数调用链中传递。</p></li>
</ul>
<section id="id34">
<h3>9.1 性能<a class="headerlink" href="#id34" title="此标题的永久链接">¶</a></h3>
<ul class="simple">
<li><p>string 表示的是不可变的字符串变量，对 string 的修改是比较重的操作，基本上都需要重新申请内存。所以，如果没有特殊需要，需要修改时多使用 [] byte。</p></li>
<li><p>优先使用 strconv 而不是 fmt。</p></li>
</ul>
</section>
<section id="id35">
<h3>9.2 注意事项<a class="headerlink" href="#id35" title="此标题的永久链接">¶</a></h3>
<ul class="simple">
<li><p>append 要小心自动分配内存，append 返回的可能是新分配的地址。</p></li>
<li><p>如果要直接修改 map 的 value 值，则 value 只能是指针，否则要覆盖原来的值。</p></li>
<li><p>map 在并发中需要加锁。</p></li>
<li><p>编译过程无法检查 interface {} 的转换，只能在运行时检查，小心引起 panic。</p></li>
</ul>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference external" href="/index.html">主页</a></p></td>
<td><p><a class="reference internal" href="../../genindex.html"><span class="std std-ref">索引</span></a></p></td>
<td><p><a class="reference internal" href="../../py-modindex.html"><span class="std std-ref">模块索引</span></a></p></td>
<td><p><a class="reference internal" href="../../search.html"><span class="std std-ref">搜索页面</span></a></p></td>
</tr>
</tbody>
</table>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="php.html" class="btn btn-neutral float-right" title="2.3.2. PHP规范" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../lang.html" class="btn btn-neutral" title="2.3. 语言相关" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>
  
  <div id="gitalk-container"></div>
  <div role="contentinfo">
    <p>
        &copy; Copyright 2010-2025, 新溪-gordon.

    </p>
  </div>
  <div>备案号 <a href="http://www.beian.miit.gov.cn">京ICP备16018553号</a></div><div>Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a></div>. 


</footer>

<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?042289284b8eb33866001347a3e0b129";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
</script>     
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'V2025.07',
            LANGUAGE:'zh-CN',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/sphinx_highlight.js"></script>
      <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="../../_static/translations.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });


      // var gitalk = new Gitalk({
      //         clientID: '565177626b5d46427009',
      //         clientSecret: 'b2a36e67e1d2a73e43667f46d571c2624f8e1026',
      //         repo: 'knowledge',
      //         owner: 'zhaoweiguo',
      //         admin: ['zhaoweiguo'],
      //         id: location.pathname,      // Ensure uniqueness and length less than 50
      //         distractionFreeMode: false  // Facebook-like distraction free mode
      //       })
      // gitalk.render('gitalk-container')

  </script>


<script type="text/javascript" src="../../_static/js/table-of-contents-sidebar.js"></script>
<!-- <script type="text/javascript" src="https://table-of-contents-sidebar.github.io/table-of-contents-sidebar-lib/table-of-contents-sidebar.js"></script> -->
<script type="text/javascript">
    window.onload = function(e){
        TableOfContents.init({
            basePath: "https://table-of-contents-sidebar.github.io/table-of-contents-sidebar-lib/",
            querySelector: "body" // or other css querySelector
        });
    }
</script> 

</body>
</html>