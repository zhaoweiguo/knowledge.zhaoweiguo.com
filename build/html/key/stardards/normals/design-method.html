

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>


<!-- start added 2025-04-14   增加对markdown中公式的支持 -->
<script>
window.MathJax = {
    tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true
    },
    options: {
        ignoreHtmlClass: "tex2jax_ignore|mathjax_ignore",
        processHtmlClass: "tex2jax_process|mathjax_process|math|output_area"
    }
};
</script>
<script defer="defer" src="https://fastly.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<!-- end added 2025-04-14   增加对markdown中公式的支持 -->


<!-- start added 2025-08-06   增加对mermaid图的支持 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    mermaid.initialize({
        startOnLoad: true,
        theme: 'default',
        flowchart: { useMaxWidth: true }
    });
});
</script>
<!--  end added 2025-08-06   增加对mermaid图的支持 -->




  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.1.13. 设计方法 &mdash; 新溪-gordon V2025.09 文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="2.1.14. 工作流规范" href="work-flow.html" />
    <link rel="prev" title="2.1.12. 研发流程" href="rd-process.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>
  <script src="../../_static/js/jquery.min.js"></script>


<!-- 评论插件 gittalk start -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> -->
<!-- 评论插件 gittalk end -->


</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> 新溪-gordon
          

          
          </a>

          
            
            
              <div class="version">
                V2025.09
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../normal.html">1. 基本</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../normals/rdf.html">1.1. 知识图谱相关-RDF</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../standard.html">2. 规范</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../normal.html">2.1. 常用</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="0normal.html">2.1.1. 常用</a></li>
<li class="toctree-l3"><a class="reference internal" href="opensource.html">2.1.2. 开源规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="document.html">2.1.3. 文档规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="version.html">2.1.4. 版本规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="commit.html">2.1.5. Commit 规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="deploy.html">2.1.6. 发布规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="catalog.html">2.1.7. 目录结构规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="code.html">2.1.8. 代码规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html">2.1.9. 接口规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="log.html">2.1.10. 日志规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="error-code.html">2.1.11. 错误码规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="rd-process.html">2.1.12. 研发流程</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.1.13. 设计方法</a></li>
<li class="toctree-l3"><a class="reference internal" href="work-flow.html">2.1.14. 工作流规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="sdk.html">2.1.15. SDK 规范</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Semantic-Versioning.html">2.2. Semantic Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lang.html">2.3. 语言相关</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../langs/golang.html">2.3.1. Golang 规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../langs/php.html">2.3.2. PHP规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../langs/erlang.html">2.3.3. Erlang规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../langs/db.html">2.3.4. DB规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../langs/android.html">2.3.5. Android规范</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../collect.html">3. 收集</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../collects/opensource.html">3.1. 开源项目</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/golang.html">3.1.1. Golang开源项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/node.html">3.1.2. Node开源项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/python.html">3.1.3. Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/rust.html">3.1.4. Rust开源项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/ui.html">3.1.5. UI开源项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/algorithm.html">3.1.6. 算法</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/course.html">3.1.7. 课程</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/book.html">3.1.8. 开源书籍</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/awesome.html">3.1.9. awesome</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/data_analysis.html">3.1.10. 数据分析</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/wiki.html">3.2. 名词 wiki</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/event.html">3.3. 事件</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../collects/events/2021.html">3.3.1. 2021年</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/events/2022.html">3.3.2. 2022年</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/common-sense.html">3.4. 常识</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/other.html">3.5. 常用</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/fame.html">3.5.1. 著名人物</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/fames/author.html">作者</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/fames/opensource.html">开源大佬</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/fames/quote.html">名言</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/fames/tmp.html">临时</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/corp.html">3.5.2. 公司</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/hashicorp.html">hashicorp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/STMicroelectronics.html">意法半导体</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/Tensilica.html">Tensilica</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/Marvell.html">Marvell迈威科技集团有限公司</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/%E5%BE%B7%E5%B7%9E%E4%BB%AA%E5%99%A8.html">德州仪器(TI)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/tmp.html">tmp</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/meeting.html">3.5.3. 会议</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/keyword.html">3.5.4. 关键词</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/website.html">3.5.5. 好的网站</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/concept.html">3.5.6. 定义</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E5%85%83%E7%BC%96%E7%A8%8B.html">元编程(Metaprogramming)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E5%8D%AB%E8%AF%AD%E5%8F%A5.html">卫语句</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E4%B9%92%E4%B9%93%E6%93%8D%E4%BD%9C.html">乒乓操作</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E5%9C%88%E5%A4%8D%E6%9D%82%E5%BA%A6.html">圈复杂度</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E4%BB%A3%E7%A0%81%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90.html">代码静态分析</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E4%BB%A3%E7%A0%81%E8%B5%B0%E6%9F%A5.html">代码走查</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/NP.html">NP非确定性多项式时间</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/fun.html">3.6. 娱乐</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/%E7%B4%A0%E6%9D%90.html">3.7. 素材</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../timeline.html">4. 时间线</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/normal.html">4.1. 常用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/architecture.html">4.2. 软件架构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/consensus.html">4.3. 共识相关</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/protocol.html">4.4. 协议相关</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/IoT.html">4.5. IoT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/AI.html">4.6. AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/blockchain.html">4.7. 区块链</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/robot.html">4.8. 机器人</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/security.html">4.9. 安全事件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/finance.html">4.10. 融资相关</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/politics.html">4.11. 政治</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/other.html">4.12. 其他</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">5. 技术路线图</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/normal.html">5.1. 常用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/normal.html#technology-roadmap">5.2. 技术路线图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/AI.html">5.3. AI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../roadmaps/AIs/knowledge-map.html">5.3.1. <strong>AI知识图谱</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/blockchain.html">5.4. 区块链</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/golang.html">5.5. Golang 路线图</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../roadmaps/golangs/knowledge-map.html">5.5.1. <strong>Golang知识图谱</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../skill.html">6. 技巧</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../difference.html">7. 区分</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">新溪-gordon</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../standard.html"><span class="section-number">2. </span>规范</a> &raquo;</li>
        
          <li><a href="../normal.html"><span class="section-number">2.1. </span>常用</a> &raquo;</li>
        
      <li><span class="section-number">2.1.13. </span>设计方法</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/stardards/normals/design-method.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            <nav id="local-table-of-contents" role="navigation" aria-labelledby="local-table-of-contents-title">
              <h4 id="local-table-of-contents-title">On This Page</h4>
              <ul>
<li><a class="reference internal" href="#">2.1.13. 设计方法</a><ul>
<li><a class="reference internal" href="#id3">1. 代码结构</a></li>
<li><a class="reference internal" href="#id4">2. 代码规范</a></li>
<li><a class="reference internal" href="#id5">3. 代码质量</a><ul>
<li><a class="reference internal" href="#id6">示例</a></li>
<li><a class="reference internal" href="#id7">工具</a></li>
<li><a class="reference internal" href="#id8">单元测试覆盖率</a></li>
<li><a class="reference internal" href="#code-review">Code Review</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id9">4. 编程哲学</a></li>
<li><a class="reference internal" href="#id10">5. 软件设计方法</a></li>
</ul>
</li>
</ul>

            </nav>
  <table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference external" href="/index.html">主页</a></p></td>
<td><p><a class="reference internal" href="../../genindex.html"><span class="std std-ref">索引</span></a></p></td>
<td><p><a class="reference internal" href="../../py-modindex.html"><span class="std std-ref">模块索引</span></a></p></td>
<td><p><a class="reference internal" href="../../search.html"><span class="std std-ref">搜索页面</span></a></p></td>
</tr>
</tbody>
</table>
<section id="id2">
<h1><span class="section-number">2.1.13. </span>设计方法<a class="headerlink" href="#id2" title="此标题的永久链接">¶</a></h1>
<p>一个优雅的 Go 应该具备的特点:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. 符合 Go 编码规范和最佳实践
2. 易阅读、易理解，易维护
3. 易测试、易扩展
4. 代码质量高
</pre></div>
</div>
<p>编写高质量的 Go 应用:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span> <span class="n">代码结构</span>
<span class="mf">2.</span> <span class="n">代码规范</span>
<span class="mf">3.</span> <span class="n">代码质量</span>
<span class="mf">4.</span> <span class="n">编程哲学</span>
<span class="mf">5.</span> <span class="n">软件设计方法</span>
</pre></div>
</div>
<figure class="align-default" id="id12">
<img alt="https://img.zhaoweiguo.com/knowledge/images/soft-engineerings/standard-code1.png" src="https://img.zhaoweiguo.com/knowledge/images/soft-engineerings/standard-code1.png" />
<figcaption>
<p><span class="caption-text">如何编写一个高质量的 Go 应用</span><a class="headerlink" href="#id12" title="此图像的永久链接">¶</a></p>
</figcaption>
</figure>
<figure class="align-default" id="id13">
<img alt="https://img.zhaoweiguo.com/knowledge/images/soft-engineerings/standard-code2.png" src="https://img.zhaoweiguo.com/knowledge/images/soft-engineerings/standard-code2.png" />
<figcaption>
<p><span class="caption-text">开发一个优雅的 Go 项目，其实就是编写高质量的 Go 应用、高效管理项目和编写高质量的项目文档</span><a class="headerlink" href="#id13" title="此图像的永久链接">¶</a></p>
</figcaption>
</figure>
<section id="id3">
<h2>1. 代码结构<a class="headerlink" href="#id3" title="此标题的永久链接">¶</a></h2>
<p>两个手段来组织代码结构:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. 组织一个好的目录结构
2. 选择一个好的模块拆分方法
    做好模块拆分，可以使项目内模块职责分明，做到低耦合高内聚
</pre></div>
</div>
<p>模块拆分方法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span> <span class="n">按层拆分</span>
<span class="mf">2.</span> <span class="n">按功能拆分</span>
</pre></div>
</div>
</section>
<section id="id4">
<h2>2. 代码规范<a class="headerlink" href="#id4" title="此标题的永久链接">¶</a></h2>
<p>遵循代码规范:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span> <span class="n">编码规范</span>
<span class="mf">2.</span> <span class="n">最佳实践</span>
</pre></div>
</div>
<p>几篇介绍 Go 语言最佳实践的文章:</p>
<blockquote>
<div><ol class="arabic simple">
<li><dl class="simple">
<dt>Effective Go</dt><dd><p>高效 Go 编程，由 Golang 官方编写，里面包含了编写 Go 代码的一些建议，也可以理解为最佳实践</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Go Code Review Comments</dt><dd><p>Golang 官方编写的 Go 最佳实践，作为 Effective Go 的补充</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Style guideline for Go packages</dt><dd><p>包含了如何组织 Go 包、如何命名 Go 包、如何写 Go 包文档的一些建议</p>
</dd>
</dl>
</li>
</ol>
</div></blockquote>
<ul class="simple">
<li><p>Uber Go 语言编码规范: <a class="reference external" href="https://github.com/uber-go/guide/blob/master/style.md">https://github.com/uber-go/guide/blob/master/style.md</a></p></li>
</ul>
</section>
<section id="id5">
<h2>3. 代码质量<a class="headerlink" href="#id5" title="此标题的永久链接">¶</a></h2>
<p>确保我们开发出的是一个高质量的代码:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">单元测试</span>
<span class="n">Code</span> <span class="n">Review</span>
</pre></div>
</div>
<p>单元测试环境的特点:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">可能无法连接数据库</span>
<span class="n">可能无法访问第三方服务</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>如果函数 A 依赖数据库连接、第三方服务，那么在单元测试环境下执行单元测试就会失败，函数就没法测试，函数是不可测的。解决方法也很简单：将依赖的数据库、第三方服务等抽象成接口，在被测代码中调用接口的方法，在测试时传入 mock 类型，从而将数据库、第三方服务等依赖从具体的被测函数中解耦出去。</p>
</div>
<p>为了提高代码的可测性，降低单元测试的复杂度，对 function 和 mock 的要求是:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. 要尽可能减少 function 中的依赖，让 function 只依赖必要的模块
    编写一个功能单一、职责分明的函数，会有利于减少依赖
2. 依赖模块应该是易 Mock 的
</pre></div>
</div>
<section id="id6">
<h3>示例<a class="headerlink" href="#id6" title="此标题的永久链接">¶</a></h3>
<p>不可测代码:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">post</span>
<span class="kn">import</span><span class="w"> </span><span class="s2">&quot;google.golang.org/grpc&quot;</span>
<span class="nb">type</span> <span class="n">Post</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">Name</span>    <span class="n">string</span>
  <span class="n">Address</span> <span class="n">string</span>
<span class="p">}</span>
<span class="n">func</span> <span class="n">ListPosts</span><span class="p">(</span><span class="n">client</span> <span class="o">*</span><span class="n">grpc</span><span class="o">.</span><span class="n">ClientConn</span><span class="p">)</span> <span class="p">([]</span><span class="o">*</span><span class="n">Post</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">client</span><span class="o">.</span><span class="n">ListPosts</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>这段代码中的 ListPosts 函数是不可测试的。因为 ListPosts 函数中调用了 client.ListPosts() 方法，该方法依赖于一个 gRPC 连接。而我们在做单元测试时，可能因为没有配置 gRPC 服务的地址、网络隔离等原因，导致没法建立 gRPC 连接，从而导致 ListPosts 函数执行失败。</p>
</div>
<p>可测代码:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">main</span>
<span class="nb">type</span> <span class="n">Post</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="n">Name</span>    <span class="n">string</span>
  <span class="n">Address</span> <span class="n">string</span>
<span class="p">}</span>
<span class="nb">type</span> <span class="n">Service</span> <span class="n">interface</span> <span class="p">{</span>
  <span class="n">ListPosts</span><span class="p">()</span> <span class="p">([]</span><span class="o">*</span><span class="n">Post</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">func</span> <span class="n">ListPosts</span><span class="p">(</span><span class="n">svc</span> <span class="n">Service</span><span class="p">)</span> <span class="p">([]</span><span class="o">*</span><span class="n">Post</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">svc</span><span class="o">.</span><span class="n">ListPosts</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>ListPosts 函数入参为 Service 接口类型，只要我们传入一个实现了 Service 接口类型的实例，ListPosts 函数即可成功运行。因此，我们可以在单元测试中可以实现一个不依赖任何第三方服务的 fake 实例，并传给 ListPosts</p>
</div>
<p>测试代码:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="n">main</span>
<span class="kn">import</span><span class="w"> </span><span class="s2">&quot;testing&quot;</span>
<span class="nb">type</span> <span class="n">fakeService</span> <span class="n">struct</span> <span class="p">{</span>
<span class="p">}</span>
<span class="n">func</span> <span class="n">NewFakeService</span><span class="p">()</span> <span class="n">Service</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">&amp;</span><span class="n">fakeService</span><span class="p">{}</span>
<span class="p">}</span>
<span class="n">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">fakeService</span><span class="p">)</span> <span class="n">ListPosts</span><span class="p">()</span> <span class="p">([]</span><span class="o">*</span><span class="n">Post</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">posts</span> <span class="o">:=</span> <span class="n">make</span><span class="p">([]</span><span class="o">*</span><span class="n">Post</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="n">posts</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">posts</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Post</span><span class="p">{</span>
    <span class="n">Name</span><span class="p">:</span>    <span class="s2">&quot;colin&quot;</span><span class="p">,</span>
    <span class="n">Address</span><span class="p">:</span> <span class="s2">&quot;Shenzhen&quot;</span><span class="p">,</span>
  <span class="p">})</span>
  <span class="n">posts</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">posts</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">Post</span><span class="p">{</span>
    <span class="n">Name</span><span class="p">:</span>    <span class="s2">&quot;alex&quot;</span><span class="p">,</span>
    <span class="n">Address</span><span class="p">:</span> <span class="s2">&quot;Beijing&quot;</span><span class="p">,</span>
  <span class="p">})</span>
  <span class="k">return</span> <span class="n">posts</span><span class="p">,</span> <span class="n">nil</span>
<span class="p">}</span>
<span class="n">func</span> <span class="n">TestListPosts</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">fake</span> <span class="o">:=</span> <span class="n">NewFakeService</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ListPosts</span><span class="p">(</span><span class="n">fake</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">nil</span> <span class="p">{</span>
    <span class="n">t</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="s2">&quot;list posts failed&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>代码可测之后，就可以借助一些工具来 Mock 需要的接口了</p>
</div>
</section>
<section id="id7">
<h3>工具<a class="headerlink" href="#id7" title="此标题的永久链接">¶</a></h3>
<p>常用的 Mock 工具:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. golang/mock，是官方提供的 Mock 框架
    它实现了基于 interface 的 Mock 功能，能够与 Golang 内置的 testing 包做很好的集成，是最常用的 Mock 工具。
    golang/mock 提供了 mockgen 工具用来生成 interface 对应的 Mock 源文件。
2. sqlmock，可以用来模拟数据库连接
    数据库是项目中比较常见的依赖，在遇到数据库依赖时都可以用它。
3. httpmock，可以用来 Mock HTTP 请求。
4. bouk/monkey，猴子补丁，能够通过替换函数指针的方式来修改任意函数的实现。
    如果 golang/mock、sqlmock 和 httpmock 这几种方法都不能满足我们的需求，
    我们可以尝试通过猴子补丁的方式来 Mock 依赖。
    可以这么说，猴子补丁提供了单元测试 Mock 依赖的最终解决方案。
</pre></div>
</div>
</section>
<section id="id8">
<h3>单元测试覆盖率<a class="headerlink" href="#id8" title="此标题的永久链接">¶</a></h3>
<p>两个建议:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. 使用 gotests 工具自动生成单元测试代码，减少编写单元测试用例的工作量，将你从重复的劳动中解放出来
2. 定期检查单元测试覆盖率。你可以通过以下方法来检查:
    $ go test -race -cover  -coverprofile=./coverage.out -timeout=10m -short -v ./...
    $ go tool cover -func ./coverage.out
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>可以先提高单元测试覆盖率低的函数，之后再检查项目的单元测试覆盖率；如果项目的单元测试覆盖率仍然低于期望的值，可以再次提高单元测试覆盖率低的函数的覆盖率，然后再检查。以此循环，最终将项目的单元测试覆盖率优化到预期的值为止。</p>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>对于一些可能经常会变动的函数单元测试，覆盖率要达到 100%</p>
</div>
</section>
<section id="code-review">
<h3>Code Review<a class="headerlink" href="#code-review" title="此标题的永久链接">¶</a></h3>
<p>建立 Code Review 机制很简单，主要有 3 点:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. 确保我们使用的代码托管平台有 Code Review 的功能。
    比如，GitHub、GitLab 这类代码托管平台都具备这种能力
2. 建立一套 Code Review 规范，规定如何进行 Code Review
3. 也是最重要的，每次代码变更，相关开发人员都要去落实 Code Review 机制，并形成习惯，直到最后形成团队文化
</pre></div>
</div>
</section>
</section>
<section id="id9">
<h2>4. 编程哲学<a class="headerlink" href="#id9" title="此标题的永久链接">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>组织一个合理的代码结构、编写符合 Go 代码规范的代码、保证代码质量，在我看来都是编写高质量 Go 代码的外功。那内功是什么呢？就是编程哲学和软件设计方法。</p>
</div>
<p>Go 语言有很多设计哲学，对代码质量影响比较大的，我认为有两个:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. 面向接口编程
2. 面向 “对象” 编程
</pre></div>
</div>
<p>使用接口的好处:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. 代码扩展性更强了
    例如，同样的 Bird，可以有不同的实现。
    在开发中用的更多的是，将数据库的 CURD 操作抽象成接口，从而可以实现同一份代码对接不同数据库的目的
2. 可以解耦上下游的实现
    例如，LetItFly 不用关注 Bird 是如何 Fly 的，只需要调用 Bird 提供的方法即可
3. 提高了代码的可测性
    因为接口可以解耦上下游实现，我们在单元测试需要依赖第三方系统 / 数据库的代码时
    可以利用接口将具体实现解耦，实现 fake 类型
4. 代码更健壮、更稳定了
    例如，如果要更改 Fly 的方式，只需要更改相关类型的 Fly 方法即可，完全影响不到 LetItFly 函数
</pre></div>
</div>
<p>面向对象编程（OOP）有很多优点:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>例如可以使我们的代码变得易维护、易扩展，并能提高开发效率等，
所以一个高质量的 Go 应用在需要时，也应该采用面向对象的方法去编程。

面向对象编程中，有几个核心特性:
类、实例、抽象，封装、继承、多态、构造函数、析构函数、方法重载、this 指针

Go 语言不支持面向对象编程，但可以通过以下几个方式来实现类似的效果:
1. 类、抽象、封装通过结构体来实现。
2. 实例通过结构体变量来实现。
3. 继承通过组合来实现。
4. 多态通过接口来实现。
</pre></div>
</div>
</section>
<section id="id10">
<h2>5. 软件设计方法<a class="headerlink" href="#id10" title="此标题的永久链接">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>继续学习编写高质量 Go 代码的第二项内功，也就是让编写的代码遵循一些业界沉淀下来的，优秀的软件设计方法。</p>
</div>
<p>优秀的软件设计方法中最重要的两类方法是:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. 设计模式（Design pattern）
    理解为业界针对一些特定的场景总结出来的最佳实现方式。
    它的特点是解决的场景比较具体，实施起来会比较简单
2. SOLID 原则
    理解为业界针对一些特定的场景总结出来的最佳实现方式。
    它的特点是解决的场景比较具体，实施起来会比较简单
</pre></div>
</div>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference external" href="/index.html">主页</a></p></td>
<td><p><a class="reference internal" href="../../genindex.html"><span class="std std-ref">索引</span></a></p></td>
<td><p><a class="reference internal" href="../../py-modindex.html"><span class="std std-ref">模块索引</span></a></p></td>
<td><p><a class="reference internal" href="../../search.html"><span class="std std-ref">搜索页面</span></a></p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="work-flow.html" class="btn btn-neutral float-right" title="2.1.14. 工作流规范" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rd-process.html" class="btn btn-neutral" title="2.1.12. 研发流程" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>
  
  <div id="gitalk-container"></div>
  <div role="contentinfo">
    <p>
        &copy; Copyright 2010-2025, 新溪-gordon.

    </p>
  </div>
  <div>备案号 <a href="http://www.beian.miit.gov.cn">京ICP备16018553号</a></div><div>Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a></div>. 


</footer>

<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?042289284b8eb33866001347a3e0b129";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
</script>     
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'V2025.09',
            LANGUAGE:'zh-CN',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/sphinx_highlight.js"></script>
      <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="../../_static/translations.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });


      // var gitalk = new Gitalk({
      //         clientID: '565177626b5d46427009',
      //         clientSecret: 'b2a36e67e1d2a73e43667f46d571c2624f8e1026',
      //         repo: 'knowledge',
      //         owner: 'zhaoweiguo',
      //         admin: ['zhaoweiguo'],
      //         id: location.pathname,      // Ensure uniqueness and length less than 50
      //         distractionFreeMode: false  // Facebook-like distraction free mode
      //       })
      // gitalk.render('gitalk-container')

  </script>


<script type="text/javascript" src="../../_static/js/table-of-contents-sidebar.js"></script>
<!-- <script type="text/javascript" src="https://table-of-contents-sidebar.github.io/table-of-contents-sidebar-lib/table-of-contents-sidebar.js"></script> -->
<script type="text/javascript">
    window.onload = function(e){
        TableOfContents.init({
            basePath: "https://table-of-contents-sidebar.github.io/table-of-contents-sidebar-lib/",
            querySelector: "body" // or other css querySelector
        });
    }
</script> 

</body>
</html>