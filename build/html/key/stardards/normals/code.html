

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>


<!-- start added 2025-04-14   增加对markdown中公式的支持 -->
<script>
window.MathJax = {
    tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true
    },
    options: {
        ignoreHtmlClass: "tex2jax_ignore|mathjax_ignore",
        processHtmlClass: "tex2jax_process|mathjax_process|math|output_area"
    }
};
</script>
<script defer="defer" src="https://fastly.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<!-- end added 2025-04-14   增加对markdown中公式的支持 -->


  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.1.8. 代码规范 &mdash; 新溪-gordon V2025.06 文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="2.1.9. 接口规范" href="api.html" />
    <link rel="prev" title="2.1.7. 目录结构规范" href="catalog.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>
  <script src="../../_static/js/jquery.min.js"></script>


<!-- 评论插件 gittalk start -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> -->
<!-- 评论插件 gittalk end -->


</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> 新溪-gordon
          

          
          </a>

          
            
            
              <div class="version">
                V2025.06
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../normal.html">1. 基本</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../normals/rdf.html">1.1. 知识图谱相关-RDF</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../standard.html">2. 规范</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../normal.html">2.1. 常用</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="0normal.html">2.1.1. 常用</a></li>
<li class="toctree-l3"><a class="reference internal" href="opensource.html">2.1.2. 开源规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="document.html">2.1.3. 文档规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="version.html">2.1.4. 版本规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="commit.html">2.1.5. Commit 规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="deploy.html">2.1.6. 发布规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="catalog.html">2.1.7. 目录结构规范</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.1.8. 代码规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html">2.1.9. 接口规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="log.html">2.1.10. 日志规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="error-code.html">2.1.11. 错误码规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="rd-process.html">2.1.12. 研发流程</a></li>
<li class="toctree-l3"><a class="reference internal" href="design-method.html">2.1.13. 设计方法</a></li>
<li class="toctree-l3"><a class="reference internal" href="work-flow.html">2.1.14. 工作流规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="sdk.html">2.1.15. SDK 规范</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Semantic-Versioning.html">2.2. Semantic Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lang.html">2.3. 语言相关</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../langs/golang.html">2.3.1. Golang 规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../langs/php.html">2.3.2. PHP规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../langs/erlang.html">2.3.3. Erlang规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../langs/db.html">2.3.4. DB规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../langs/android.html">2.3.5. Android规范</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../collect.html">3. 收集</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../collects/opensource.html">3.1. 开源项目</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/golang.html">3.1.1. Golang开源项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/node.html">3.1.2. Node开源项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/python.html">3.1.3. Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/rust.html">3.1.4. Rust开源项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/ui.html">3.1.5. UI开源项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/algorithm.html">3.1.6. 算法</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/course.html">3.1.7. 课程</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/book.html">3.1.8. 开源书籍</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/awesome.html">3.1.9. awesome</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/data_analysis.html">3.1.10. 数据分析</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/wiki.html">3.2. 名词 wiki</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/event.html">3.3. 事件</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../collects/events/2021.html">3.3.1. 2021年</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/events/2022.html">3.3.2. 2022年</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/common-sense.html">3.4. 常识</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/other.html">3.5. 常用</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/fame.html">3.5.1. 著名人物</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/fames/author.html">作者</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/fames/opensource.html">开源大佬</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/fames/quote.html">名言</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/fames/tmp.html">临时</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/corp.html">3.5.2. 公司</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/hashicorp.html">hashicorp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/STMicroelectronics.html">意法半导体</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/Tensilica.html">Tensilica</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/Marvell.html">Marvell迈威科技集团有限公司</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/%E5%BE%B7%E5%B7%9E%E4%BB%AA%E5%99%A8.html">德州仪器(TI)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/tmp.html">tmp</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/meeting.html">3.5.3. 会议</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/keyword.html">3.5.4. 关键词</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/website.html">3.5.5. 好的网站</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/concept.html">3.5.6. 定义</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E5%85%83%E7%BC%96%E7%A8%8B.html">元编程(Metaprogramming)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E5%8D%AB%E8%AF%AD%E5%8F%A5.html">卫语句</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E4%B9%92%E4%B9%93%E6%93%8D%E4%BD%9C.html">乒乓操作</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E5%9C%88%E5%A4%8D%E6%9D%82%E5%BA%A6.html">圈复杂度</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E4%BB%A3%E7%A0%81%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90.html">代码静态分析</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E4%BB%A3%E7%A0%81%E8%B5%B0%E6%9F%A5.html">代码走查</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/NP.html">NP非确定性多项式时间</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/fun.html">3.6. 娱乐</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/%E7%B4%A0%E6%9D%90.html">3.7. 素材</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../timeline.html">4. 时间线</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/normal.html">4.1. 常用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/architecture.html">4.2. 软件架构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/consensus.html">4.3. 共识相关</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/protocol.html">4.4. 协议相关</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/IoT.html">4.5. IoT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/AI.html">4.6. AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/blockchain.html">4.7. 区块链</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/robot.html">4.8. 机器人</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/security.html">4.9. 安全事件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/finance.html">4.10. 融资相关</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/politics.html">4.11. 政治</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/other.html">4.12. 其他</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">5. 技术路线图</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/normal.html">5.1. 常用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/normal.html#technology-roadmap">5.2. 技术路线图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/AI.html">5.3. AI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../roadmaps/AIs/knowledge-map.html">5.3.1. <strong>AI知识图谱</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/blockchain.html">5.4. 区块链</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/golang.html">5.5. Golang 路线图</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../roadmaps/golangs/knowledge-map.html">5.5.1. <strong>Golang知识图谱</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../skill.html">6. 技巧</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../difference.html">7. 区分</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">新溪-gordon</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../standard.html"><span class="section-number">2. </span>规范</a> &raquo;</li>
        
          <li><a href="../normal.html"><span class="section-number">2.1. </span>常用</a> &raquo;</li>
        
      <li><span class="section-number">2.1.8. </span>代码规范</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/stardards/normals/code.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            <nav id="local-table-of-contents" role="navigation" aria-labelledby="local-table-of-contents-title">
              <h4 id="local-table-of-contents-title">On This Page</h4>
              <ul>
<li><a class="reference internal" href="#">2.1.8. 代码规范</a><ul>
<li><a class="reference internal" href="#makefile">Makefile</a></li>
<li><a class="reference internal" href="#id3">测试</a></li>
<li><a class="reference internal" href="#id4">参考</a></li>
</ul>
</li>
</ul>

            </nav>
  <table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference external" href="/index.html">主页</a></p></td>
<td><p><a class="reference internal" href="../../genindex.html"><span class="std std-ref">索引</span></a></p></td>
<td><p><a class="reference internal" href="../../py-modindex.html"><span class="std std-ref">模块索引</span></a></p></td>
<td><p><a class="reference internal" href="../../search.html"><span class="std std-ref">搜索页面</span></a></p></td>
</tr>
</tbody>
</table>
<section id="id2">
<h1><span class="section-number">2.1.8. </span>代码规范<a class="headerlink" href="#id2" title="此标题的永久链接">¶</a></h1>
<section id="makefile">
<h2>Makefile<a class="headerlink" href="#makefile" title="此标题的永久链接">¶</a></h2>
<p>编写一个高质量的 Makefile 4 个方法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. 打好基础，也就是熟练掌握 Makefile 的语法
2. 做好准备工作，也就是提前规划 Makefile 要实现的功能
3. 进行规划，设计一个合理的 Makefile 结构
4. 掌握方法，用好 Makefile 的编写技巧
</pre></div>
</div>
<p>目录实例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>├── Makefile
├── scripts
│   ├── gendoc.sh
│   ├── make-rules
│   │   ├── gen.mk
│   │   ├── golang.mk
│   │   ├── image.mk
│   │   └── ...
│   └── ...
</pre></div>
</div>
<p>技巧 1：善用通配符和自动变量:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>通配符是 %: 可以使不同的目标使用相同的规则，从而使 Makefile 扩展性更强，也更简洁
如:
tools.verify.%:
  @if ! which $* &amp;&gt;/dev/null; then $(MAKE) tools.install.$*; fi

下面实例均可以使用上面定义的规则:
make tools.verify.swagger
make tools.verify.mockgen
自动变量 $*，用来指代被匹配的值 swagger、mockgen
</pre></div>
</div>
<p>技巧 2：善用函数:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Makefile</span> <span class="n">常用函数列表</span><span class="p">:</span>
<span class="nd">@todo</span>
</pre></div>
</div>
<p>技巧 3：依赖需要用到的工具:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>如果 Makefile 某个目标的命令中用到了某个工具，可以将该工具放在目标的依赖中
</pre></div>
</div>
<p>技巧 4：把常用功能放在 /Makefile 中，不常用的放在分类 Makefile 中:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>一个项目，尤其是大型项目，有很多需要管理的地方，其中大部分都可以通过 Makefile 实现自动化操作。
不过，为了保持 /Makefile 文件的整洁性，我们不能把所有的命令都添加在 /Makefile 文件中。

一个比较好的建议是:
    将常用功能放在 /Makefile 中
    不常用的放在分类 Makefile 中，并在 /Makefile 中 include 这些分类 Makefile
</pre></div>
</div>
<p>技巧 5：编写可扩展的 Makefile:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>定义: 可扩展的 Makefile:
  可以在不改变 Makefile 结构的情况下添加新功能
  扩展项目时，新功能可以自动纳入到 Makefile 现有逻辑中
</pre></div>
</div>
<p>技巧 6：将所有输出存放在一个目录下，方便清理和查找:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>通常我们可以把它们放在_output 这类目录下，这样清理时就很方便，只需要清理_output 文件夹就可以

.PHONY: go.clean
go.clean:
  @echo &quot;===========&gt; Cleaning all build output&quot;
  @-rm -vrf $(OUTPUT_DIR)

注意: 要用 -rm，而不是 rm，防止在没有_output 目录时，执行 make go.clean 报错
</pre></div>
</div>
<p>技巧 7：使用带层级的命名方式:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>例如 tools.verify.swagger ，我们可以实现目标分组管理。

这样做的好处有很多:
  1. 首先，当 Makefile 有大量目标时，通过分组，我们可以更好地管理这些目标
  2. 其次，分组也能方便理解，可以通过组名一眼识别出该目标的功能类别
  3. 最后，这样做还可以大大减小目标重名的概率
</pre></div>
</div>
<p>技巧 8：做好目标拆分:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>比如，我们可以将安装工具拆分成两个目标:
  1. 验证工具是否已安装
  2. 安装工具

通过这种方式，可以给我们的 Makefile 带来更大的灵活性
例如：我们可以根据需要选择性地执行其中一个操作，也可以两个操作一起执行
</pre></div>
</div>
<p>技巧 9：设置 OPTIONS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. 首先，在 /Makefile 中定义 USAGE_OPTIONS:
  define USAGE_OPTIONS
  Options:
    ...
    BINS         The binaries to build. Default is all of cmd.
                 ...
    ...
    V            Set to 1 enable verbose build. Default is 0.
  endef
  export USAGE_OPTIONS

2. 在 scripts/make-rules/common.mk 文件中，通过判断有没有设置 V 选项来选择不同的行为:
  ifndef V
  MAKEFLAGS += --no-print-directory
  endif

  or:
  ifeq ($(origin V), undefined)
  MAKEFLAGS += --no-print-directory
  endif
</pre></div>
</div>
<p>技巧 10：定义环境变量:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>GO := go
GO_SUPPORTED_VERSIONS ?= 1.13|1.14|1.15|1.16|1.17
GO_LDFLAGS += -X $(VERSION_PACKAGE).GitVersion=$(VERSION) \
  -X $(VERSION_PACKAGE).GitCommit=$(GIT_COMMIT) \
  -X $(VERSION_PACKAGE).GitTreeState=$(GIT_TREE_STATE) \
  -X $(VERSION_PACKAGE).BuildDate=$(shell date -u +&#39;%Y-%m-%dT%H:%M:%SZ&#39;)
ifneq ($(DLV),)

  GO_BUILD_FLAGS += -gcflags &quot;all=-N -l&quot;
  LDFLAGS = &quot;&quot;
endif
GO_BUILD_FLAGS += -tags=jsoniter -ldflags &quot;$(GO_LDFLAGS)&quot;
...
FIND := find . ! -path &#39;./third_party/*&#39; ! -path &#39;./vendor/*&#39;

作用：只要修改一处，就可以使很多地方同时生效，避免了重复的工作
</pre></div>
</div>
<p>一个大型 Go 项目通常需要实现以下功能:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span> <span class="n">代码生成类命令</span>
<span class="mf">2.</span> <span class="n">格式化类命令</span>
<span class="mf">3.</span> <span class="n">静态代码检查</span>
<span class="mf">4.</span> <span class="n">测试类命令</span>
<span class="mf">5.</span> <span class="n">构建类命令</span>
<span class="mf">6.</span> <span class="n">Docker</span> <span class="n">镜像打包类命令</span>
<span class="mf">7.</span> <span class="n">部署类命令</span>
<span class="mf">8.</span> <span class="n">清理类命令</span>
</pre></div>
</div>
</section>
<section id="id3">
<h2>测试<a class="headerlink" href="#id3" title="此标题的永久链接">¶</a></h2>
<p>测试用例函数必须以 Test、Benchmark、Example 开头:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span> <span class="n">TestXxx</span><span class="p">:</span>         <span class="n">单元测试</span>
<span class="mf">2.</span> <span class="n">BenchmarkXxx</span><span class="p">:</span>    <span class="n">性能测试</span>
<span class="mf">3.</span> <span class="n">ExampleXxx</span><span class="p">:</span>      <span class="n">示例测试</span>
</pre></div>
</div>
<p>其他测试类型:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">4.</span> <span class="n">TestMain</span> <span class="n">函数</span>
<span class="mf">5.</span> <span class="n">Mock</span> <span class="n">测试</span>
<span class="mf">6.</span> <span class="n">Fake</span> <span class="n">测试等</span>
</pre></div>
</div>
<ol class="arabic">
<li><p>单元测试TestXxx:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>*testing.T

为了清晰地表达函数的实际输出和预期输出
可以将这两类输出命名为 expected/actual，或者 got/want:
如:
if c.expected != actual {
  t.Fatalf(&quot;Expected User-Agent &#39;%s&#39; does not match &#39;%s&#39;&quot;, c.expected, actual)
}
or
if got, want := diags[3].Description().Summary, undeclPlural; got != want {
  t.Errorf(&quot;wrong summary for diagnostic 3\ngot:  %s\nwant: %s&quot;, got, want)
}

包的命名规范:
Go 的测试可以分为白盒测试和黑盒测试。
a. 白盒测试
    将测试和生产代码放在同一个 Go 包中，这使我们可以同时测试 Go 包中可导出和不可导出的标识符。
    当我们编写的单元测试需要访问 Go 包中不可导出的变量、函数和方法时，就需要编写白盒测试用例。
b. 黑盒测试
    将测试和生产代码放在不同的 Go 包中。
    这时，我们仅可以测试 Go 包的可导出标识符。
    这意味着我们的测试包将无法访问生产代码中的任何内部函数、变量或常量。
</pre></div>
</div>
</li>
<li><p>性能测试BenchmarkXxx:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>*testing.B

函数内以 b.N 作为循环次数
其中 N 会在运行时动态调整，直到性能测试函数可以持续足够长的时间，以便能够可靠地计时

func BenchmarkRandInt(b *testing.B) {
    for i := 0; i &lt; b.N; i++ {
        RandInt()
    }
}

使用:
$ go test -bench=&quot;.*&quot;
goos: linux
goarch: amd64
pkg: github.com/marmotedu/gopractise-demo/31/test
BenchmarkRandInt-4      97384827                12.4 ns/op
PASS
ok      github.com/marmotedu/gopractise-demo/31/test    1.223s

说明:
BenchmarkRandInt-4:
    BenchmarkRandInt 表示所测试的测试函数名
    4 表示有 4 个 CPU 线程参与了此次测试，默认是 GOMAXPROCS 的值。
90848414:
    说明函数中的循环执行了 90848414 次。
12.8 ns/op:
    说明每次循环的执行平均耗时是 12.8 纳秒，该值越小，说明代码性能越高。

B 类型的性能测试还支持下面 4 个参数:
a. benchmem，输出内存分配统计
b. benchtime，指定测试时间和循环执行次数（格式需要为 Nx，例如 100x）
c. cpu，指定 GOMAXPROCS
d. timeout，指定测试函数执行的超时时间
</pre></div>
</div>
</li>
<li><p>实例ExampleXxx:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>说明:
    有 fmt.Println/fmt.Printf 这类输出的时候使用

示例测试可能包含:
    1. 以Output: 开头的注释
    2. 以Unordered output: 开头的注释
    这些注释放在函数的结尾部分
    Unordered output: 开头的注释会忽略输出行的顺序

示例:
func ExampleMax() {
    fmt.Println(Max(1, 2))
    // Output:
    // 2
}

使用:
$ go test -v -run=&#39;Example.*&#39;
=== RUN   ExampleMax
--- PASS: ExampleMax (0.00s)
PASS
ok      github.com/marmotedu/gopractise-demo/31/test    0.004s

说明:
当示例测试不包含 Output: 或者 Unordered output: 注释时
执行 go test 只会编译这些函数，但不会执行这些函数
</pre></div>
</div>
</li>
<li><p>TestMain 函数:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>*testing.M

简介:
    1. 先做一些准备工作
    2. 其他单元测试...
    3. 最后再做一些收尾工作

说明:
TestMain 是一个特殊的函数（相当于 main 函数）
测试用例在执行时，会先执行 TestMain 函数，然后可以在 TestMain 中调用 m.Run() 函数执行普通的测试函数
在 m.Run() 函数前面我们可以编写准备逻辑，在 m.Run() 后面我们可以编写清理逻辑

示例:
// https://github.com/marmotedu/gopractise-demo/blob/master/31/test/math_test.go
func TestMain(m *testing.M) {
    fmt.Println(&quot;do some setup&quot;)
    m.Run()
    fmt.Println(&quot;do some cleanup&quot;)
}

执行:
$ go test -v
do some setup
=== RUN   TestAbs
--- PASS: TestAbs (0.00s)
...
=== RUN   ExampleMax
--- PASS: ExampleMax (0.00s)
PASS
do some cleanup
ok    github.com/marmotedu/gopractise-demo/31/test  0.006s
</pre></div>
</div>
</li>
<li><p>Mock 测试:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>GoMock 是由 Golang 官方开发维护的测试框架
实现了较为完整的基于 interface 的 Mock 功能
    能够与 Golang 内置的 testing 包良好集成，也能用于其他的测试环境中。
GoMock 测试框架包含了 GoMock 包和 mockgen 工具两部分
    a. GoMock 包用来完成对象生命周期的管理
    b. mockgen 工具用来生成 interface 对应的 Mock 类源文件
</pre></div>
</div>
</li>
<li><p>Fake 测试:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>对于比较复杂的接口，可以 Fake 一个接口实现，来进行测试
所谓 Fake 测试，其实就是针对接口实现一个假（fake）的实例
至于如何实现 Fake 实例，需要你根据业务自行实现
</pre></div>
</div>
</li>
</ol>
<p>测试框架:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. Testify 框架
    Testify 是 Go test 的预判工具，它能让你的测试代码变得更优雅和高效，测试结果也变得更详细
2. GoConvey 框架
    GoConvey 是一款针对 Golang 的测试框架
    可以管理和运行测试用例，同时提供了丰富的断言函数，并支持很多 Web 界面特性
</pre></div>
</div>
<p>Mock 工具:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. sqlmock
    可以用来模拟数据库连接。数据库是项目中比较常见的依赖，在遇到数据库依赖时都可以用它
2. httpmock
    可以用来 Mock HTTP 请求
3. bouk/monkey
    猴子补丁，能够通过替换函数指针的方式来修改任意函数的实现
    如果 golang/mock、sqlmock 和 httpmock 这几种方法都不能满足我们的需求
    可以尝试用猴子补丁的方式来 Mock 依赖
    可以这么说，猴子补丁提供了单元测试 Mock 依赖的最终解决方案
</pre></div>
</div>
</section>
<section id="id4">
<h2>参考<a class="headerlink" href="#id4" title="此标题的永久链接">¶</a></h2>
<ul class="simple">
<li><p>陈皓, 《跟我一起写 Makefile》 (PDF 重制版)</p></li>
</ul>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference external" href="/index.html">主页</a></p></td>
<td><p><a class="reference internal" href="../../genindex.html"><span class="std std-ref">索引</span></a></p></td>
<td><p><a class="reference internal" href="../../py-modindex.html"><span class="std std-ref">模块索引</span></a></p></td>
<td><p><a class="reference internal" href="../../search.html"><span class="std std-ref">搜索页面</span></a></p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="2.1.9. 接口规范" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="catalog.html" class="btn btn-neutral" title="2.1.7. 目录结构规范" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>
  
  <div id="gitalk-container"></div>
  <div role="contentinfo">
    <p>
        &copy; Copyright 2010-2025, 新溪-gordon.

    </p>
  </div>
  <div>备案号 <a href="http://www.beian.miit.gov.cn">京ICP备16018553号</a></div><div>Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a></div>. 


</footer>

<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?042289284b8eb33866001347a3e0b129";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
</script>     
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'V2025.06',
            LANGUAGE:'zh-CN',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/sphinx_highlight.js"></script>
      <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="../../_static/translations.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });


      // var gitalk = new Gitalk({
      //         clientID: '565177626b5d46427009',
      //         clientSecret: 'b2a36e67e1d2a73e43667f46d571c2624f8e1026',
      //         repo: 'knowledge',
      //         owner: 'zhaoweiguo',
      //         admin: ['zhaoweiguo'],
      //         id: location.pathname,      // Ensure uniqueness and length less than 50
      //         distractionFreeMode: false  // Facebook-like distraction free mode
      //       })
      // gitalk.render('gitalk-container')

  </script>


<script type="text/javascript" src="../../_static/js/table-of-contents-sidebar.js"></script>
<!-- <script type="text/javascript" src="https://table-of-contents-sidebar.github.io/table-of-contents-sidebar-lib/table-of-contents-sidebar.js"></script> -->
<script type="text/javascript">
    window.onload = function(e){
        TableOfContents.init({
            basePath: "https://table-of-contents-sidebar.github.io/table-of-contents-sidebar-lib/",
            querySelector: "body" // or other css querySelector
        });
    }
</script> 

</body>
</html>