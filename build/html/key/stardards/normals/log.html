

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>


<!-- start added 2025-04-14   增加对markdown中公式的支持 -->
<script>
window.MathJax = {
    tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true
    },
    options: {
        ignoreHtmlClass: "tex2jax_ignore|mathjax_ignore",
        processHtmlClass: "tex2jax_process|mathjax_process|math|output_area"
    }
};
</script>
<script defer="defer" src="https://fastly.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<!-- end added 2025-04-14   增加对markdown中公式的支持 -->


  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>2.1.10. 日志规范 &mdash; 新溪-gordon V2025.06 文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="2.1.11. 错误码规范" href="error-code.html" />
    <link rel="prev" title="2.1.9. 接口规范" href="api.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>
  <script src="../../_static/js/jquery.min.js"></script>


<!-- 评论插件 gittalk start -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> -->
<!-- 评论插件 gittalk end -->


</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> 新溪-gordon
          

          
          </a>

          
            
            
              <div class="version">
                V2025.06
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../normal.html">1. 基本</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../normals/rdf.html">1.1. 知识图谱相关-RDF</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../standard.html">2. 规范</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../normal.html">2.1. 常用</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="0normal.html">2.1.1. 常用</a></li>
<li class="toctree-l3"><a class="reference internal" href="opensource.html">2.1.2. 开源规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="document.html">2.1.3. 文档规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="version.html">2.1.4. 版本规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="commit.html">2.1.5. Commit 规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="deploy.html">2.1.6. 发布规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="catalog.html">2.1.7. 目录结构规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="code.html">2.1.8. 代码规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="api.html">2.1.9. 接口规范</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.1.10. 日志规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="error-code.html">2.1.11. 错误码规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="rd-process.html">2.1.12. 研发流程</a></li>
<li class="toctree-l3"><a class="reference internal" href="design-method.html">2.1.13. 设计方法</a></li>
<li class="toctree-l3"><a class="reference internal" href="work-flow.html">2.1.14. 工作流规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="sdk.html">2.1.15. SDK 规范</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Semantic-Versioning.html">2.2. Semantic Versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lang.html">2.3. 语言相关</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../langs/golang.html">2.3.1. Golang 规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../langs/php.html">2.3.2. PHP规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../langs/erlang.html">2.3.3. Erlang规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../langs/db.html">2.3.4. DB规范</a></li>
<li class="toctree-l3"><a class="reference internal" href="../langs/android.html">2.3.5. Android规范</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../collect.html">3. 收集</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../collects/opensource.html">3.1. 开源项目</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/golang.html">3.1.1. Golang开源项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/node.html">3.1.2. Node开源项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/python.html">3.1.3. Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/rust.html">3.1.4. Rust开源项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/ui.html">3.1.5. UI开源项目</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/algorithm.html">3.1.6. 算法</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/course.html">3.1.7. 课程</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/book.html">3.1.8. 开源书籍</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/awesome.html">3.1.9. awesome</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/opensources/data_analysis.html">3.1.10. 数据分析</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/wiki.html">3.2. 名词 wiki</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/event.html">3.3. 事件</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../collects/events/2021.html">3.3.1. 2021年</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/events/2022.html">3.3.2. 2022年</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/common-sense.html">3.4. 常识</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/other.html">3.5. 常用</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/fame.html">3.5.1. 著名人物</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/fames/author.html">作者</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/fames/opensource.html">开源大佬</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/fames/quote.html">名言</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/fames/tmp.html">临时</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/corp.html">3.5.2. 公司</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/hashicorp.html">hashicorp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/STMicroelectronics.html">意法半导体</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/Tensilica.html">Tensilica</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/Marvell.html">Marvell迈威科技集团有限公司</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/%E5%BE%B7%E5%B7%9E%E4%BB%AA%E5%99%A8.html">德州仪器(TI)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/corps/tmp.html">tmp</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/meeting.html">3.5.3. 会议</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/keyword.html">3.5.4. 关键词</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/website.html">3.5.5. 好的网站</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../collects/others/concept.html">3.5.6. 定义</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E5%85%83%E7%BC%96%E7%A8%8B.html">元编程(Metaprogramming)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E5%8D%AB%E8%AF%AD%E5%8F%A5.html">卫语句</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E4%B9%92%E4%B9%93%E6%93%8D%E4%BD%9C.html">乒乓操作</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E5%9C%88%E5%A4%8D%E6%9D%82%E5%BA%A6.html">圈复杂度</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E4%BB%A3%E7%A0%81%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90.html">代码静态分析</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/%E4%BB%A3%E7%A0%81%E8%B5%B0%E6%9F%A5.html">代码走查</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../collects/others/concepts/NP.html">NP非确定性多项式时间</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/fun.html">3.6. 娱乐</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../collects/%E7%B4%A0%E6%9D%90.html">3.7. 素材</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../timeline.html">4. 时间线</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/normal.html">4.1. 常用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/architecture.html">4.2. 软件架构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/consensus.html">4.3. 共识相关</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/protocol.html">4.4. 协议相关</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/IoT.html">4.5. IoT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/AI.html">4.6. AI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/blockchain.html">4.7. 区块链</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/robot.html">4.8. 机器人</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/security.html">4.9. 安全事件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/finance.html">4.10. 融资相关</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/politics.html">4.11. 政治</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../timelines/other.html">4.12. 其他</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">5. 技术路线图</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/normal.html">5.1. 常用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/normal.html#technology-roadmap">5.2. 技术路线图</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/AI.html">5.3. AI</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../roadmaps/AIs/knowledge-map.html">5.3.1. <strong>AI知识图谱</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/blockchain.html">5.4. 区块链</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../roadmaps/golang.html">5.5. Golang 路线图</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../roadmaps/golangs/knowledge-map.html">5.5.1. <strong>Golang知识图谱</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../skill.html">6. 技巧</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../difference.html">7. 区分</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">新溪-gordon</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../standard.html"><span class="section-number">2. </span>规范</a> &raquo;</li>
        
          <li><a href="../normal.html"><span class="section-number">2.1. </span>常用</a> &raquo;</li>
        
      <li><span class="section-number">2.1.10. </span>日志规范</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/stardards/normals/log.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            <nav id="local-table-of-contents" role="navigation" aria-labelledby="local-table-of-contents-title">
              <h4 id="local-table-of-contents-title">On This Page</h4>
              <ul>
<li><a class="reference internal" href="#">2.1.10. 日志规范</a><ul>
<li><a class="reference internal" href="#id3">基础功能</a></li>
<li><a class="reference internal" href="#id4">高级功能</a></li>
<li><a class="reference internal" href="#id5">可选功能</a></li>
<li><a class="reference internal" href="#id6">需要关注的点</a></li>
<li><a class="reference internal" href="#id7">如何记录日志</a></li>
<li><a class="reference internal" href="#id8">日志的 “最佳” 实践总结</a></li>
</ul>
</li>
</ul>

            </nav>
  <table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference external" href="/index.html">主页</a></p></td>
<td><p><a class="reference internal" href="../../genindex.html"><span class="std std-ref">索引</span></a></p></td>
<td><p><a class="reference internal" href="../../py-modindex.html"><span class="std std-ref">模块索引</span></a></p></td>
<td><p><a class="reference internal" href="../../search.html"><span class="std std-ref">搜索页面</span></a></p></td>
</tr>
</tbody>
</table>
<section id="id2">
<h1><span class="section-number">2.1.10. </span>日志规范<a class="headerlink" href="#id2" title="此标题的永久链接">¶</a></h1>
<p>日志包需要实现的功能分为:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span> <span class="n">基础功能是一个日志包必须要具备的功能</span>
<span class="mf">2.</span> <span class="n">高级功能是在特定场景下可增加的功能</span>
<span class="mf">3.</span> <span class="n">可选功能是在特定场景下可增加的功能</span>
</pre></div>
</div>
<section id="id3">
<h2>基础功能<a class="headerlink" href="#id3" title="此标题的永久链接">¶</a></h2>
<ol class="arabic">
<li><p>支持基本的日志信息:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>日志包需要支持基本的日志信息，包括:
时间戳、文件名、行号、日志级别和日志信息
</pre></div>
</div>
</li>
<li><p>支持不同的日志级别:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>不同的日志级别代表不同的日志类型，例如:
Error 级别的日志，说明日志是错误类型，在排障时，会首先查看错误级别的日志
Warn 级别日志说明出现异常，但还不至于影响程序运行，可以用来参考、定位出异常所在
Info 级别的日志，可以协助我们 Debug，并记录一些有用的信息，供后期进行分析

打印日志时，一个日志调用其实具有两个属性:
a. 输出级别：打印日志时，我们期望日志的输出级别
b. 开关级别：启动应用程序时，期望哪些输出级别的日志被打印
  如果开关级别设置为 L ，只有输出级别 &gt;=L 时，日志才会被打印
</pre></div>
</div>
</li>
<li><p>支持自定义配置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>不同的运行环境，需要不同的日志输出配置，例如:
  开发测试环境为了能够方便地 Debug，需要设置日志级别为 Debug 级别；
  现网环境为了提高应用程序的性能，则需要设置日志级别为 Info 级别

现网环境为了方便日志采集，通常会输出 JSON 格式的日志
开发测试环境为了方便查看日志，会输出 TEXT 格式的日志

日志包需要能够被配置，不同环境采用不同的配置
通过配置，可以在不重新编译代码的情况下，改变记录日志的行为
</pre></div>
</div>
</li>
<li><p>支持输出到标准输出和文件:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>日志总是要被读的，要么输出到标准输出，供开发者实时读取，要么保存到文件，供开发者日后查看
输出到标准输出和保存到文件是一个日志包最基本的功能
</pre></div>
</div>
</li>
</ol>
</section>
<section id="id4">
<h2>高级功能<a class="headerlink" href="#id4" title="此标题的永久链接">¶</a></h2>
<ol class="arabic">
<li><p>支持多种日志格式:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>一个好的日志格式，不仅方便查看日志，还能方便日志采集组件采集日志，
  并对接类似 Elasticsearch 这样的日志搜索引擎

一个日志包至少需要提供以下两种格式:
a. TEXT 格式
b. JSON 格式
</pre></div>
</div>
</li>
<li><p>能够按级别分类输出:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>为了能够快速定位到需要的日志，一个比较好的做法是:
  将日志按级别分类输出，至少错误级别的日志可以输出到独立的文件中
</pre></div>
</div>
</li>
<li><p>支持结构化日志:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>结构化日志（Structured Logging），就是使用 JSON 或者其他编码方式使日志结构化
这样可以方便后续使用 Filebeat、Logstash Shipper 等各种工具，对日志进行采集、过滤、分析和查找
</pre></div>
</div>
</li>
<li><p>支持日志轮转:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>在一个大型项目中，一天可能会产生几十个 G 的日志
为了防止把磁盘空间占满，就需要确保日志大小达到一定量级时，对日志进行切割、压缩，并转存
</pre></div>
</div>
</li>
<li><p>具备 Hook 能力:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Hook 能力可以使我们对日志内容进行自定义处理。
例如:
  当某个级别的日志产生时，发送邮件或者调用告警接口进行告警

在一个大型系统中，日志告警是非常重要的功能，但更好的实现方式是将告警能力做成旁路功能:
  通过旁路功能，可以保证日志包功能聚焦、简洁
  例如：可以将日志收集到 Elasticsearch，并通过 ElastAlert 进行日志告警
</pre></div>
</div>
</li>
</ol>
</section>
<section id="id5">
<h2>可选功能<a class="headerlink" href="#id5" title="此标题的永久链接">¶</a></h2>
<ol class="arabic simple">
<li><p>支持颜色输出</p></li>
<li><p>兼容标准库 log 包</p></li>
<li><p>支持输出到不同的位置</p></li>
</ol>
</section>
<section id="id6">
<h2>需要关注的点<a class="headerlink" href="#id6" title="此标题的永久链接">¶</a></h2>
<ol class="arabic">
<li><p>高性能:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>因为我们要在代码中频繁调用日志包，记录日志，所以日志包的性能是首先要考虑的点
</pre></div>
</div>
</li>
<li><p>并发安全:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Go 应用程序会大量使用 Go 语言的并发特性，也就意味着需要并发地记录日志，这就需要日志包是并发安全的
</pre></div>
</div>
</li>
<li><p>插件化能力:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>日志包应该能提供一些插件化的能力，比如:
  允许开发者自定义输出格式，自定义存储位置，自定义错误发生时的行为（例如 告警、发邮件等）
插件化的能力不是必需的，因为日志自身的特性就能满足绝大部分的使用需求，
例如:
  输出格式支持 JSON 和 TEXT
  存储位置支持标准输出和文件
  日志监控可以通过一些旁路系统来实现。
</pre></div>
</div>
</li>
<li><p>日志参数控制:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>日志包应该能够灵活地进行配置，初始化时配置或者程序运行时配置
例如:
  初始化配置可以通过 Init 函数完成
  运行时配置可以通过 SetOptions / SetLevel 等函数来完成
</pre></div>
</div>
</li>
</ol>
</section>
<section id="id7">
<h2>如何记录日志<a class="headerlink" href="#id7" title="此标题的永久链接">¶</a></h2>
<ol class="arabic">
<li><p>在何处打印日志:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>a. 在分支语句处打印日志:
  在分支语句处打印日志，可以判断出代码走了哪个分支，有助于判断请求的下一跳，继而继续排查问题
b. 写操作必须打印日志:
  写操作最可能会引起比较严重的业务故障，写操作打印日志，可以在出问题时找到关键信息
c. 在循环中打印日志要慎重:
  如果循环次数过多，会导致打印大量的日志，严重拖累代码的性能
  建议的办法: 在循环中记录要点，在循环外面总结打印出来
d. 在错误产生的最原始位置打印日志:
  对于嵌套的 Error，可在 Error 产生的最初位置打印 Error 日志
  上层如果不需要添加必要的信息，可以直接返回下层的 Error
</pre></div>
</div>
</li>
<li><p>在哪个日志级别打印日志:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>不同级别的日志，具有不同的意义，能实现不同的功能:
a. Debug 级别
为了获取足够的信息进行 Debug，通常会在 Debug 级别打印很多日志。
例如，可以打印整个 HTTP 请求的请求 Body 或者响应 Body。
Debug 级别需要打印大量的日志，这会严重拖累程序的性能。
并且，Debug 级别的日志，主要是为了能在开发测试阶段更好地 Debug，多是一些不影响现网业务的日志信息。
所以，对于 Debug 级别的日志，在服务上线时我们一定要禁止掉。
Debug 这个级别的日志可以随意输出，任何你觉得有助于开发、测试阶段调试的日志，都可以在这个级别打印。

b. Info 级别
Info 级别的日志可以记录一些有用的信息，供以后的运营分析，
所以 Info 级别的日志不是越多越好，也不是越少越好，应以满足需求为主要目标。
一些关键日志，可以在 Info 级别记录，但如果日志量大、输出频度过高，则要考虑在 Debug 级别记录。

现网的日志级别一般是 Info 级别，在记录日志时，要注意避免产生过多的 Info 级别的日志
例如，在 for 循环中，就要慎用 Info 级别的日志。

c. Warn 级别
一些警告类的日志可以记录在 Warn 级别
Warn 级别的日志往往说明程序运行异常，不符合预期，但又不影响程序的继续运行，或者是暂时影响，但后续会恢复

Warn 更多的是业务级别的警告日志。

d. Error 级别
Error 级别的日志告诉我们程序执行出错，这些错误肯定会影响到程序的执行结果，
例如请求失败、创建资源失败等。
要记录每一个发生错误的日志，避免日后排障过程中这些错误被忽略掉。
大部分的错误可以归在 Error 级别。

e. Panic 级别
Panic 级别的日志在实际开发中很少用
通常只在需要错误堆栈，或者不想因为发生严重错误导致程序退出，而采用 defer 处理错误时使用。

f. Fatal 级别
Fatal 是最高级别的日志
这个级别的日志说明问题已经相当严重，严重到程序无法继续运行，通常是系统级的错误
在开发中也很少使用，除非我们觉得某个错误发生时，整个程序无法继续运行。
</pre></div>
</div>
</li>
<li><p>如何记录日志内容:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>a. 在记录日志时，不要输出一些敏感信息，例如密码、密钥等
b. 为了方便调试，通常会在 Debug 基本记录一些临时日志，这些日志内容可以用一些特殊的字符开头
    例如: log.Debugf(&quot;XXXXXXXXXXXX-1:Input key was: %s&quot;, setKeyName)
    这样，在完成调试后，可以通过查找 XXXXXXXXXXXX 字符串，找到这些临时日志，在 commit 前删除
c. 日志内容应该小写字母开头，以英文点号 . 结尾
    例如: log.Info(&quot;update user function called.&quot;)
d. 为了提高性能，尽可能使用明确的类型
    例如:
      使用 log.Warnf(&quot;init datastore: %s&quot;, err.Error())
      而非 log.Warnf(&quot;init datastore: %v&quot;, err) 。
e. 根据需要，日志最好包含两个信息
    一个是请求 ID（RequestID），是每次请求的唯一 ID
      便于从海量日志中过滤出某次请求的日志，可以将请求 ID 放在请求的通用日志字段中
    另一个是用户和行为，用于标识谁做了什么
f. 不要将日志记录在错误的日志级别上
    例如:
      不要将正常的日志信息打印在 Error 级别，将错误的日志信息打印在 Info 级别
</pre></div>
</div>
</li>
</ol>
</section>
<section id="id8">
<h2>日志的 “最佳” 实践总结<a class="headerlink" href="#id8" title="此标题的永久链接">¶</a></h2>
<ol class="arabic">
<li><p>开发调试、现网故障排障时，不要遗忘一件事情:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>根据排障的过程优化日志打印
【注】好的日志，可能不是一次就可以写好的
可以在实际开发测试，还有现网定位问题时，不断优化
</pre></div>
</div>
</li>
<li><p>打印日志要 “不多不少”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>避免打印没有作用的日志，也不要遗漏关键的日志信息。
最好的信息是，仅凭借这些关键的日志就能定位到问题。
</pre></div>
</div>
</li>
<li><p>支持动态日志输出，方便线上问题定位:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>总是将日志记录在本地文件
通过将日志记录在本地文件，可以和日志中心化平台进行解耦
这样当网络不可用，或者日志中心化平台故障时，仍然能够正常的记录日志
</pre></div>
</div>
</li>
<li><p>集中化日志存储处理</p>
<blockquote>
<div><p>因为应用可能包含多个服务，一个服务包含多个实例
为了查看日志方便，最好将这些日志统一存储在同一个日志平台上，
例如 Elasticsearch，方便集中管理和查看日志。</p>
</div></blockquote>
</li>
<li><p>结构化日志记录:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>添加一些默认通用的字段到每行日志，方便日志查询和分析。
</pre></div>
</div>
</li>
<li><p>支持 RequestID:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>使用 RequestID 串联一次请求的所有日志，这些日志可能分布在不同的组件，不同的机器上
支持 RequestID 可以大大提高排障的效率，降低排障难度
在一些大型分布式系统中，没有 RequestID 排障简直就是灾难
</pre></div>
</div>
</li>
<li><p>支持动态开关 Debug 日志:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>对于定位一些隐藏得比较深的问题，可能需要更多的信息，这时候可能需要打印 Debug 日志
最好的办法是能够在请求中通过 debug=true 这类参数动态控制某次请求是否开启 Debug 日志
</pre></div>
</div>
</li>
</ol>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference external" href="/index.html">主页</a></p></td>
<td><p><a class="reference internal" href="../../genindex.html"><span class="std std-ref">索引</span></a></p></td>
<td><p><a class="reference internal" href="../../py-modindex.html"><span class="std std-ref">模块索引</span></a></p></td>
<td><p><a class="reference internal" href="../../search.html"><span class="std std-ref">搜索页面</span></a></p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="error-code.html" class="btn btn-neutral float-right" title="2.1.11. 错误码规范" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="api.html" class="btn btn-neutral" title="2.1.9. 接口规范" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>
  
  <div id="gitalk-container"></div>
  <div role="contentinfo">
    <p>
        &copy; Copyright 2010-2025, 新溪-gordon.

    </p>
  </div>
  <div>备案号 <a href="http://www.beian.miit.gov.cn">京ICP备16018553号</a></div><div>Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a></div>. 


</footer>

<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?042289284b8eb33866001347a3e0b129";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
</script>     
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'V2025.06',
            LANGUAGE:'zh-CN',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/sphinx_highlight.js"></script>
      <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="../../_static/translations.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });


      // var gitalk = new Gitalk({
      //         clientID: '565177626b5d46427009',
      //         clientSecret: 'b2a36e67e1d2a73e43667f46d571c2624f8e1026',
      //         repo: 'knowledge',
      //         owner: 'zhaoweiguo',
      //         admin: ['zhaoweiguo'],
      //         id: location.pathname,      // Ensure uniqueness and length less than 50
      //         distractionFreeMode: false  // Facebook-like distraction free mode
      //       })
      // gitalk.render('gitalk-container')

  </script>


<script type="text/javascript" src="../../_static/js/table-of-contents-sidebar.js"></script>
<!-- <script type="text/javascript" src="https://table-of-contents-sidebar.github.io/table-of-contents-sidebar-lib/table-of-contents-sidebar.js"></script> -->
<script type="text/javascript">
    window.onload = function(e){
        TableOfContents.init({
            basePath: "https://table-of-contents-sidebar.github.io/table-of-contents-sidebar-lib/",
            querySelector: "body" // or other css querySelector
        });
    }
</script> 

</body>
</html>