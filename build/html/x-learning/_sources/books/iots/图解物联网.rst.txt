图解物联网
##########


* 豆瓣: https://book.douban.com/subject/27016248/

时间::

    著：2015-03
    译：2017-04

第1章 物联网的基础知识
======================

.. figure:: https://img.zhaoweiguo.com/uPic/2022/04/lrvwIs.jpg

   泛在网络可以让人们随时随地访问网络

.. figure:: https://img.zhaoweiguo.com/uPic/2022/04/TXcIKy.jpg

   连接互联网的各种各样的“物”

2013年12月，在美国高通公司的支持下，家电厂商的横向性物联网推进联盟AllSeen Alliance成立了。该联盟的意图在于越过厂商这道高墙，规划一种统一规格，让冰箱、烤箱及电灯等所有电器都能通过互联网实现协作。
2014年7月，在英特尔和三星的推动下，物联网联盟OIC成立了。该联盟旨在为物联网相关机器的规格和认证设立标准。

.. figure:: https://img.zhaoweiguo.com/uPic/2022/04/7L7Yv5.jpg

   具有代表性的传感器的种类


第 2 章 物联网的架构
====================

.. figure:: https://img.zhaoweiguo.com/uPic/2022/04/Wtyei5.png

   QoS 1: 中介一接收到消息就会向发布者发送一个叫作“PUBACK 消息”的响应，除此之外还会根据订阅者指定的 QoS 发送消息。当发生故障，或经过一定时间后仍没能确认 PUBACK 消息时，发布者会重新发送消息。如果中介接收了发布者发来的消息却没有返回 PUBACK，那么中介会重复收到消息。


.. figure:: https://img.zhaoweiguo.com/uPic/2022/04/HDnJiw.png

   用QoS 2 发送的消息里面含有消息 ID。中介收到消息后会将消息保存，然后给发布者发送 PUBREC 消息。发布者再给中介发送 PUBREL 消息，然后中介会给发布者发送 PUBCOMP 消息。接下来中介才会依据订阅者指定的 QoS，向订阅者传递接收到的消息。

.. figure:: https://img.zhaoweiguo.com/uPic/2022/04/CXCeXb.png

   Retain: 订阅者只能接收在订阅之后发布的消息，但如果发布者事先发布了带有 Retain 标志的消息，那么订阅者就能在订阅后马上收到消息。当发布者发布了带有 Retain 标志的消息时，中介会把消息传递给订阅了主题的订阅者，同时保存带有 Retain 标志的最新的消息。此时，若别的订阅者订阅了主题，就能马上收到带有 Retain 标志的新消息

.. figure:: https://img.zhaoweiguo.com/uPic/2022/04/I4y242.png

   Will: 有“遗言”的意思。由于中介的 I/O 错误或网络故障等情况，发布者可能会突然从中介断开，Will 就是专门针对于这种情况的一个机构，它用于定义中介向订阅者发送的消息。发布者在连接中介时会用到 CONNECT（连接）消息，连接时对其指定 Will 标志、要发送的消息以及 QoS。这样一来，如果连接意外断开，Will 消息就会被传递给订阅者。另外，还有一个标志叫作 Will Retain。通过指定这个标志，就能跟前面说的 Retain 达到同样的效果，即在中介处保存消息。但当发布者使用 DISCONNECT（断开连接）消息明确表明连接已断开时，Will 消息就不会被发送给订阅者。

.. figure:: https://img.zhaoweiguo.com/uPic/2022/04/fHGodA.png

* Clean session 用于指定中介是否保留了订阅者的已订阅状态。用CONNECT 消息连接时，订阅者把 Clean session 标志设定为 0 或 1。0是保留 session，1 是不保留 session。
* 若指定 Clean session 为 0 且中介已经连接上了订阅者，则中介需要在订阅者断开连接后保留订阅的消息。另外，如果订阅者的连接已经断开，且发布者已经发布了 QoS 1、QoS 2 的消息给已订阅的主题时，中介则会把消息保存，等订阅者再次连接时发送给订阅者。
* 若指定 Clean session 为 1 并连接，中介就会废弃以往保留的客户端信息，将其当成一次“干净”的连接来看待。此外，订阅者断开连接时，中介也会废弃所有的信息。


第 3 章 物联网设备
==================

过去，微控制器主板的目标在于搭载单片机，实现结构的简约性和高通用性。与此同时，用在移动电话和智能手机上的高性能 CPU、完善的 I/O 端口，以及配备了网络接口的超微型计算机，即单板计算机等设备陆续登场。使用者不但能通过 Linux 操作系统来运行这些单板计算机，还能像控制以往的微控制器那样控制 I/O 引脚（pin）。微控制器主板和计算机的分界线正在逐渐模糊。

.. figure:: https://img.zhaoweiguo.com/uPic/2022/04/NguFTf.png

   微控制器主板间的比较

连接
----

有线连接::

    1. 以太网
    2. 串行通信
        采用 RS-232C 串口线等串行通信
        设备大多使用 D-SUB 9 针端口
        串口线包括直通线和交叉线两种
    3. USB

无线连接::

    1. Wi-Fi
    2. 3G/LTE
    3. 蓝牙
    4. IEEE 802.15.4/ZigBee
    5. 易能森（EnOcean）
        利用能量采集技术自主发电
        如:
          开关就是用按下开关的力量发电通信的
          温度传感器则是利用太阳光进行发电并通信的

.. figure:: https://img.zhaoweiguo.com/uPic/2022/04/o4axh4.png

   USB 的规格、传输速度及供电能力

.. figure:: https://img.zhaoweiguo.com/uPic/2022/04/fK98Gc.png

   ZigBee 的网络形式

输入-传感器
-----------

传感器的机制::

    两种感测方法:
    ①利用物理特性的传感器
    ②利用几何变异的传感器

放大传感器的信号::

    1. 反相放大电路：反转极性（把正负极反过来）并输出放大的值
    2. 差分放大电路：把两个输入电压的差值放大并输出

把模拟信号转换成数字信号::

    A/D 转换操作分成以下 3 个步骤。
    1. 采样（sampling） 用某个频率来区分模拟输入信号，获取值
    2. 量化 把采样后的值近似表现为离散值
    3. 编码（coding） 把量化后的数值编码成二进制代码





输出-驱动
---------

驱动就好比是水管的水龙头，微控制器自身只负责控制水龙头的开或关，实际流入设备的电流跟微控制器输出的电流是两股电流，需要给流入设备的电流另外准备一个电源来供给电流。最简单的驱动电路包括开关电路，它利用了一种叫作晶体管的电子器件，这种器件能控制电流。晶体管有两种类型，分别是 NPN 型晶体管和 PNP 型晶体管，因为它们类型不同，所以电流通过的路径也不同。它们都具备发射极（Emitter，简称 E）、集电极（Collector，简称 C）和基极（Base，简称 B）这 3 种端子。

.. figure:: https://img.zhaoweiguo.com/uPic/2022/04/FCX4tb.png

   以 NPN 型为例进行说明：当微控制器连接到基极，且微控制器的输出电压低（0 V）的时候，集电极与发射极之间是没有电流流过的。反过来，把基极的输出电压调高，再让电流流过，电流就会从集电极流到发射极了。这个机制非常像开关，把电流加在基极上，就能控制集电极－发射极之间的开或关。有一点很重要：即使加在基极上的电流只有小幅度的变化，也会导致晶体管切换开关状态。把大型电源连接到集电极，就能在很大程度上放大并输出基极的电流。可以通过控制微控制器的输出来令 LED 点亮或熄灭。

输出-PWM
--------

把数字信号转换成模拟信号：数字 / 模拟（D/A）转换

脉冲宽度调制（Pulse Width Modulation，简称 PWM）方式通过高速切换输出高 / 低电压来实现近似输出模拟信号，很多微控制器都采用了这个方式。

第 4 章 先进的感测技术
======================


GPS 接收器并不会向卫星发射信息，它毕竟只是一台用来接收卫星发来的无线电波的设备。

卫星发射出的无线电波中，下面两条信息尤其重要::

    1. 发射无线电波时的准确时刻
    2. 卫星在宇宙空间中的位置


先进的感测设备
--------------

1. RGB-D 传感器::

    RGB 是红（Red）、绿（Green）、蓝（Blue）
    最后的 D 是深度（Depth）
    把 RGB-D 传感器想象成测距传感器和相机的组合强化版传感器

    应用:
    a. 立体相机
    b. 点阵图判断法
    c. TOF（Time of Flight）技术

2. 自然用户界面::

    NUI（Natural User Interface）

    应用:
    a. 微软 Kinect: Xbox 360 的一种控制器
    b. Leap: 高速且精密地追踪其上方半径约 50 cm范围内的人类手指发出的动作
        其精确度最高在 0.01 mm



先进的感测系统
--------------

1. 卫星定位系统(GNSS)::

      GNSS（Global Navigation Satellite System，全球导航卫星系统）
      a. GPS
      b. 俄罗斯的 GLONASS
      c. 欧盟的 Galileo
      d. 中国的北斗

2. 准天顶卫星(RNSS)::

      RNSS（Radio Navigation Satellite System，卫星无线电导航系统）
      大致位于正上方的卫星
      只要有准天顶卫星，即使周围被大楼包围，也会有很大概率成功定位

3. IMES::

      IMES（Indoor Messaging System，室内通信系统）

4. 使用了 Wi-Fi 的定位技术::

      原理：接收信号强度
      实现：指纹定位
          记录无线电波在各个地点的状态，进行比较
          这个方法要事先测量，比较费工夫

5. Beacon::

    利用了接收信号的强度
    被用于雪山搜救方面


第 5 章 物联网服务的系统开发
============================

物联网服务开发的重点
--------------------

1. 设备::

      设备的选择
          传感器的特征
          测量误差
          法律制约
          设备的设置(设计配置, 设置场所, 设置环境)
      参数设置
          感测间隔
          传感器网络的设置

2. 处理方式设计::

    如何连接多种多样的设备
    如何应对接收数据量的增多
    分散功能(边缘计算)
    提高系统结构的牢固性

3. 网络::
   
    提升通信效率
        压缩数据
        选择协议

4. 安全性::

    安全性设计
        风险分析
        多层防御
    保护设备
        预防
        检测
        应用
    保护服务器端系统
        网关设备的认证
        数据流量的监测和制约
    保护所采集数据的隐私
        在信道上进行数据隐藏
        保护所感测数据的隐私


第 6 章 物联网与数据分析
========================

.. figure:: https://img.zhaoweiguo.com/uPic/2022/04/I4t8BQ.png

   分析的种类

.. figure:: https://img.zhaoweiguo.com/uPic/2022/04/7bY75C.png

   图表的种类和特征

第 7 章 物联网与可穿戴设备
==========================

.. figure:: https://img.zhaoweiguo.com/uPic/2022/04/CqEKS0.png

   可穿戴设备上配备的典型传感器

.. figure:: https://img.zhaoweiguo.com/uPic/2022/04/0myqe3.png

    可穿戴设备独有的特色传感器

可穿戴设备的主流形状::

    ● 头戴式显示器（以下称为 HMD 型）
        呈眼镜样式的“眼镜型”和完全挡在眼前的“护目镜型”
    ● 手表型
    ● 饰品型

使用可穿戴设备的 3 个典型目的::

    ● 显示信息
    ● 控制设备
        语音指令
        手势
        触摸面板、触摸显示屏
    ● 感测
        步数、活动量、睡眠时间
        心率
        心电波形
        脑电波
        身体特定部位的动作
            挥手和举手
            握拳和弯曲特定的手指
            眼球运动和眨眼


第 8 章 物联网与机器人
======================

* ROS（Robot Operating System，机器人操作系统）

给云机器人的诞生创造了条件::

    ①网络的低成本化和高速化→高速无线通信、光通信
    ②大数据处理能力的成熟→ Hadoop、Spark、Storm、Deep Learning
    ③机器人技术的开放→ RT 中间件、ROS











