# 2312.07104_SGLangâ‡ï¸: Efficient Execution of Structured Language Model Programs

* é¦–é¡µ: <https://arxiv.org/abs/2312.07104>
* PDF: <https://arxiv.org/pdf/2312.07104>
* å¼•ç”¨: 182(2025-08-16)
* ç»„ç»‡:
    * 1 Stanford University â€ƒ
    * 2 UC Berkeley â€ƒ
    * 3 Shanghai Jiao Tong University
    * 4 Texas A&M University â€ƒ
    * 5 Independent Researcher
* GitHub: <https://github.com/sgl-project/sglang>

* SGLang: Structured Generation Language

## æ€»ç»“

RadixAttention
* æ ¸å¿ƒæ€æƒ³
    * åœ¨è¿è¡Œæ—¶è‡ªåŠ¨ä¿ç•™å¹¶å¤ç”¨KVç¼“å­˜ï¼Œè€Œä¸æ˜¯åƒä¼ ç»Ÿæ–¹å¼é‚£æ ·åœ¨è¯·æ±‚å®Œæˆåä¸¢å¼ƒç¼“å­˜
* æ•°æ®ç»“æ„
    * ä½¿ç”¨ radix treeï¼ˆåŸºæ•°æ ‘ï¼‰ æ¥ç®¡ç†KVç¼“å­˜

é€Ÿåº¦é«˜æ•ˆçš„åŸå› 
* KV ç¼“å­˜å¤ç”¨
* è°ƒåº¦ä¼˜åŒ–
* è§£ç åŠ é€Ÿ

è´¡çŒ®
* é¦–æ¬¡æå‡ºå°†KVç¼“å­˜ï¼ˆKey-Value Cacheï¼‰è§†ä¸ºåŸºäºæ ‘ç»“æ„çš„LRUç¼“å­˜ï¼ˆLeast Recently Used Cacheï¼‰ï¼Œæ˜¯æ”¯æŒå¤šçº§å…±äº«ã€ç¼“å­˜æ„ŸçŸ¥è°ƒåº¦ã€å‰ç«¯ä¸è¿è¡Œæ—¶ååŒè°ƒåº¦ã€ä»¥åŠåˆ†å¸ƒå¼åœºæ™¯çš„é¦–ä¸ªè§£å†³æ–¹æ¡ˆã€‚




## OpenAI GPT-4æ€»ç»“

### 1. è®ºæ–‡é€Ÿè§ˆï¼ˆ20ç§’å†…å¯ç†è§£ï¼‰
ğŸ“Œ **ç ”ç©¶ç±»å‹**ï¼š
    - é¢†åŸŸæ ‡ç­¾ï¼šNLP/æœºå™¨å­¦ä¹ 
    - ä»»åŠ¡ç±»å‹ï¼šæ¨¡å‹ä¼˜åŒ–/å®éªŒåˆ†æ
ğŸŒ **ç°å®æ„ä¹‰**ï¼šè¯¥ç ”ç©¶æå‡ºäº†ä¸€ç§æ–°çš„ç³»ç»ŸSGLangï¼Œèƒ½å¤Ÿæœ‰æ•ˆæ‰§è¡Œå¤æ‚çš„è¯­è¨€æ¨¡å‹ç¨‹åºï¼Œå¯¹äºæé«˜å¤§å‹è¯­è¨€æ¨¡å‹çš„æ‰§è¡Œæ•ˆç‡å…·æœ‰é‡è¦ä»·å€¼ã€‚

### 2. æ ¸å¿ƒåˆ›æ–°ï¼ˆå¯¹æ¯”ç°æœ‰æ–¹æ³•ï¼‰
âœ¨ **æŠ€æœ¯çªç ´**ï¼š
    - æ–¹æ³•åˆ›æ–°ç‚¹ï¼šSGLangç³»ç»ŸåŒ…æ‹¬ä¸€ä¸ªå‰ç«¯è¯­è¨€å’Œä¸€ä¸ªè¿è¡Œæ—¶ï¼Œå‰ç«¯ç®€åŒ–äº†ç¼–ç¨‹è¿‡ç¨‹ï¼Œè¿è¡Œæ—¶é€šè¿‡RadixAttentionå’Œå‹ç¼©æœ‰é™çŠ¶æ€æœºç­‰ä¼˜åŒ–æŠ€æœ¯åŠ é€Ÿäº†æ‰§è¡Œè¿‡ç¨‹ã€‚
    - æ•°æ®/å®éªŒè®¾è®¡çš„ç‹¬ç‰¹æ€§ï¼šå®éªŒè¡¨æ˜ï¼ŒSGLangåœ¨å„ç§å¤§å‹è¯­è¨€å’Œå¤šæ¨¡æ€æ¨¡å‹çš„ä»»åŠ¡ä¸Šï¼Œä¸æœ€å…ˆè¿›çš„æ¨ç†ç³»ç»Ÿç›¸æ¯”ï¼Œååé‡æé«˜äº†é«˜è¾¾6.4å€ã€‚
âš ï¸ **ä½œè€…è‡ªè¿°å±€é™**ï¼šè®ºæ–‡å¹¶æœªæ˜ç¡®æåˆ°ä»»ä½•é™åˆ¶ã€‚

### 3. æ ¸å¿ƒä»·å€¼ï¼š
- è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿå¯¹è°æœ‰ç”¨ï¼Ÿ  
SGLangè§£å†³äº†å¤§å‹è¯­è¨€æ¨¡å‹æ‰§è¡Œæ•ˆç‡ä½ä¸‹çš„é—®é¢˜ï¼Œå¯¹äºéœ€è¦ä½¿ç”¨å¤§å‹è¯­è¨€æ¨¡å‹è¿›è¡Œå¤æ‚ä»»åŠ¡çš„ç ”ç©¶è€…å’Œå¼€å‘è€…æœ‰ç”¨ã€‚  
- æ–¹æ³•è®ºçš„æ–°é¢–æ€§  
SGLangçš„æ–°é¢–ä¹‹å¤„åœ¨äºå®ƒå°†è¯­è¨€æ¨¡å‹çš„æ‰§è¡Œè¿‡ç¨‹è§†ä¸ºä¸€ä¸ªç¨‹åºï¼Œé€šè¿‡å¼•å…¥æ–°çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œæé«˜äº†æ‰§è¡Œæ•ˆç‡ã€‚

### 4. ç²¾è¯»å†³ç­–æŒ‡å—
ğŸ” **æ¨èæŒ‡æ•°**ï¼šâ˜…â˜…â˜…â˜…â˜†  
å¦‚æœä½ åœ¨ç ”ç©¶å¤§å‹è¯­è¨€æ¨¡å‹çš„æ‰§è¡Œä¼˜åŒ–ï¼Œæˆ–è€…ä½ çš„å·¥ä½œéœ€è¦ä½¿ç”¨å¤§å‹è¯­è¨€æ¨¡å‹è¿›è¡Œå¤æ‚ä»»åŠ¡ï¼Œé‚£ä¹ˆè¿™ç¯‡è®ºæ–‡å€¼å¾—ä½ ä»”ç»†é˜…è¯»ã€‚

## Qwen-Plusæ€»ç»“

### 1. è®ºæ–‡é€Ÿè§ˆï¼ˆ20ç§’å†…å¯ç†è§£ï¼‰

ğŸ“Œ **ç ”ç©¶ç±»å‹**ï¼š  
- é¢†åŸŸæ ‡ç­¾ï¼š**NLP / æœºå™¨å­¦ä¹ ç³»ç»Ÿ**  
- ä»»åŠ¡ç±»å‹ï¼š**æ¨¡å‹ä¼˜åŒ– / ç³»ç»Ÿè®¾è®¡ / å®éªŒåˆ†æ**

ğŸŒ **ç°å®æ„ä¹‰**ï¼š  
SGLang æä¾›äº†ä¸€ç§é«˜æ•ˆæ‰§è¡Œå¤æ‚è¯­è¨€æ¨¡å‹ç¨‹åºçš„ç³»ç»Ÿï¼Œæ˜¾è‘—æå‡å¤šè½®ç”Ÿæˆä»»åŠ¡çš„ååé‡ï¼Œå¯¹æ„å»ºæ™ºèƒ½ä»£ç†ã€å¤šæ¨¡æ€åº”ç”¨å’Œç»“æ„åŒ–è¾“å‡ºä»»åŠ¡å…·æœ‰é‡è¦å·¥ä¸šä»·å€¼ã€‚

---

### 2. æ ¸å¿ƒåˆ›æ–°ï¼ˆå¯¹æ¯”ç°æœ‰æ–¹æ³•ï¼‰

âœ¨ **æŠ€æœ¯çªç ´**ï¼š  
- **æ–¹æ³•åˆ›æ–°ç‚¹**ï¼š
  - å¼•å…¥ **RadixAttention** æœºåˆ¶ï¼Œå®ç° KV ç¼“å­˜çš„é«˜æ•ˆå¤ç”¨ï¼Œå‡å°‘é‡å¤è®¡ç®—ã€‚
  - æå‡º **å‹ç¼©æœ‰é™çŠ¶æ€æœºï¼ˆCompressed FSMï¼‰**ï¼Œå®ç°ç»“æ„åŒ–è¾“å‡ºï¼ˆå¦‚ JSONï¼‰çš„å¿«é€Ÿè§£ç ã€‚
  - æ”¯æŒ API-only æ¨¡å‹çš„ **æ¨æµ‹æ‰§è¡Œï¼ˆSpeculative Executionï¼‰**ï¼Œä¼˜åŒ–å¤šè°ƒç”¨æµç¨‹ã€‚
- **æ•°æ®/å®éªŒè®¾è®¡çš„ç‹¬ç‰¹æ€§**ï¼š
  - åœ¨å¤šç§å¤§è¯­è¨€æ¨¡å‹ï¼ˆLlama-7B/70Bã€Mistralã€LLaVA ç­‰ï¼‰å’Œå¤šæ¨¡æ€ä»»åŠ¡ä¸Šè¿›è¡Œäº†å¹¿æ³›å®éªŒã€‚
  - å¯¹æ¯”äº†å¤šä¸ªå½“å‰ä¸»æµç³»ç»Ÿï¼ˆå¦‚ vLLMã€LMQLï¼‰ï¼Œå±•ç¤ºäº†æ˜¾è‘—æ€§èƒ½æå‡ï¼ˆæœ€é«˜ 6.4 å€ååé‡ï¼‰ã€‚

âš ï¸ **ä½œè€…è‡ªè¿°å±€é™**ï¼š  
- å½“å‰ç³»ç»Ÿä¸»è¦é¢å‘ç»“æ„åŒ–è¯­è¨€æ¨¡å‹ç¨‹åºï¼ˆLM Programsï¼‰ä¼˜åŒ–ï¼Œå¯¹éç»“æ„åŒ–ä»»åŠ¡çš„ä¼˜åŒ–æ•ˆæœæœªæ˜ç¡®è¯„ä¼°ã€‚
- ä¾èµ– Python åµŒå…¥å¼è¯­è¨€ï¼Œå¯èƒ½å¯¹é Python ç”¨æˆ·ä¸å¤Ÿå‹å¥½ã€‚

---

### 3. æ ¸å¿ƒä»·å€¼ï¼š

- **è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿå¯¹è°æœ‰ç”¨ï¼Ÿ**  
  SGLang è§£å†³äº†å½“å‰è¯­è¨€æ¨¡å‹ç¨‹åºæ‰§è¡Œæ•ˆç‡ä½ã€å¼€å‘å¤æ‚çš„é—®é¢˜ï¼Œé€‚ç”¨äºéœ€è¦å¤šè½®ç”Ÿæˆã€ç»“æ„åŒ–è¾“å‡ºã€å¤šæ¨¡æ€å¤„ç†çš„åœºæ™¯ï¼Œå¦‚æ™ºèƒ½ä»£ç†ã€å¤šæ¨¡æ€æ¨ç†ã€ç»“æ„åŒ–è¾“å‡ºç”Ÿæˆç­‰ã€‚

- **æ–¹æ³•è®ºçš„æ–°é¢–æ€§**  
  é€šè¿‡ç³»ç»Ÿæ€§åœ°åˆ©ç”¨ LM Programs çš„å¤šè°ƒç”¨ç»“æ„ï¼Œæå‡ºå‰ç«¯è¯­è¨€ + åç«¯ä¼˜åŒ–çš„åŒå±‚æ¶æ„ï¼Œå¹¶å¼•å…¥ RadixAttention å’Œ FSM è§£ç ç­‰åˆ›æ–°æŠ€æœ¯ï¼Œå®ç°äº†æ€§èƒ½ä¸å¼€å‘æ•ˆç‡çš„åŒé‡æå‡ã€‚

---

### 4. ç²¾è¯»å†³ç­–æŒ‡å—

ğŸ” **æ¨èæŒ‡æ•°**ï¼šâ˜…â˜…â˜…â˜…â˜†  
- å¦‚æœä½ æ˜¯ **NLP ç³»ç»Ÿå·¥ç¨‹å¸ˆ / å¤§æ¨¡å‹éƒ¨ç½²è€… / æ™ºèƒ½ä»£ç†å¼€å‘è€…**ï¼Œè¿™ç¯‡è®ºæ–‡å€¼å¾—ç²¾è¯»ï¼Œå°¤å…¶æ˜¯ä½ å…³æ³¨ **å¤šè°ƒç”¨è¯­è¨€æ¨¡å‹ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡**ã€‚
- å¦‚æœä½ ä¸»è¦ç ”ç©¶ **æ¨¡å‹æ¶æ„ / ç†è®ºåˆ†æ / å•æ¨¡å‹æ¨ç†**ï¼Œåˆ™å¯ç•¥è¯»æˆ–ä»…å…³æ³¨å®éªŒéƒ¨åˆ†ã€‚




## Abstract

**Abstract** éƒ¨åˆ†ä»‹ç»äº†å½“å‰å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMsï¼‰åœ¨å¤„ç†å¤æ‚ä»»åŠ¡æ—¶æ‰€é¢ä¸´çš„é—®é¢˜å’Œ SGLang ç³»ç»Ÿçš„è§£å†³æ–¹æ¡ˆã€‚

**é—®é¢˜èƒŒæ™¯**ï¼š  
å¤§è¯­è¨€æ¨¡å‹è¶Šæ¥è¶Šå¤šåœ°è¢«ç”¨äºéœ€è¦å¤šæ¬¡ç”Ÿæˆè°ƒç”¨ã€é«˜çº§æç¤ºæŠ€æœ¯ã€æ§åˆ¶æµå’Œç»“æ„åŒ–è¾“å…¥/è¾“å‡ºçš„å¤æ‚ä»»åŠ¡ã€‚ç„¶è€Œï¼Œç›®å‰ç¼ºä¹é«˜æ•ˆçš„ç³»ç»Ÿæ¥ç¼–ç¨‹å’Œæ‰§è¡Œè¿™äº›åº”ç”¨ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š  
ä¸ºæ­¤ï¼Œä½œè€…æå‡ºäº† **SGLang**ï¼Œä¸€ä¸ªé«˜æ•ˆçš„å¤æ‚è¯­è¨€æ¨¡å‹ç¨‹åºæ‰§è¡Œç³»ç»Ÿã€‚SGLang åŒ…æ‹¬ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼š

1. **å‰ç«¯è¯­è¨€**ï¼š  
   é€šè¿‡æä¾›ç”Ÿæˆå’Œå¹¶è¡Œæ§åˆ¶çš„åŸºæœ¬æ“ä½œï¼ˆprimitivesï¼‰ï¼Œç®€åŒ–ç¼–ç¨‹è¿‡ç¨‹ã€‚è¿™éƒ¨åˆ†å¼ºè°ƒäº†å‰ç«¯å¯¹å¼€å‘è€…çš„å‹å¥½æ€§ã€‚

2. **è¿è¡Œæ—¶ç³»ç»Ÿï¼ˆRuntimeï¼‰**ï¼š  
   è¿™æ˜¯ SGLang çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œé€šè¿‡ä¸€äº›åˆ›æ–°ä¼˜åŒ–æ¥åŠ é€Ÿæ‰§è¡Œï¼Œ**é‡ç‚¹åŒ…æ‹¬**ï¼š
   - **RadixAttention**ï¼šç”¨äº KV ç¼“å­˜çš„é‡ç”¨ï¼Œæé«˜æ•ˆç‡ã€‚
   - **å‹ç¼©æœ‰é™çŠ¶æ€æœº**ï¼šç”¨äºæ›´å¿«é€Ÿçš„ç»“æ„åŒ–è¾“å‡ºè§£ç ã€‚

**å®éªŒç»“æœ**ï¼š  
å®éªŒè¡¨æ˜ï¼ŒSGLang åœ¨å„ç§å¤§å‹è¯­è¨€å’Œå¤šæ¨¡æ€æ¨¡å‹ä¸Šï¼Œç›¸æ¯”æœ€å…ˆè¿›çš„æ¨ç†ç³»ç»Ÿï¼Œåœ¨å¤šä¸ªä»»åŠ¡ä¸­å®ç°äº†é«˜è¾¾ **6.4 å€çš„ååé‡æå‡**ã€‚è¿™äº›ä»»åŠ¡åŒ…æ‹¬ï¼š
- Agent æ§åˆ¶
- é€»è¾‘æ¨ç†
- å°‘æ ·æœ¬å­¦ä¹ åŸºå‡†
- JSON è§£ç 
- æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰æµç¨‹
- å¤šè½®å¯¹è¯ç­‰

**é‡ç‚¹å¼ºè°ƒ**ï¼š  
SGLang çš„åˆ›æ–°ç‚¹ä¸»è¦åœ¨äºå…¶é«˜æ•ˆçš„è¿è¡Œæ—¶ä¼˜åŒ–ï¼ˆå¦‚ RadixAttention å’Œå‹ç¼©æœ‰é™çŠ¶æ€æœºï¼‰ï¼Œä»¥åŠåœ¨å¤šç§å¤æ‚ä»»åŠ¡ä¸Šçš„æ˜¾è‘—æ€§èƒ½æå‡ï¼Œæ˜¯æœ¬æ–‡çš„æ ¸å¿ƒè´¡çŒ®ã€‚


## 1 Introduction


éšç€å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰èƒ½åŠ›çš„æå‡ï¼Œå…¶åº”ç”¨åœºæ™¯ä¹Ÿå¾—åˆ°äº†æ‰©å±•ï¼Œèƒ½å¤Ÿå¤„ç†æ›´å¹¿æ³›çš„ä¸€èˆ¬ä»»åŠ¡ï¼Œå¹¶ä½œä¸º**è‡ªä¸»ä»£ç†ï¼ˆautonomous agentsï¼‰**è¿è¡Œã€‚è¿™ç±»åº”ç”¨ä¸­ï¼ŒLLMséœ€è¦è¿›è¡Œå¤šè½®çš„**è§„åˆ’ã€æ¨ç†å’Œä¸å¤–éƒ¨ç¯å¢ƒçš„äº¤äº’**ã€‚å®ç°è¿™ä¸€ç›®æ ‡çš„å…³é”®æ–¹æ³•åŒ…æ‹¬ï¼š

- **å·¥å…·ä½¿ç”¨ï¼ˆtool usageï¼‰**ï¼šå¦‚ ToolFormer å’Œ Gorillaï¼Œé€šè¿‡è°ƒç”¨å¤–éƒ¨å·¥å…·å®Œæˆä»»åŠ¡ï¼›
- **å¤šæ¨¡æ€è¾“å…¥ï¼ˆmultiple input modalitiesï¼‰**ï¼šå¦‚ Gemini å’Œ Flamingoï¼Œæ”¯æŒå›¾åƒã€æ–‡æœ¬ç­‰å¤šç§è¾“å…¥å½¢å¼ï¼›
- **å¤šç§æç¤ºæŠ€æœ¯ï¼ˆprompting techniquesï¼‰**ï¼šå¦‚ Few-Shot Learningã€Self-Consistencyã€Skeleton-of-Thoughtã€Tree-of-Thought ç­‰ï¼Œä»¥æé«˜æ¨ç†èƒ½åŠ›ã€‚

è¿™äº›æ–°ç”¨ä¾‹é€šå¸¸éœ€è¦**å¤šæ¬¡ã€ä¾èµ–æ€§å¼ºçš„ LLM ç”Ÿæˆè°ƒç”¨**ï¼Œä½“ç°å‡ºä¸€ç§**ä½¿ç”¨å¤šè°ƒç”¨ç»“æ„ï¼ˆmulti-call structuresï¼‰æ¥å®Œæˆå¤æ‚ä»»åŠ¡**çš„è¶‹åŠ¿ï¼Œä¾‹å¦‚ REACT å’Œ LLM-Driven Workflowsã€‚

---

### è¯­è¨€æ¨¡å‹ç¨‹åºï¼ˆLM Programsï¼‰

è¿™äº›å¤šè°ƒç”¨ç»“æ„çš„åº”ç”¨ï¼Œæ ‡å¿—ç€æˆ‘ä»¬ä¸ LLM çš„äº¤äº’æ–¹å¼ä»**ç®€å•çš„èŠå¤©**è½¬å˜ä¸ºä¸€ç§**ç¨‹åºåŒ–çš„æ–¹å¼**ï¼Œå³é€šè¿‡ç¨‹åºæ¥**è°ƒåº¦å’Œæ§åˆ¶ LLM çš„ç”Ÿæˆè¿‡ç¨‹**ã€‚è¿™ç§ç¨‹åºè¢«ç§°ä¸ºâ€œ**Language Model Programsï¼ˆLM Programsï¼‰**â€ï¼Œç›¸å…³æŠ€æœ¯åŒ…æ‹¬ LMQL å’Œ DSPyã€‚

**LM Programs çš„ä¸¤ä¸ªä¸»è¦ç‰¹ç‚¹**ï¼š

1. **åŒ…å«å¤šä¸ª LLM è°ƒç”¨ï¼Œå¹¶ç»“åˆæ§åˆ¶æµ**ï¼ˆå¦‚å¾ªç¯ã€æ¡ä»¶åˆ¤æ–­ï¼‰ï¼Œç”¨äºå®Œæˆå¤æ‚ä»»åŠ¡å¹¶æé«˜æ•´ä½“è´¨é‡ï¼›
2. **è¾“å…¥å’Œè¾“å‡ºç»“æ„åŒ–**ï¼Œä¾¿äºç¨‹åºç»„åˆå’Œç³»ç»Ÿé›†æˆã€‚

---

### å½“å‰æŒ‘æˆ˜ï¼ˆChallengesï¼‰

å°½ç®¡ LM Programs è¢«å¹¿æ³›ä½¿ç”¨ï¼Œä½†ç›®å‰çš„ç³»ç»Ÿåœ¨**è¡¨è¾¾ä¸æ‰§è¡Œä¸Šä»å­˜åœ¨æ•ˆç‡é—®é¢˜**ï¼Œä¸»è¦ä½“ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼š

#### 1. **å¼€å‘éš¾åº¦å¤§**

- LLM çš„è¾“å‡ºå…·æœ‰**éç¡®å®šæ€§**ï¼Œç¼–å†™ LM Programs éœ€è¦è¿›è¡Œå¤§é‡çš„**å­—ç¬¦ä¸²å¤„ç†ã€æç¤ºè°ƒä¼˜ã€è¾“å‡ºè§£æ**ï¼›
- æ”¯æŒ**å¤šæ¨¡æ€è¾“å…¥**å’Œ**å¹¶è¡Œæœºåˆ¶**ï¼Œå¢åŠ äº†ç¨‹åºå¤æ‚æ€§ï¼›
- ä½¿å¾—å³ä½¿æ˜¯ç®€å•çš„ç¨‹åºä¹Ÿéš¾ä»¥è¢«æ¸…æ™°è¡¨è¾¾å’Œç»´æŠ¤ã€‚

#### 2. **æ‰§è¡Œæ•ˆç‡ä½**

å½“å‰ä¸»æµçš„ LLM æ¨ç†å¼•æ“ï¼ˆå¦‚ vLLMã€TGIã€TensorRT-LLMï¼‰è™½ç„¶ä¼˜åŒ–äº†**å»¶è¿Ÿå’Œååé‡**ï¼Œä½†å®ƒä»¬ç¼ºä¹å¯¹**å·¥ä½œè´Ÿè½½ç»“æ„çš„äº†è§£**ï¼Œå¯¼è‡´æ‰§è¡Œæ•ˆç‡ä½ä¸‹ã€‚å…·ä½“è¡¨ç°å¦‚ä¸‹ï¼š

- **KV ç¼“å­˜ï¼ˆKV Cacheï¼‰æ— æ³•å¤ç”¨**ï¼šå¤šä¸ª LLM è°ƒç”¨ä¹‹é—´å¯èƒ½å…±äº«å‰ç¼€ï¼Œä½†å½“å‰ç³»ç»Ÿæ— æ³•æœ‰æ•ˆå¤ç”¨ç¼“å­˜ï¼Œå¯¼è‡´é‡å¤è®¡ç®—å’Œå†…å­˜æµªè´¹ï¼›
- **çº¦æŸè§£ç æ•ˆç‡ä½**ï¼šåœ¨ç”Ÿæˆç»“æ„åŒ–è¾“å‡ºï¼ˆå¦‚ JSONï¼‰æ—¶ï¼Œåªèƒ½é€ä¸ªè§£ç  tokensï¼Œæ•ˆç‡ä½ä¸‹ã€‚

---

### SGLangï¼šè§£å†³æ–¹æ¡ˆ

ä¸ºè§£å†³ä¸Šè¿°é—®é¢˜ï¼Œæœ¬æ–‡æå‡ºäº† **SGLangï¼ˆStructured Generation Languageï¼‰**ï¼Œä¸€ç§ç”¨äº LLM çš„ç»“æ„åŒ–ç”Ÿæˆè¯­è¨€ã€‚SGLang çš„æ ¸å¿ƒæ€æƒ³æ˜¯**ç³»ç»ŸåŒ–åœ°åˆ©ç”¨ LM Programs ä¸­çš„å¤šè°ƒç”¨ç»“æ„**æ¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚

SGLang åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼š

- **å‰ç«¯è¯­è¨€**ï¼šç®€åŒ– LM Programs çš„ç¼–ç¨‹ï¼›
- **åç«¯è¿è¡Œæ—¶**ï¼šåŠ é€Ÿå…¶æ‰§è¡Œã€‚

è¿™ä¸¤éƒ¨åˆ†å¯ååŒå·¥ä½œï¼Œä¹Ÿå¯ç‹¬ç«‹ä½¿ç”¨ã€‚

#### å‰ç«¯è¯­è¨€ï¼ˆFront-endï¼‰

SGLang æ˜¯ä¸€ç§åµŒå…¥åœ¨ Python ä¸­çš„**é¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆDSLï¼‰**ï¼Œæä¾›ä»¥ä¸‹å…³é”®æ“ä½œï¼š

- **ç”ŸæˆåŸè¯­**ï¼ˆå¦‚ `extend`ã€`gen`ã€`select`ï¼‰ï¼›
- **å¹¶è¡Œæ§åˆ¶**ï¼ˆå¦‚ `fork`ã€`join`ï¼‰ï¼›
- æ”¯æŒ Python çš„æ§åˆ¶æµå’Œåº“ï¼Œä¾¿äºå¼€å‘å¤æ‚æç¤ºæµç¨‹ã€‚

SGLang æä¾›äº†**è§£é‡Šå™¨ä¸ç¼–è¯‘å™¨**ï¼Œå…¶ä¸­è§£é‡Šå™¨é€šè¿‡å¼‚æ­¥æ‰§è¡ŒåŸè¯­æ“ä½œï¼Œç®¡ç†ç¨‹åºçš„åŒæ­¥å’Œå¹¶è¡Œã€‚

#### åç«¯è¿è¡Œæ—¶ä¼˜åŒ–ï¼ˆRuntime Optimizationsï¼‰

SGLang åœ¨è¿è¡Œæ—¶å¼•å…¥äº†ä¸‰ç§å…³é”®ä¼˜åŒ–æŠ€æœ¯ï¼š

1. **RadixAttentionï¼ˆåŸºæ•°æ³¨æ„åŠ›ï¼‰**ï¼š
   - è§£å†³ KV ç¼“å­˜å¤ç”¨é—®é¢˜ï¼›
   - é€šè¿‡**åŸºæ•°æ ‘ï¼ˆradix treeï¼‰ç®¡ç†ç¼“å­˜**ï¼Œæ”¯æŒé«˜æ•ˆåŒ¹é…ã€æ’å…¥å’Œé©±é€ï¼›
   - å¯è‡ªåŠ¨è¯†åˆ«å¹¶å¤ç”¨å¤šä¸ªè°ƒç”¨ä¸­å…±äº«çš„ç¼“å­˜ï¼Œæå‡æ‰§è¡Œæ•ˆç‡ã€‚

2. **å‹ç¼©æœ‰é™çŠ¶æ€æœºï¼ˆCompressed Finite State Machineï¼‰**ï¼š
   - ç”¨äº**ç»“æ„åŒ–è¾“å‡ºçš„è§£ç åŠ é€Ÿ**ï¼ˆå¦‚ JSONï¼‰ï¼›
   - ä¼ ç»Ÿç³»ç»Ÿåªèƒ½é€ä¸ª token è§£ç ï¼Œè€Œ SGLang é€šè¿‡æ„å»ºå‹ç¼©çŠ¶æ€æœºï¼Œ**å°†å¤šä¸ª token è§£ç è·¯å¾„å‹ç¼©ä¸ºä¸€æ­¥**ï¼Œå®ç°å¹¶è¡Œè§£ç ã€‚

3. **API æ¨æµ‹æ‰§è¡Œï¼ˆAPI Speculative Executionï¼‰**ï¼š
   - ä¸ºä»…æä¾› API æ¥å£çš„æ¨¡å‹ï¼ˆå¦‚ GPT-4ï¼‰ä¼˜åŒ–å¤šè°ƒç”¨ç¨‹åºæ‰§è¡Œã€‚

---

### åº”ç”¨ä¸å®éªŒç»“æœï¼ˆApplications and Evaluationï¼‰

SGLang å·²è¢«åº”ç”¨äºå¤šä¸ª LLM åœºæ™¯ï¼ŒåŒ…æ‹¬ï¼š

- ä»£ç†æ§åˆ¶ã€é€»è¾‘æ¨ç†ã€few-shot å­¦ä¹ åŸºå‡†ã€JSON è§£ç ã€æ£€ç´¢å¢å¼ºç”Ÿæˆã€å¤šè½®å¯¹è¯ã€å¤šæ¨¡æ€å¤„ç†ç­‰ã€‚

åœ¨å¤šä¸ªæ¨¡å‹ï¼ˆå¦‚ Llama-7B/70Bã€Mistral-8x7Bã€LLaVA ç³»åˆ—ï¼‰å’Œ GPU ç¡¬ä»¶ï¼ˆA10G/A100ï¼‰ä¸Šæµ‹è¯•ï¼Œ**SGLang ç›¸æ¯”ç°æœ‰ç³»ç»Ÿï¼ˆGuidanceã€vLLMã€LMQLï¼‰çš„ååé‡æœ€é«˜æå‡äº† 6.4 å€**ã€‚

---

### æ€»ç»“ï¼ˆé‡ç‚¹ï¼‰

- **LLMs æ­£ä»èŠå¤©å·¥å…·æ¼”è¿›ä¸ºç¨‹åºåŒ–å·¥å…·**ï¼Œé€šè¿‡ LM Programs å®ç°å¤æ‚ä»»åŠ¡çš„è‡ªåŠ¨åŒ–å¤„ç†ï¼›
- å½“å‰çš„ LM Programs **å¼€å‘å¤æ‚ã€æ‰§è¡Œæ•ˆç‡ä½**ï¼Œä¸»è¦é—®é¢˜åŒ…æ‹¬ KV ç¼“å­˜å¤ç”¨å’Œç»“æ„åŒ–è§£ç æ•ˆç‡ï¼›
- SGLang é€šè¿‡**ç»“æ„åŒ–è¯­è¨€ + é«˜æ•ˆè¿è¡Œæ—¶ä¼˜åŒ–**ï¼Œè§£å†³äº†ä¸Šè¿°é—®é¢˜ï¼Œæ˜¾è‘—æå‡äº†æ‰§è¡Œæ•ˆç‡ï¼›
- å®éªŒè¡¨æ˜ï¼ŒSGLang åœ¨å¤šæ¨¡å‹ã€å¤šä»»åŠ¡ã€å¤šç¡¬ä»¶ç¯å¢ƒä¸‹çš„**æ€§èƒ½ä¼˜åŠ¿æ˜¾è‘—**ã€‚


## 2 Programming Model

![](https://img.zhaoweiguo.com/uPic/2025/08/zr0MQq.png)

Figure 2:The implementation of a multi-dimensional essay judge in SGLang utilizes the branch-solve-merge prompting technique saha2023branch. Primitives provided by SGLang are shown in red.


æœ¬èŠ‚ä»‹ç»äº† **SGLang ç¼–ç¨‹æ¨¡å‹**ï¼Œé€šè¿‡**è¿è¡Œç¤ºä¾‹**å±•ç¤ºäº†å…¶è¯­è¨€åŸè¯­ä¸æ‰§è¡Œæ¨¡å¼ï¼Œå¹¶æ¦‚è¿°äº†**è¿è¡Œæ—¶ä¼˜åŒ–**çš„æ½œåŠ›ã€‚è¯¥ç¼–ç¨‹æ¨¡å‹é€šè¿‡æä¾›çµæ´»ä¸”å¯ç»„åˆçš„åŸè¯­ï¼Œç®€åŒ–äº†å¤šè½®è°ƒç”¨å·¥ä½œæµä¸­çš„ç¹çæ“ä½œï¼ˆä¾‹å¦‚å­—ç¬¦ä¸²æ“ä½œã€API è°ƒç”¨ã€çº¦æŸå®šä¹‰ã€å¹¶è¡ŒåŒ–ç­‰ï¼‰ã€‚

---

### ä¸€ä¸ªè¿è¡Œç¤ºä¾‹

SGLang æ˜¯ä¸€ä¸ª**åµŒå…¥åœ¨ Python ä¸­çš„é¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆDSLï¼‰**ã€‚å›¾ 2 å±•ç¤ºäº†ä¸€ä¸ªä½¿ç”¨ **branch-solve-merge æç¤ºæŠ€æœ¯** çš„å¤šç»´ä½œæ–‡è¯„åˆ†ç¨‹åºã€‚

å‡½æ•° `multi_dimensional_judge` æœ‰ä¸‰ä¸ªå‚æ•°ï¼š`s`ï¼ˆæç¤ºçŠ¶æ€ï¼‰ã€`path`ï¼ˆå›¾åƒè·¯å¾„ï¼‰å’Œ `essay`ï¼ˆä½œæ–‡æ–‡æœ¬ï¼‰ã€‚é€šè¿‡ `+=` æ“ä½œç¬¦ï¼Œå¯ä»¥å°†å­—ç¬¦ä¸²å’Œ SGLang åŸè¯­æ·»åŠ åˆ°çŠ¶æ€ `s` ä¸­ä»¥æ‰§è¡Œã€‚

ç¨‹åºçš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š

1. å°†å›¾åƒå’Œä½œæ–‡æ·»åŠ åˆ°æç¤ºä¸­ï¼›
2. ä½¿ç”¨ `select` åˆ¤æ–­ä½œæ–‡æ˜¯å¦ä¸å›¾åƒç›¸å…³ï¼Œç»“æœå­˜å‚¨åœ¨ `s["related"]`ï¼›
3. å¦‚æœç›¸å…³ï¼Œæç¤ºè¢«â€œåˆ†æ”¯â€ä¸ºä¸‰ä¸ªå‰¯æœ¬ï¼Œ**å¹¶è¡Œè¯„ä¼°ä¸åŒç»´åº¦**ï¼Œä½¿ç”¨ `gen` å­˜å‚¨ç»“æœåˆ° `f["judgment"]`ï¼›
4. åˆå¹¶åˆ¤æ–­ç»“æœï¼Œç”Ÿæˆæ‘˜è¦å¹¶ç»™å‡ºå­—æ¯ç­‰çº§ï¼›
5. æœ€ç»ˆè¿”å›ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼çº¦æŸçš„ JSON æ ¼å¼ç»“æœã€‚

**é‡ç‚¹**ï¼šSGLang æ˜¾è‘—ç®€åŒ–äº†è¿™ç±»ç¨‹åºçš„ç¼–å†™ã€‚è‹¥ä½¿ç”¨ OpenAI API ç±»æ¥å£å®ç°ç›¸åŒåŠŸèƒ½ï¼Œéœ€è¦ 2.1 å€çš„ä»£ç è¡Œæ•°ï¼Œå› ä¸ºéœ€è¦æ‰‹åŠ¨å¤„ç†å­—ç¬¦ä¸²å’Œå¹¶è¡Œæ§åˆ¶ã€‚

---

### è¯­è¨€åŸè¯­

SGLang æä¾›äº†æ§åˆ¶æç¤ºçŠ¶æ€ã€ç”Ÿæˆå’Œå¹¶è¡ŒåŒ–çš„åŸè¯­ï¼Œå¹¶å¯ä¸ Python è¯­æ³•å’Œåº“ç»“åˆä½¿ç”¨ã€‚ä¸»è¦åŸè¯­åŒ…æ‹¬ï¼š

- **gen**: è°ƒç”¨æ¨¡å‹ç”Ÿæˆå†…å®¹ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨æŒ‡å®šå˜é‡ä¸­ã€‚æ”¯æŒé€šè¿‡ `regex` å‚æ•°å¯¹è¾“å‡ºæ–½åŠ çº¦æŸï¼ˆå¦‚ JSON Schemaï¼‰ã€‚
- **select**: è°ƒç”¨æ¨¡å‹ä»é€‰é¡¹åˆ—è¡¨ä¸­é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„é€‰é¡¹ã€‚
- **+= / extend**: å°†å­—ç¬¦ä¸²è¿½åŠ åˆ°æç¤ºä¸­ã€‚
- **[variable_name]**: è·å–ç”Ÿæˆç»“æœã€‚
- **fork / join**: åˆ›å»ºå¹¶é‡æ–°åˆå¹¶æç¤ºçŠ¶æ€çš„å¹¶è¡Œåˆ†æ”¯ã€‚
- **image / video**: æ¥æ”¶å›¾åƒå’Œè§†é¢‘è¾“å…¥ã€‚

**é‡ç‚¹**ï¼šè¿™äº›åŸè¯­æä¾›äº†å¯¹æç¤ºçŠ¶æ€çš„ç»†ç²’åº¦æ§åˆ¶ï¼Œæ˜¯ SGLang çš„æ ¸å¿ƒèƒ½åŠ›ä¹‹ä¸€ã€‚

---

### æ‰§è¡Œæ¨¡å¼

SGLang ç¨‹åºå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ‰§è¡Œï¼š

1. **è§£é‡Šå™¨æ¨¡å¼**ï¼šå°†æç¤ºè§†ä¸ºå¼‚æ­¥æµï¼Œ`extend`ã€`gen`ã€`select` ç­‰åŸè¯­æäº¤åˆ°æµä¸­å¼‚æ­¥æ‰§è¡Œã€‚éé˜»å¡è°ƒç”¨å…è®¸ Python ä»£ç ç»§ç»­è¿è¡Œã€‚æ¯ä¸ªæç¤ºç”±åå°çº¿ç¨‹ä¸­çš„æµæ‰§è¡Œå™¨ç®¡ç†ï¼Œæ”¯æŒç¨‹åºå†…çš„å¹¶è¡Œæ€§ã€‚è·å–ç”Ÿæˆç»“æœå°†é˜»å¡ï¼Œç›´åˆ°ç»“æœå°±ç»ªã€‚

   **ç±»æ¯”**ï¼šè¿™ç§æ–¹å¼ç±»ä¼¼äºå¼‚æ­¥å¯åŠ¨ CUDA å†…æ ¸ã€‚

2. **ç¼–è¯‘æ¨¡å¼**ï¼šç¨‹åºå¯ç¼–è¯‘ä¸ºè®¡ç®—å›¾ï¼Œé€šè¿‡å›¾æ‰§è¡Œå™¨è¿è¡Œï¼Œä»è€Œå®ç°æ›´å¤šä¼˜åŒ–ã€‚æœ¬æ–‡é»˜è®¤ä½¿ç”¨è§£é‡Šå™¨æ¨¡å¼ï¼Œç¼–è¯‘æ¨¡å¼çš„è¯„ä¼°ç»“æœè§é™„å½• Dã€‚

æ­¤å¤–ï¼ŒSGLang æ”¯æŒå¼€æºæ¨¡å‹ï¼ˆé€šè¿‡å…¶è‡ªç ”è¿è¡Œæ—¶ SRTï¼‰å’Œ API æ¨¡å‹ï¼ˆå¦‚ OpenAI å’Œ Anthropicï¼‰ã€‚

---

### ä¸å…¶ä»–ç³»ç»Ÿçš„æ¯”è¾ƒ

LLM ç¼–ç¨‹ç³»ç»Ÿå¯åˆ†ä¸ºä¸¤ç±»ï¼š

- **é«˜å±‚ç³»ç»Ÿ**ï¼šå¦‚ LangChainã€DSPyï¼Œæä¾›é¢„å®šä¹‰æˆ–è‡ªåŠ¨ç”Ÿæˆçš„æç¤ºã€‚ä¾‹å¦‚ï¼ŒDSPy æœ‰æç¤ºä¼˜åŒ–å™¨ã€‚
- **ä½å±‚ç³»ç»Ÿ**ï¼šå¦‚ LMQLã€Guidanceã€SGLangï¼Œä¸æ”¹å˜æç¤ºï¼Œå…è®¸ç›´æ¥æ“ä½œæç¤ºå’ŒåŸè¯­ã€‚

SGLang å±äºä½å±‚ç³»ç»Ÿï¼Œ**æ›´å¤šå…³æ³¨è¿è¡Œæ—¶æ•ˆç‡**ï¼Œå¹¶é…æœ‰ä¸“é—¨è®¾è®¡çš„è¿è¡Œæ—¶ï¼Œæ”¯æŒæœ¬æ–‡åç»­ä»‹ç»çš„æ–°é¢–ä¼˜åŒ–ã€‚é«˜å±‚è¯­è¨€ï¼ˆå¦‚ DSPyï¼‰å¯ä»¥ç¼–è¯‘ä¸ºä½å±‚è¯­è¨€ï¼ˆå¦‚ SGLangï¼‰ã€‚ç¬¬ 6 èŠ‚å±•ç¤ºäº†å°† SGLang ä½œä¸º DSPy åç«¯çš„ä¾‹å­ã€‚

è¡¨ 1 å¯¹æ¯”äº† LMQLã€Guidance å’Œ SGLang çš„ç‰¹æ€§ï¼š

| ç³»ç»Ÿ     | è¯­æ³•     | è¯­è¨€åŸè¯­                                 | è¿è¡Œæ—¶åç«¯                                  |
|----------|----------|------------------------------------------|---------------------------------------------|
| LMQL     | è‡ªå®šä¹‰   | extend, gen, select                      | HF Transformers, llama.cpp, OpenAI          |
| Guidance | Python   | extend, gen, select, image               | HF Transformers, llama.cpp, OpenAI          |
| SGLang   | Python   | extend, gen, select, image, video, fork, join | SGLang Runtime (SRT), OpenAI               |

**é‡ç‚¹**ï¼šSGLang æä¾›äº†æ›´ä¸°å¯Œçš„å¹¶è¡Œæ§åˆ¶èƒ½åŠ›ï¼ˆå¦‚ `fork`/`join`ï¼‰ï¼Œå¹¶æœ‰è‡ªå·±çš„é«˜æ•ˆè¿è¡Œæ—¶ã€‚

---

### è¿è¡Œæ—¶ä¼˜åŒ–

å›¾ 2 ä¸­å±•ç¤ºäº†ä¸‰ä¸ªè¿è¡Œæ—¶ä¼˜åŒ–æœºä¼šï¼š

- **KV ç¼“å­˜é‡ç”¨**
- **å¿«é€Ÿçº¦æŸè§£ç **
- **API æ¨æµ‹æ‰§è¡Œ**

è¿™äº›ä¼˜åŒ–å°†åœ¨åç»­ç« èŠ‚ä¸­è¯¦ç»†è®¨è®ºã€‚


## 3 Efficient KV Cache Reuse with RadixAttention


æœ¬èŠ‚ä»‹ç»äº† **RadixAttention**ï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºåœ¨è¿è¡Œæ—¶è‡ªåŠ¨ã€ç³»ç»Ÿæ€§åœ°å¤ç”¨KVç¼“å­˜ï¼ˆKey-Value Cacheï¼‰çš„æ–°æŠ€æœ¯ã€‚è¯¥æ–¹æ³•æ—¨åœ¨ä¼˜åŒ–SGLangç¨‹åºä¸­å¤šä¸ªç”Ÿæˆè°ƒç”¨å’Œå®ä¾‹ä¹‹é—´çš„KVç¼“å­˜å¤ç”¨ï¼Œä»è€Œå‡å°‘é‡å¤è®¡ç®—å’Œå†…å­˜å ç”¨ã€‚

---

### **KVç¼“å­˜å¤ç”¨çš„èƒŒæ™¯ä¸æŒ‘æˆ˜**

åœ¨å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„æ¨ç†è¿‡ç¨‹ä¸­ï¼Œ**KVç¼“å­˜**å­˜å‚¨äº†å‰å‘ä¼ æ’­è¿‡ç¨‹ä¸­çš„ä¸­é—´å¼ é‡ï¼Œå¹¶ç”¨äºè§£ç åç»­çš„tokenã€‚ç”±äºKVç¼“å­˜çš„è®¡ç®—ä»…ä¾èµ–äºå‰ç¼€tokenï¼Œå› æ­¤å…·æœ‰ç›¸åŒå‰ç¼€æç¤ºçš„ä¸åŒè¯·æ±‚å¯ä»¥å…±äº«KVç¼“å­˜ã€‚è¿™ä¸€ç‰¹æ€§å¸¦æ¥äº†å¾ˆå¤šç¼“å­˜å¤ç”¨çš„æœºä¼šã€‚

ç„¶è€Œï¼Œç°æœ‰ç³»ç»Ÿåœ¨å¤„ç†KVç¼“å­˜å¤ç”¨æ—¶å­˜åœ¨å±€é™æ€§ã€‚ä¾‹å¦‚ï¼Œå®ƒä»¬é€šå¸¸éœ€è¦**æ‰‹åŠ¨é…ç½®**ï¼Œä¸”éš¾ä»¥å¤„ç†**åŠ¨æ€æ ‘ç»“æ„**ç­‰å¤æ‚æ¨¡å¼ã€‚å› æ­¤ï¼Œå¤§å¤šæ•°ç³»ç»Ÿé€‰æ‹©**é‡æ–°è®¡ç®—KVç¼“å­˜**ï¼Œè€Œä¸æ˜¯å¤ç”¨ï¼Œè¿™å¯¼è‡´äº†æ€§èƒ½å’Œèµ„æºçš„æµªè´¹ã€‚

---

### **RadixAttention çš„æ ¸å¿ƒæ€æƒ³ä¸å®ç°**

**RadixAttention** çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**åœ¨è¿è¡Œæ—¶è‡ªåŠ¨ä¿ç•™å¹¶å¤ç”¨KVç¼“å­˜**ï¼Œè€Œä¸æ˜¯åƒä¼ ç»Ÿæ–¹å¼é‚£æ ·åœ¨è¯·æ±‚å®Œæˆåä¸¢å¼ƒç¼“å­˜ã€‚

- **æ•°æ®ç»“æ„**ï¼šç³»ç»Ÿä½¿ç”¨ **radix treeï¼ˆåŸºæ•°æ ‘ï¼‰** æ¥ç®¡ç†KVç¼“å­˜ã€‚è¿™æ˜¯ä¸€ç§é«˜æ•ˆçš„ç©ºé—´å‹ç¼©æ ‘ç»“æ„ï¼Œæ”¯æŒå¿«é€Ÿçš„å‰ç¼€åŒ¹é…ã€æ’å…¥å’Œå¤ç”¨ã€‚
- **ç¼“å­˜å­˜å‚¨æ–¹å¼**ï¼šKVç¼“å­˜ä»¥â€œåˆ†é¡µâ€æ–¹å¼å­˜å‚¨ï¼Œæ¯é¡µå¯¹åº”ä¸€ä¸ªtokenã€‚è¿™æ ·å¯ä»¥çµæ´»ç®¡ç†GPUå†…å­˜ã€‚
- **å†…å­˜ç®¡ç†ç­–ç•¥**ï¼š
  - é‡‡ç”¨ **LRUï¼ˆLeast Recently Usedï¼‰** ç­–ç•¥è¿›è¡Œç¼“å­˜æ·˜æ±°ï¼Œä¼˜å…ˆæ·˜æ±°æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„å¶èŠ‚ç‚¹ã€‚
  - èŠ‚ç‚¹ç»´æŠ¤**å¼•ç”¨è®¡æ•°å™¨**ï¼Œåªæœ‰å½“å¼•ç”¨è®¡æ•°ä¸º0æ—¶æ‰å¯è¢«å›æ”¶ã€‚
  - ç³»ç»Ÿ**ä¸é¢„å…ˆåˆ†é…å›ºå®šå¤§å°çš„ç¼“å­˜æ± **ï¼Œè€Œæ˜¯ä¸æ­£åœ¨è¿è¡Œçš„è¯·æ±‚**å…±äº«åŒä¸€å—å†…å­˜æ± **ï¼Œå®ç°åŠ¨æ€å†…å­˜åˆ†é…ã€‚

- **å‰ç«¯æç¤ºæœºåˆ¶**ï¼ˆFrontend Hintï¼‰ï¼šå‰ç«¯åœ¨æ‰§è¡Œ `fork` æ“ä½œæ—¶ï¼Œä¼šå…ˆå‘é€å‰ç¼€æç¤ºï¼Œå¸®åŠ©è¿è¡Œæ—¶å¿«é€Ÿå»ºç«‹æ ‘ç»“æ„ï¼Œä»è€Œæå‡åŒ¹é…æ•ˆç‡ã€‚

- **å›¾ç¤ºè¯´æ˜**ï¼ˆè§å›¾3ï¼‰ï¼šæ¼”ç¤ºäº†å¤šä¸ªè¯·æ±‚åœ¨ä¸åŒæ—¶åˆ»çš„radixæ ‘æ¼”åŒ–è¿‡ç¨‹ï¼ŒåŒ…æ‹¬æ’å…¥ã€å¤ç”¨ã€åˆ†è£‚å’Œæ·˜æ±°ç­‰æ“ä½œã€‚

![](https://img.zhaoweiguo.com/uPic/2025/08/SL2IYm.png)

Figure 3: Examples of RadixAttention operations with an LRU eviction policy, illustrated across nine time points. 

* å›¾è§£
    * æ¯æ¡æ ‘è¾¹éƒ½å¸¦æœ‰ä¸€ä¸ªæ ‡ç­¾ï¼Œ
        * è¡¨ç¤ºä¸€ä¸ªå­å­—ç¬¦ä¸²æˆ–ä¸€ä¸ªæ ‡è®°åºåˆ—
    * èŠ‚ç‚¹é‡‡ç”¨é¢œè‰²ç¼–ç ä»¥åæ˜ ä¸åŒçš„çŠ¶æ€ï¼š
        * ç»¿è‰²è¡¨ç¤ºæ–°æ·»åŠ çš„èŠ‚ç‚¹ï¼Œ
        * è“è‰²è¡¨ç¤ºåœ¨è¯¥æ—¶é—´ç‚¹è®¿é—®è¿‡çš„ç¼“å­˜èŠ‚ç‚¹ï¼Œ
        * çº¢è‰²è¡¨ç¤ºå·²è¢«é©±é€çš„èŠ‚ç‚¹ã€‚
    * æ­¥éª¤è¯¦è§£
        * åœ¨æ­¥éª¤ (1) ä¸­ï¼ŒåŸºæ•°æ ‘æœ€åˆä¸ºç©ºã€‚
        * åœ¨æ­¥éª¤ (2) ä¸­ï¼ŒæœåŠ¡å™¨å¤„ç†ä¼ å…¥çš„ç”¨æˆ·æ¶ˆæ¯â€œHelloâ€ï¼Œå¹¶ä»¥ LLM è¾“å‡ºâ€œHiâ€è¿›è¡Œå“åº”ã€‚ç³»ç»Ÿæç¤ºâ€œYou are a helpful assistanceâ€ï¼ˆæ‚¨æ˜¯ä¸€ä½ä¹äºåŠ©äººçš„åŠ©æ‰‹ï¼‰ã€ç”¨æˆ·æ¶ˆæ¯â€œHello!â€å’Œ LLM å›å¤â€œHi!â€è¢«åˆå¹¶åˆ°æ ‘ä¸­ï¼Œä½œä¸ºä¸€æ¡æŒ‡å‘æ–°èŠ‚ç‚¹çš„è¾¹ã€‚
        * åœ¨æ­¥éª¤ (3) ä¸­ï¼Œä¸€ä¸ªæ–°çš„æç¤ºåˆ°è¾¾ï¼ŒæœåŠ¡å™¨åœ¨åŸºæ•°æ ‘ä¸­æ‰¾åˆ°è¯¥æç¤ºçš„å‰ç¼€ï¼ˆå³å¯¹è¯çš„ç¬¬ä¸€ä¸ªè½®æ¬¡ï¼‰ï¼Œå¹¶é‡ç”¨å…¶é”®å€¼ç¼“å­˜ã€‚æ–°çš„è½®æ¬¡å°†ä½œä¸ºæ–°èŠ‚ç‚¹é™„åŠ åˆ°åŸºæ•°æ ‘ä¸­ã€‚
        * åœ¨æ­¥éª¤ (4) ä¸­ï¼Œå¼€å§‹ä¸€ä¸ªæ–°çš„èŠå¤©ä¼šè¯ã€‚æ­¥éª¤ (3) ä¸­çš„èŠ‚ç‚¹â€œbâ€è¢«æ‹†åˆ†ä¸ºä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä»¥å…è®¸ä¸¤ä¸ªèŠå¤©ä¼šè¯å…±äº«ç³»ç»Ÿæç¤ºã€‚
        * åœ¨æ­¥éª¤ (5) ä¸­ï¼Œç¬¬äºŒä¸ªèŠå¤©ä¼šè¯ç»§ç»­è¿›è¡Œã€‚ä½†æ˜¯ï¼Œç”±äºå†…å­˜é™åˆ¶ï¼Œæ­¥éª¤ (4) ä¸­çš„èŠ‚ç‚¹â€œcâ€å¿…é¡»è¢«ç§»é™¤ã€‚æ–°çš„è½®æ¬¡å°†é™„åŠ åˆ°æ­¥éª¤ (4) ä¸­çš„èŠ‚ç‚¹â€œdâ€ä¹‹åã€‚
        * åœ¨æ­¥éª¤ (6) ä¸­ï¼ŒæœåŠ¡å™¨æ¥æ”¶ä¸€ä¸ªå°‘æ ·æœ¬å­¦ä¹ æŸ¥è¯¢ï¼Œå¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œå¹¶å°†å…¶æ’å…¥åˆ°æ ‘ä¸­ã€‚ç”±äºæ–°æŸ¥è¯¢ä¸ç°æœ‰èŠ‚ç‚¹ä¸å…±äº«ä»»ä½•å‰ç¼€ï¼Œå› æ­¤æ ¹èŠ‚ç‚¹è¢«æ‹†åˆ†ã€‚
        * åœ¨æ­¥éª¤ (7) ä¸­ï¼ŒæœåŠ¡å™¨æ¥æ”¶ä¸€æ‰¹é¢å¤–çš„å°‘æ ·æœ¬å­¦ä¹ æŸ¥è¯¢ã€‚ è¿™äº›æŸ¥è¯¢å…±äº«åŒä¸€ç»„å°æ ·æœ¬ç¤ºä¾‹ï¼Œå› æ­¤æˆ‘ä»¬å°†èŠ‚ç‚¹â€œeâ€ä» (6) ä¸­æ‹†åˆ†å‡ºæ¥ä»¥å®ç°å…±äº«ã€‚
        * åœ¨æ­¥éª¤ (8) ä¸­ï¼ŒæœåŠ¡å™¨ä»ç¬¬ä¸€ä¸ªèŠå¤©ä¼šè¯æ”¶åˆ°ä¸€æ¡æ–°æ¶ˆæ¯ã€‚å®ƒä¼šé©±é€ç¬¬äºŒä¸ªèŠå¤©ä¼šè¯ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ˆèŠ‚ç‚¹â€œgâ€å’Œâ€œhâ€ï¼‰ï¼Œå› ä¸ºå®ƒä»¬æ˜¯æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ã€‚
        * åœ¨æ­¥éª¤ (9) ä¸­ï¼ŒæœåŠ¡å™¨æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚ï¼Œè¦æ±‚ä» (8) ä¸­ä¸ºèŠ‚ç‚¹â€œjâ€ä¸­çš„é—®é¢˜é‡‡æ ·æ›´å¤šç­”æ¡ˆï¼Œè¿™å¯èƒ½æ˜¯ä¸ºäº†å®ç°è‡ªæ´½æ€§æç¤ºã€‚ä¸ºäº†ç»™è¿™äº›è¯·æ±‚è…¾å‡ºç©ºé—´ï¼Œæˆ‘ä»¬é©±é€äº† (8) ä¸­çš„èŠ‚ç‚¹â€œiâ€ã€â€œkâ€å’Œâ€œlâ€ã€‚

---

### **ç¼“å­˜æ„ŸçŸ¥è°ƒåº¦ç­–ç•¥ï¼ˆCache-aware Schedulingï¼‰**

ä¸ºäº†æœ€å¤§åŒ–KVç¼“å­˜çš„å‘½ä¸­ç‡ï¼Œç³»ç»Ÿå¼•å…¥äº†**ç¼“å­˜æ„ŸçŸ¥è°ƒåº¦ç®—æ³•**ã€‚

- **å®šä¹‰**ï¼šç¼“å­˜å‘½ä¸­ç‡ = å·²ç¼“å­˜çš„æç¤ºtokenæ•° / æ€»æç¤ºtokenæ•°ã€‚
    - (number of cached prompt tokens)/(number of prompt tokens)
- **è°ƒåº¦åŸåˆ™**ï¼š
  - åœ¨æ‰¹å¤„ç†åœºæ™¯ä¸­ï¼Œ**æŒ‰æœ€é•¿å…±äº«å‰ç¼€ä¼˜å…ˆ**ï¼ˆlongest-shared-prefix-firstï¼‰æ’åºè¯·æ±‚ï¼Œè€Œä¸æ˜¯é‡‡ç”¨å…ˆåˆ°å…ˆæœåŠ¡ï¼ˆFIFOï¼‰ã€‚
  - è¯¥ç­–ç•¥ä¸**æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰é¡ºåº**ç­‰ä»·ï¼Œä»è€Œåœ¨ç¦»çº¿æƒ…å†µä¸‹å¯å®ç°æœ€ä¼˜ç¼“å­˜å‘½ä¸­ç‡ï¼ˆå®šç†3.1ï¼‰ã€‚

- **å®šç†3.1**ï¼ˆTheorem 3.1ï¼‰ï¼š
> å¯¹äºä¸€æ‰¹è¯·æ±‚ï¼Œå½“ç¼“å­˜å¤§å° â‰¥ æœ€é•¿è¯·æ±‚é•¿åº¦æ—¶ï¼ŒæŒ‰ç…§radixæ ‘çš„DFS(depth-first search)é¡ºåºæ‰§è¡Œè¯·æ±‚å¯å®ç°æœ€ä¼˜ç¼“å­˜å‘½ä¸­ç‡ã€‚æœ€é•¿å…±äº«å‰ç¼€ä¼˜å…ˆé¡ºåºç­‰åŒäºæ·±åº¦ä¼˜å…ˆæœç´¢é¡ºåºã€‚

- **åœ¨çº¿åœºæ™¯**ï¼šç³»ç»Ÿåœ¨å®é™…è¿è¡Œä¸­æ— æ³•å®Œå…¨éµå¾ªDFSé¡ºåºï¼Œä½†é€šè¿‡è°ƒåº¦ç­–ç•¥**æ¨¡æ‹ŸDFSè¡Œä¸º**ï¼Œä»èƒ½ä¿æŒè¾ƒé«˜çš„ç¼“å­˜å‘½ä¸­ç‡ã€‚
- **å±€é™æ€§**ï¼šè´ªå¿ƒå¼è°ƒåº¦å¯èƒ½å¯¼è‡´**é¥¥é¥¿é—®é¢˜**ï¼ˆæŸäº›è¯·æ±‚é•¿æœŸå¾—ä¸åˆ°æ‰§è¡Œï¼‰ï¼Œæœªæ¥å°†ç»“åˆ**å…¬å¹³è°ƒåº¦ç®—æ³•**ä¼˜åŒ–ã€‚

---

### **åˆ†å¸ƒå¼æ‰©å±•ï¼ˆDistributed Casesï¼‰**

RadixAttention å¯æ‰©å±•åˆ°å¤šGPUå’Œåˆ†å¸ƒå¼ç¯å¢ƒï¼š

- **Tensor å¹¶è¡Œ**ï¼šæ¯ä¸ªGPUç»´æŠ¤è‡ªå·±çš„KVç¼“å­˜åˆ†ç‰‡ï¼Œæ— éœ€é¢å¤–åŒæ­¥ï¼Œç»“æ„æ“ä½œä¸€è‡´ã€‚
- **æ•°æ®å¹¶è¡Œ**ï¼šå¤šä¸ªå·¥ä½œèŠ‚ç‚¹çš„RadixAttentionå®ç°å¯å‚è€ƒé™„å½•A.4éƒ¨åˆ†ã€‚

---

### **æ€»ç»“ï¼ˆé‡ç‚¹å†…å®¹å¼ºè°ƒï¼‰**

- **æ ¸å¿ƒè´¡çŒ®**ï¼šRadixAttention å®ç°äº†KVç¼“å­˜çš„**è‡ªåŠ¨å¤ç”¨**ï¼Œé€šè¿‡ radix tree ç»“æ„å’Œç¼“å­˜æ„ŸçŸ¥è°ƒåº¦ç­–ç•¥ï¼Œæ˜¾è‘—æå‡äº†LLMæ¨ç†æ•ˆç‡ã€‚
- **å…³é”®æŠ€æœ¯ç‚¹**ï¼š
  - **radix tree** ç”¨äºé«˜æ•ˆç»„ç»‡å’Œå¤ç”¨KVç¼“å­˜ï¼›
  - **LRU + å¼•ç”¨è®¡æ•°** å®ç°å†…å­˜ç®¡ç†ï¼›
  - **ç¼“å­˜æ„ŸçŸ¥è°ƒåº¦** æå‡ç¼“å­˜å‘½ä¸­ç‡ï¼›
  - **åˆ†å¸ƒå¼æ”¯æŒ** ä¿è¯ç³»ç»Ÿå¯æ‰©å±•ã€‚
- **ä¼˜åŠ¿**ï¼šç›¸æ¯”ç°æœ‰ç³»ç»Ÿæ— éœ€æ‰‹åŠ¨é…ç½®ã€æ”¯æŒå¤æ‚ç»“æ„ã€å†…å­˜å¼€é”€ä½ã€‚

---

### **ä¸é‡è¦å†…å®¹ç²¾ç®€è¯´æ˜**

- é™„å½•Aä¸­å…³äºKVç¼“å­˜èƒŒæ™¯å’Œå®šç†çš„è¯æ˜ï¼Œä»…åœ¨éœ€è¦æ—¶å‚è€ƒï¼Œæ­£æ–‡é‡ç‚¹åœ¨äºå®ç°æœºåˆ¶å’Œè°ƒåº¦ç­–ç•¥ã€‚
- å›¾3çš„å…·ä½“ç¤ºä¾‹æµç¨‹ä»…ä¸ºè¾…åŠ©ç†è§£ï¼Œé‡ç‚¹åœ¨äº**radix treeçš„åŠ¨æ€ç»´æŠ¤æœºåˆ¶**å’Œ**ç¼“å­˜å¤ç”¨çš„é€»è¾‘**ã€‚


## 4 Efficient Constrained Decoding with Compressed Finite State Machine



### 4 é«˜æ•ˆçš„æœ‰é™çŠ¶æ€æœºå‹ç¼©çº¦æŸè§£ç 

åœ¨è¯­è¨€æ¨¡å‹ï¼ˆLMï¼‰ç¨‹åºä¸­ï¼Œç”¨æˆ·å¸¸å¸¸å¸Œæœ›é™åˆ¶æ¨¡å‹çš„è¾“å‡ºéµå¾ªç‰¹å®šæ ¼å¼ï¼Œä¾‹å¦‚ JSON Schemaã€‚è¿™ç§é™åˆ¶å¯ä»¥æé«˜è¾“å‡ºçš„å¯æ§æ€§å’Œé²æ£’æ€§ï¼Œå¹¶ä½¿å…¶æ›´æ˜“äºè§£æã€‚SGLang æä¾›äº†ä¸€ä¸ª **regex å‚æ•°**ï¼Œé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ¥å¼ºåˆ¶è¿™äº›é™åˆ¶ï¼Œæ­£åˆ™è¡¨è¾¾å¼åœ¨è®¸å¤šå®é™…åœºæ™¯ä¸­å·²ç»è¶³å¤Ÿè¡¨è¾¾ã€‚

### ç°æœ‰ç³»ç»Ÿçš„çº¦æŸè§£ç æ–¹æ³•

ç°æœ‰ç³»ç»Ÿé€šå¸¸é€šè¿‡å°†æ­£åˆ™è¡¨è¾¾å¼è½¬æ¢ä¸º**æœ‰é™çŠ¶æ€æœºï¼ˆFSMï¼‰** æ¥å®ç°è¿™ç§çº¦æŸã€‚åœ¨è§£ç è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä¼šç»´æŠ¤å½“å‰çš„ FSM çŠ¶æ€ï¼Œä»ä¸‹ä¸€çŠ¶æ€ä¸­è·å–å…è®¸çš„ tokenï¼Œå¹¶å°†ä¸ç¬¦åˆçº¦æŸçš„ token çš„æ¦‚ç‡è®¾ä¸ºé›¶ï¼Œé€ token è§£ç ã€‚ç„¶è€Œï¼Œè¿™ç§**é€ token è§£ç **çš„æ–¹å¼åœ¨æŸäº›æƒ…å†µä¸‹æ•ˆç‡ä¸é«˜ï¼Œå°¤å…¶æ˜¯å½“å¤šä¸ª token å¯ä»¥åŒæ—¶è§£ç æ—¶ã€‚

ä¾‹å¦‚ï¼Œåœ¨ `"summary": " ` è¿™æ ·çš„å›ºå®šåºåˆ—ä¸­ï¼Œè™½ç„¶åœ¨å¸¸è§„è§£ç è¿‡ç¨‹ä¸­éœ€è¦å¤šä¸ªæ­¥éª¤ï¼Œä½†å®é™…ä¸Šæ¯ä¸€æ­¥åªæœ‰ä¸€ä¸ªæœ‰æ•ˆ tokenï¼Œå› æ­¤æ•´ä¸ªåºåˆ—å¯ä»¥**ä¸€æ¬¡æ€§è§£ç å®Œæˆ**ï¼ˆå³ä¸€æ¬¡å‰å‘ä¼ æ’­ï¼‰ã€‚ä½†ç°æœ‰ç³»ç»Ÿç”±äº FSM å’Œæ¨¡å‹è¿è¡Œå™¨ä¹‹é—´ç¼ºä¹é›†æˆï¼Œ**æ— æ³•è¿›è¡Œå¤š token å¹¶è¡Œå¤„ç†**ï¼Œå¯¼è‡´è§£ç é€Ÿåº¦è¾ƒæ…¢ã€‚

### SGLang çš„é«˜æ•ˆè§£ç æ–¹æ³•

![](https://img.zhaoweiguo.com/uPic/2025/08/pIbehl.png)

Figure 4:The decoding process of normal and compressed FSMs (the underscore _ means a space).


SGLang é€šè¿‡æ„å»ºä¸€ä¸ª**å¿«é€Ÿçš„çº¦æŸè§£ç è¿è¡Œæ—¶**ï¼Œåˆ©ç”¨**å‹ç¼©æœ‰é™çŠ¶æ€æœºï¼ˆCompressed FSMï¼‰** å…‹æœäº†è¿™ä¸€é™åˆ¶ã€‚è¯¥è¿è¡Œæ—¶ä¼šå¯¹ FSM è¿›è¡Œåˆ†æï¼Œå¹¶å°†**è¿ç»­çš„å• token è½¬ç§»è¾¹**å‹ç¼©ä¸ºå•ä¸ªè¾¹ï¼Œå¦‚å›¾ 4(b) æ‰€ç¤ºã€‚è¿™ç§æ–¹å¼ä½¿å¾—ç³»ç»Ÿèƒ½å¤Ÿè¯†åˆ«å“ªäº› token å¯ä»¥**ä¸€èµ·è§£ç **ã€‚

å¦‚å›¾ 4(d) æ‰€ç¤ºï¼Œå¤šä¸ª token å¯ä»¥åœ¨**ä¸€ä¸ªå‰å‘ä¼ æ’­æ­¥éª¤ä¸­å®Œæˆè§£ç **ï¼Œä»è€Œæ˜¾è‘—æé«˜äº†è§£ç æ•ˆç‡ã€‚è¯¥æ–¹æ³•å…·æœ‰**é€šç”¨æ€§**ï¼Œé€‚ç”¨äºæ‰€æœ‰çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚æœ‰å…³èƒŒæ™¯å’Œå®ç°ç»†èŠ‚ï¼Œè¯¦è§é™„å½• Bã€‚


## 5 Efficient Endpoint Calling with API Speculative Execution


### 5 åˆ©ç”¨ API æ¨æµ‹æ‰§è¡Œé«˜æ•ˆè°ƒç”¨ç«¯ç‚¹

æœ¬èŠ‚åœ¨å‰æ–‡åŸºç¡€ä¸Šï¼Œä»‹ç»äº†é’ˆå¯¹ä»…å¯é€šè¿‡ API è°ƒç”¨çš„æ¨¡å‹ï¼ˆå¦‚ OpenAI çš„ GPT-4ï¼‰çš„ä¼˜åŒ–æ–¹æ³•ã€‚ç”±äºè¿™ç±»æ¨¡å‹æ˜¯é»‘ç›’ï¼Œæ— æ³•å¯¹æ¨ç†è¿‡ç¨‹è¿›è¡Œä¿®æ”¹ï¼Œå› æ­¤éœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼æå‡æ€§èƒ½å’Œé™ä½è°ƒç”¨æˆæœ¬ã€‚

**æ ¸å¿ƒå†…å®¹**æ˜¯æå‡ºäº†ä¸€ç§æ–°çš„ä¼˜åŒ–æ–¹æ³•ï¼š**API æ¨æµ‹æ‰§è¡Œ**ï¼ˆspeculative executionï¼‰ï¼Œç”¨äºåŠ é€Ÿå¤šè°ƒç”¨ SGLang ç¨‹åºçš„æ‰§è¡Œï¼Œå¹¶é™ä½ API æˆæœ¬ã€‚

### ä¼˜åŒ–åŠ¨æœº
ä¸€ä¸ªå…¸å‹çš„ SGLang ç¨‹åºå¯èƒ½ä¼šåŒ…å«å¤šä¸ª `gen` è°ƒç”¨ï¼Œå¦‚ï¼š

```python
s += context + "name:" + gen("name", stop="\n") + "job:" + gen("job", stop="\n")
```

å¦‚æœæ²¡æœ‰ä¼˜åŒ–ï¼Œæ¯ä¸ª `gen` éƒ½ä¼šè§¦å‘ä¸€æ¬¡ API è°ƒç”¨ï¼Œè¿™æ ·ä¼šå¯¼è‡´ï¼š
- **è¾“å…¥ token è´¹ç”¨é‡å¤è®¡ç®—**ï¼š`context` éƒ¨åˆ†ä¼šè¢«å¤šæ¬¡ä¼ å…¥ï¼Œå¯¼è‡´è´¹ç”¨å¢åŠ ï¼›
- **è°ƒç”¨å»¶è¿Ÿå åŠ **ï¼šå¤šæ¬¡ API è¯·æ±‚ä¼šå¢åŠ æ•´ä½“å“åº”æ—¶é—´ã€‚

### æ¨æµ‹æ‰§è¡Œçš„åŸç†
SGLang æå‡ºçš„ä¼˜åŒ–æ–¹æ³•æ˜¯åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶**å¯ç”¨æ¨æµ‹æ‰§è¡Œ**ã€‚å…·ä½“åšæ³•æ˜¯ï¼š
- å¿½ç•¥ç¬¬ä¸€æ¬¡è°ƒç”¨ä¸­çš„ `stop` æ¡ä»¶ï¼›
- è®©æ¨¡å‹ç»§ç»­ç”Ÿæˆæ¯”æ‰€éœ€æ›´å¤šçš„ tokenï¼›
- å°†è¿™äº›é¢å¤–çš„ç”Ÿæˆç»“æœç¼“å­˜èµ·æ¥ï¼›
- åœ¨åç»­çš„ `gen` è°ƒç”¨ä¸­**åŒ¹é…å¹¶å¤ç”¨**è¿™äº›ç¼“å­˜çš„è¾“å‡ºã€‚

### ä¼˜åŠ¿
å¦‚æœæç¤ºè¯è®¾è®¡å¾—å½“ï¼Œæ¨¡å‹èƒ½å¤Ÿ**é«˜å‡†ç¡®ç‡åœ°åŒ¹é…æ¨¡æ¿ç»“æ„**ï¼Œä»è€Œå®ç°ï¼š
- **å‡å°‘ä¸€æ¬¡ API è°ƒç”¨**ï¼šèŠ‚çœè°ƒç”¨å»¶è¿Ÿï¼›
- **é™ä½è¾“å…¥è´¹ç”¨**ï¼šé¿å…é‡å¤ä¼ å…¥ç›¸åŒçš„ `context` éƒ¨åˆ†ã€‚

### æ€»ç»“
æœ¬èŠ‚çš„é‡ç‚¹æ˜¯é€šè¿‡**API æ¨æµ‹æ‰§è¡Œ**ä¼˜åŒ–é»‘ç›’æ¨¡å‹çš„å¤šè°ƒç”¨åœºæ™¯ï¼Œå…¶å…³é”®åœ¨äºé€šè¿‡ä¸€æ¬¡è°ƒç”¨ç”Ÿæˆæ›´å¤š tokenï¼Œåç»­é€šè¿‡ç¼“å­˜å’Œå¤ç”¨æ¥å‡å°‘ API è°ƒç”¨æ¬¡æ•°ï¼Œä»è€Œæå‡æ€§èƒ½å’Œé™ä½æˆæœ¬ã€‚


## 6 Evaluation


æœ¬èŠ‚è¯„ä¼°äº† SGLang åœ¨å¤šç§å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å·¥ä½œè´Ÿè½½ä¸­çš„æ€§èƒ½ï¼Œå¹¶é€šè¿‡æ¶ˆèå®éªŒå’Œæ¡ˆä¾‹ç ”ç©¶å±•ç¤ºäº†å…¶ç»„ä»¶çš„æœ‰æ•ˆæ€§ã€‚SGLang åŸºäº PyTorch å®ç°ï¼Œå¹¶ä½¿ç”¨äº† FlashInfer å’Œ Triton æä¾›çš„å®šåˆ¶ CUDA å†…æ ¸ã€‚

---

### 6.1 å®éªŒè®¾ç½®ï¼ˆSetupï¼‰

#### **æ¨¡å‹ï¼ˆModelsï¼‰**
æµ‹è¯•äº†å¤šç§æ¨¡å‹ï¼ŒåŒ…æ‹¬ï¼š
- **ç¨ å¯†æ¨¡å‹**ï¼šLlama-2ï¼ˆå‚æ•°é‡ 7B-70Bï¼‰
- **ç¨€ç–æ¨¡å‹**ï¼šMixtral
- **å¤šæ¨¡æ€æ¨¡å‹**ï¼šLLaVAï¼ˆå›¾åƒã€è§†é¢‘ï¼‰
- **API æ¨¡å‹**ï¼šOpenAI çš„ GPT-3.5

æ‰€æœ‰æ¨¡å‹å‡é‡‡ç”¨ float16 ç²¾åº¦è¿›è¡Œè¿ç®—ã€‚

#### **ç¡¬ä»¶ï¼ˆHardwareï¼‰**
- **ä¸»è¦å®éªŒå¹³å°**ï¼šAWS EC2 G5 å®ä¾‹ï¼Œé…å¤‡ NVIDIA A10G GPUï¼ˆ24GBï¼‰
- **å¤§æ¨¡å‹å®éªŒ**ï¼šä½¿ç”¨å¤šå¼  A10G GPU å¹¶å¯ç”¨å¼ é‡å¹¶è¡Œï¼ˆTensor Parallelismï¼‰
- **éƒ¨åˆ†è¡¥å……å®éªŒ**ï¼šåœ¨ A100Gï¼ˆ80GBï¼‰GPU ä¸Šè¿›è¡Œ

#### **åŸºçº¿ï¼ˆBaselinesï¼‰**
ä¸ä»¥ä¸‹ç³»ç»Ÿè¿›è¡Œå¯¹æ¯”ï¼š
- **Guidance**ï¼šç”¨äºæ§åˆ¶ LLM çš„è¯­è¨€ï¼Œä½¿ç”¨ llama.cpp åç«¯
- **vLLM**ï¼šé«˜ååé‡çš„æ¨ç†å¼•æ“
- **LMQL**ï¼šæŸ¥è¯¢è¯­è¨€ï¼Œä½¿ç”¨ Hugging Face Transformers åç«¯

é™¤éç‰¹åˆ«è¯´æ˜ï¼Œæ‰€æœ‰ç³»ç»Ÿä½¿ç”¨é»˜è®¤è®¾ç½®ä»¥ä¿è¯è®¡ç®—ç»“æœä¸€è‡´ã€‚

#### **å·¥ä½œè´Ÿè½½ï¼ˆWorkloadsï¼‰**
æµ‹è¯•äº†å¤šç§ä»»åŠ¡ï¼ŒåŒ…æ‹¬ï¼š
- **MMLU**ï¼ˆ5-shotï¼‰
- **HellaSwag**ï¼ˆ20-shotï¼‰
- **ReAct ä»£ç†**ä¸**ç”Ÿæˆå¼ä»£ç†**
- **Tree-of-thought**ï¼ˆGSM-8Kï¼‰
- **Skeleton-of-thought**ï¼ˆç”Ÿæˆæç¤ºï¼‰
- **Branch-solve-merge**ï¼ˆLLM åˆ¤å®šï¼‰
- **JSON è§£ç ï¼ˆå¸¦æ­£åˆ™è¡¨è¾¾å¼çº¦æŸï¼‰**
- **å¤šè½®å¯¹è¯**ï¼ˆçŸ­è¾“å‡ºå’Œé•¿è¾“å‡ºï¼‰
- **DSPy RAG ç®¡é“**

#### **æŒ‡æ ‡ï¼ˆMetricsï¼‰**
- **ååé‡ï¼ˆThroughputï¼‰**ï¼šè¿è¡Œè¶³å¤Ÿå¤§çš„ç¨‹åºå®ä¾‹ï¼Œè®¡ç®—æ¯ç§’æ‰§è¡Œçš„ç¨‹åºæ•°ï¼ˆp/sï¼‰
- **å»¶è¿Ÿï¼ˆLatencyï¼‰**ï¼šå•ç¨‹åºè¿è¡Œï¼Œè®¡ç®—å¹³å‡å»¶è¿Ÿ

---

### 6.2 ç«¯åˆ°ç«¯æ€§èƒ½ï¼ˆEnd-to-End Performanceï¼‰

#### **å¼€æºæ¨¡å‹ç»“æœ**
- **å›¾5å’Œå›¾6** å±•ç¤ºäº† SGLang åœ¨ Llama-7B ä¸Šçš„ååé‡å’Œå»¶è¿Ÿã€‚SGLang ç›¸è¾ƒäºåŸºçº¿æ¨¡å‹ï¼Œ**ååé‡æå‡æœ€é«˜è¾¾ 6.4 å€ï¼Œå»¶è¿Ÿé™ä½æœ€é«˜è¾¾ 3.7 å€**ã€‚
- **æ€§èƒ½æå‡åŸå› **ï¼š
  - **KV ç¼“å­˜å¤ç”¨**ï¼šå¦‚ RadixAttentionï¼Œæœ‰æ•ˆå‡å°‘å†…å­˜ä½¿ç”¨å’Œé¢„å¡«å……è®¡ç®—
  - **å•ç¨‹åºå†…å¹¶è¡Œ**ï¼šåˆ©ç”¨ç¨‹åºç»“æ„è¿›è¡Œæ›´é«˜æ•ˆçš„è°ƒåº¦
  - **å—é™è§£ç åŠ é€Ÿ**ï¼šå¦‚ JSON è§£ç ä¸­ä½¿ç”¨å‹ç¼©æœ‰é™çŠ¶æ€æœºï¼ˆCFSMï¼‰ä¸€æ¬¡è§£ç å¤šä¸ª token

#### **å¤šæ¨¡æ€æ¨¡å‹æ”¯æŒ**
- SGLang æ”¯æŒå›¾åƒå’Œè§†é¢‘åŸè¯­ï¼Œå¯åŸç”Ÿè¿è¡Œå¤šæ¨¡æ€æ¨¡å‹ï¼ˆå¦‚ LLaVAï¼‰
- å¯¹äºç›¸åŒå›¾åƒçš„å¤šé—®é¢˜å¤„ç†ï¼ŒSGLang å¤ç”¨ KV ç¼“å­˜ï¼Œæå‡ååé‡
- **è¡¨2** ä¸­æ¯”è¾ƒäº† SGLang ä¸åŸå§‹å®ç°çš„ååé‡ï¼Œ**SGLang ååé‡æœ€é«˜æå‡ 6 å€**

#### **ç”Ÿäº§éƒ¨ç½²**
- SGLang éƒ¨ç½²åœ¨ Chatbot Arenaï¼Œç”¨äºæœåŠ¡å¼€æºæ¨¡å‹
- åœ¨ LLaVA-Next-34B å’Œ Vicuna-33B ä¸Šè§‚å¯Ÿåˆ° **52.4% å’Œ 74.1% çš„ KV ç¼“å­˜å‘½ä¸­ç‡**
- ç¼“å­˜å‘½ä¸­ä¸»è¦æ¥è‡ªç³»ç»Ÿæ¶ˆæ¯ã€å¸¸è§å›¾åƒå’Œå¤šè½®å¯¹è¯å†å²ï¼Œ**æ˜¾è‘—é™ä½é¦– token ç”Ÿæˆå»¶è¿Ÿï¼ˆå¹³å‡é™ä½ 1.7 å€ï¼‰**

#### **API æ¨¡å‹ç»“æœ**
- ä½¿ç”¨ OpenAI çš„ GPT-3.5 è¿›è¡Œç»´åŸºé¡µé¢å­—æ®µæå–
- é€šè¿‡å°‘æ ·æœ¬æç¤ºï¼Œæå‡äº†æ¨æµ‹æ‰§è¡Œçš„å‡†ç¡®æ€§ï¼Œå¹¶**å°†è¾“å…¥ token æˆæœ¬é™ä½çº¦ä¸‰å€**

---

### 6.3 æ¶ˆèå®éªŒï¼ˆAblation Studyï¼‰

#### **ç¼“å­˜å‘½ä¸­ç‡ä¸æ€§èƒ½çš„å…³ç³»**
- **å›¾8ï¼ˆaï¼‰ï¼ˆbï¼‰** æ˜¾ç¤ºï¼š**ç¼“å­˜å‘½ä¸­ç‡è¶Šé«˜ï¼Œååé‡è¶Šé«˜ï¼Œå»¶è¿Ÿè¶Šä½**ï¼Œæ‰¹æ¬¡å¤§å°ä¹Ÿè¶Šå¤§
- é€šè¿‡éƒ¨åˆ†ç¦ç”¨åŒ¹é… token éªŒè¯äº†ç¼“å­˜ç³»ç»Ÿå¯¹æ€§èƒ½çš„å½±å“

#### **RadixAttention çš„æœ‰æ•ˆæ€§**
- **å›¾8ï¼ˆcï¼‰** å±•ç¤ºäº†ä¸åŒç»„ä»¶çš„æ¶ˆèå®éªŒç»“æœï¼ŒåŒ…æ‹¬ï¼š
  - **ä¸ä½¿ç”¨ç¼“å­˜**
  - **ä¸ä½¿ç”¨æ ‘ç»“æ„ç¼“å­˜**
  - **ä¸ä½¿ç”¨ç¼“å­˜æ„ŸçŸ¥è°ƒåº¦ç­–ç•¥**
  - **ä¸ä½¿ç”¨å‰ç«¯å¹¶è¡Œ**
  - **ä¸å‘é€å‰ç«¯æç¤º**
- å®éªŒç»“æœè¡¨æ˜ï¼š**æ‰€æœ‰ç»„ä»¶å¯¹æ€§èƒ½å‡æœ‰æ˜¾è‘—å½±å“**ï¼Œç‰¹åˆ«æ˜¯å‰ç«¯æç¤ºä¸å¹¶è¡Œæœºåˆ¶å¯¹è¿è¡Œæ—¶æ€§èƒ½éå¸¸é‡è¦

#### **RadixAttention çš„å¼€é”€**
- åœ¨æ— ç¼“å­˜å¤ç”¨æœºä¼šçš„åŸºå‡†æµ‹è¯•ä¸­ï¼ŒRadixAttention æ•°æ®ç»“æ„ç®¡ç†ä»…å  **0.3% çš„å¼€é”€**
- å› æ ‘æ“ä½œå¤æ‚åº¦ä½ï¼Œ**RadixAttention å¯ä»¥é»˜è®¤å¯ç”¨**

#### **å‹ç¼©æœ‰é™çŠ¶æ€æœºï¼ˆCFSMï¼‰æœ‰æ•ˆæ€§**
- åœ¨ JSON è§£ç ä»»åŠ¡ä¸­ï¼Œ**CFSM å°†ååé‡æå‡ 1.6 å€**
- é¢„å¤„ç†åå¤ç”¨çŠ¶æ€æœºæ˜¯å…³é”®ï¼Œå¦åˆ™æ¯è¯·æ±‚é¢„å¤„ç†ä¼š**ä½¿ååé‡é™ä½ 2.4 å€**

---

### æ€»ç»“

æœ¬èŠ‚é€šè¿‡å¤šä¸ªå®éªŒéªŒè¯äº† SGLang åœ¨ LLM æ‰§è¡Œä¸­çš„é«˜æ•ˆæ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨ KV ç¼“å­˜å¤ç”¨ã€è°ƒåº¦ä¼˜åŒ–å’Œè§£ç åŠ é€Ÿæ–¹é¢è¡¨ç°çªå‡ºã€‚æ— è®ºæ˜¯åœ¨ç¨ å¯†æ¨¡å‹ã€ç¨€ç–æ¨¡å‹ã€å¤šæ¨¡æ€æ¨¡å‹è¿˜æ˜¯ç”Ÿäº§éƒ¨ç½²ä¸­ï¼ŒSGLang éƒ½å±•ç°å‡ºæ˜¾è‘—æ€§èƒ½ä¼˜åŠ¿ã€‚æ¶ˆèå®éªŒè¿›ä¸€æ­¥éªŒè¯äº†å…³é”®ç»„ä»¶å¯¹æ€§èƒ½çš„è´¡çŒ®ï¼Œè¯æ˜äº† SGLang å‰ç«¯è¯­è¨€ä¸è¿è¡Œæ—¶ååŒè®¾è®¡çš„é‡è¦æ€§ã€‚


## 7 Related Work


æœ¬èŠ‚æ€»ç»“äº†ä¸æœ¬æ–‡å·¥ä½œç›¸å…³çš„ç ”ç©¶è¿›å±•ï¼Œé‡ç‚¹çªå‡ºäº†æœ¬æ–‡æå‡ºçš„ **RadixAttention** å’Œ **SGLang** åœ¨KVç¼“å­˜é‡ç”¨å’Œç¼–ç¨‹æ¨¡å‹ä¼˜åŒ–æ–¹é¢çš„åˆ›æ–°ä¸ä¼˜åŠ¿ã€‚

---

### RadixAttention çš„åˆ›æ–°ç‚¹

æœ¬æ–‡é¦–æ¬¡æå‡ºå°†KVç¼“å­˜ï¼ˆKey-Value Cacheï¼‰è§†ä¸ºåŸºäºæ ‘ç»“æ„çš„LRUç¼“å­˜ï¼ˆLeast Recently Used Cacheï¼‰ï¼Œæ˜¯æ”¯æŒ**å¤šçº§å…±äº«ã€ç¼“å­˜æ„ŸçŸ¥è°ƒåº¦ã€å‰ç«¯ä¸è¿è¡Œæ—¶ååŒè°ƒåº¦ã€ä»¥åŠåˆ†å¸ƒå¼åœºæ™¯**çš„é¦–ä¸ªè§£å†³æ–¹æ¡ˆã€‚è¿™ä¸€è®¾è®¡èƒ½å¤Ÿæ›´é«˜æ•ˆåœ°ç®¡ç†ç¼“å­˜ï¼Œåœ¨ç»“æ„åŒ–æ¨ç†ä»»åŠ¡ä¸­æ˜¾è‘—æå‡æ€§èƒ½ã€‚

---

### å…¶ä»–ç›¸å…³å·¥ä½œåˆ†æ

- **vLLM** å’Œ **ChunkedAttention** ç ”ç©¶äº†KVç¼“å­˜çš„æŸäº›ç®€å•å¤ç”¨åœºæ™¯ï¼ˆå¦‚ç³»ç»Ÿæç¤ºå…±äº«ï¼‰ï¼Œä½†æœªæ¶‰åŠ**å¤šçº§æ ‘ç»“æ„å…±äº«**æˆ–**LRUç¼“å­˜æœºåˆ¶**ã€‚
- **PromptCache** æå‡ºäº†è¶…å‡ºå‰ç¼€èŒƒå›´çš„æ¨¡å—åŒ–ç¼“å­˜å¤ç”¨æ–¹æ³•ï¼Œä½†ç”±äºå¤ç”¨ç²’åº¦è¾ƒå¤§ï¼Œå¯èƒ½å¯¼è‡´**é«˜è¾¾43%çš„å‡†ç¡®æ€§ä¸‹é™**ã€‚
- **HydraGenã€FlashInfer å’Œ ChunkedAttention** çš„é‡ç‚¹åœ¨äº**CUDAå†…æ ¸ä¼˜åŒ–**ï¼Œå¹¶æœªå¼•å…¥LRUç¼“å­˜çš„æ¦‚å¿µã€‚
- **API Serve å’Œ LLM-SQL** é’ˆå¯¹ç‰¹å®šåº”ç”¨åœºæ™¯ï¼ˆå¦‚ä¸å¤–éƒ¨APIè°ƒç”¨å’Œæ•°æ®åº“äº¤äº’ï¼‰ç ”ç©¶KVç¼“å­˜é‡ç”¨ï¼Œä½†ç¼ºå°‘**åŸºæ•°æ ‘ç»“æ„**å’Œ**ç¼“å­˜æ„ŸçŸ¥è°ƒåº¦**ã€‚

---

### LLM ç¼–ç¨‹ä¸ä»£ç†æ¡†æ¶

æœ¬èŠ‚è¿˜å¯¹æ¯”äº†å¤šä¸ªç°æœ‰çš„å¤§è¯­è¨€æ¨¡å‹ç¼–ç¨‹ä¸ä»£ç†æ¡†æ¶ï¼ŒåŒ…æ‹¬ **Guidanceã€LMQLã€DSPyã€LangChainã€AutoGen å’Œ LLM Compiler**ã€‚

- **Guidance å’Œ LMQL** ä¸æœ¬æ–‡æå‡ºçš„ **SGLang** æœ€ä¸ºç›¸ä¼¼ï¼Œæ–‡ç« åœ¨[ç¬¬2èŠ‚](https://arxiv.org/html/2312.07104v2#S2)å¯¹æ­¤è¿›è¡Œäº†è¯¦ç»†æ¯”è¾ƒã€‚
- **SGLang** çš„åˆ›æ–°ç‚¹åœ¨äºæå‡ºäº†**æ–°çš„è¿è¡Œæ—¶ä¼˜åŒ–æœºåˆ¶**ï¼Œä»¥åŠ é€Ÿç»“æ„åŒ–è¯­è¨€æ¨¡å‹ç¨‹åºçš„æ‰§è¡Œã€‚
- **SGLang** ä¸ä»…å…¼å®¹å…¶ä»–æ¡†æ¶ï¼ˆå¦‚DSPyï¼‰ï¼Œè¿˜æ”¯æŒå¤šç§å¸¸è§æ¨ç†ä¼˜åŒ–æŠ€æœ¯ï¼Œå¦‚ **vLLMã€FlashAttentionã€KVé‡åŒ–ã€æ¨¡å‹å‹ç¼©ç­‰**ã€‚

---

### æ€»ç»“

æœ¬èŠ‚å¼ºè°ƒäº†æœ¬æ–‡åœ¨KVç¼“å­˜ç®¡ç†å’Œè¯­è¨€æ¨¡å‹ç¼–ç¨‹æ–¹é¢çš„åˆ›æ–°æ€§ï¼Œç‰¹åˆ«æ˜¯ **RadixAttention** åœ¨ç¼“å­˜ç»“æ„è®¾è®¡ä¸Šçš„çªç ´ï¼Œä»¥åŠ **SGLang** åœ¨ç¼–ç¨‹æ¨¡å‹å’Œæ‰§è¡Œä¼˜åŒ–ä¸Šçš„ç»¼åˆä¼˜åŠ¿ã€‚ç›¸æ¯”ç°æœ‰å·¥ä½œï¼Œæœ¬æ–‡æå‡ºçš„æ–¹æ¡ˆåœ¨**æ•ˆç‡ã€å…¼å®¹æ€§å’Œå‡†ç¡®æ€§**ä¸Šå…·æœ‰æ›´å…¨é¢çš„ä¼˜åŠ¿ã€‚


## 8 Future Directions and Conclusion

### æœªæ¥æ–¹å‘  
å°½ç®¡ SGLang åœ¨æå‡è¯­è¨€æ¨¡å‹ç¨‹åºæ•ˆç‡æ–¹é¢å·²å–å¾—ä¸€å®šè¿›å±•ï¼Œä½†ä»å­˜åœ¨ä¸€äº›å±€é™æ€§ï¼Œè¿™äº›å±€é™æ€§æŒ‡å‡ºäº†æœªæ¥ç ”ç©¶çš„æ½œåœ¨æ–¹å‘ï¼š

- **æ‰©å±• SGLang çš„è¾“å‡ºæ¨¡æ€**ï¼šå½“å‰ SGLang ä¸»è¦é¢å‘è¯­è¨€ç±»è¾“å‡ºï¼Œæœªæ¥å¯ä»¥æ‰©å±•å…¶æ”¯æŒæ›´å¤šçš„è¾“å‡ºæ¨¡æ€ï¼ˆå¦‚å›¾åƒã€éŸ³é¢‘ç­‰ï¼‰ï¼Œä»¥å¢å¼ºå…¶å¤šåŠŸèƒ½æ€§ã€‚
- **é€‚é…ä¸åŒå†…å­˜å±‚æ¬¡çš„ RadixAttention**ï¼šå°† RadixAttention ä¼˜åŒ–ä¸ºèƒ½å¤Ÿåœ¨å¤šç§å†…å­˜å±‚æ¬¡ï¼ˆå¦‚ DRAM å’Œç£ç›˜ï¼‰ä¸Šè¿è¡Œï¼Œå‚è€ƒäº† FlexGen çš„ç ”ç©¶[sheng2023flexgen]ï¼Œè¿™æœ‰åŠ©äºæå‡å¤§è§„æ¨¡æ¨¡å‹çš„æ‰§è¡Œæ•ˆç‡ã€‚
- **å®ç°æ¨¡ç³Šè¯­ä¹‰åŒ¹é…**ï¼šåœ¨ RadixAttention ä¸­å¼•å…¥æ¨¡ç³Šè¯­ä¹‰åŒ¹é…èƒ½åŠ›ï¼Œä»¥æé«˜æ¨¡å‹å¯¹ä¸Šä¸‹æ–‡ç›¸ä¼¼ä½†è¡¨è¾¾ä¸åŒçš„å†…å®¹çš„è¯†åˆ«èƒ½åŠ›ã€‚
- **æä¾›æ›´é«˜å±‚çš„ç¼–ç¨‹åŸè¯­**ï¼šåœ¨ SGLang åŸºç¡€ä¸Šæä¾›æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡å’Œç¼–ç¨‹æ¥å£ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿæ›´ä¾¿æ·åœ°æ„å»ºå’Œè°ƒåº¦å¤æ‚è¯­è¨€æ¨¡å‹ç¨‹åºã€‚
- **è§£å†³ç¼“å­˜æ„ŸçŸ¥è°ƒåº¦ä¸­çš„é¥¥é¥¿é—®é¢˜**ï¼šå½“å‰ç¼“å­˜æ„ŸçŸ¥è°ƒåº¦å­˜åœ¨æŸäº›è¯·æ±‚é•¿æœŸå¾—ä¸åˆ°å“åº”çš„é—®é¢˜ï¼ˆå³â€œé¥¥é¥¿â€ï¼‰ï¼Œå‚è€ƒäº†ç›¸å…³å…¬å¹³æ€§ç ”ç©¶[sheng2023fairness]ï¼Œæœªæ¥éœ€æ”¹è¿›è°ƒåº¦ç­–ç•¥ä»¥æé«˜å…¬å¹³æ€§å’Œèµ„æºåˆ©ç”¨ç‡ã€‚
- **å¢å¼ºç¼–è¯‘å™¨çš„é™æ€ä¼˜åŒ–èƒ½åŠ›**ï¼šä¼˜åŒ– SGLang ç¼–è¯‘å™¨ï¼Œä½¿å…¶èƒ½å¤Ÿè¿›è¡Œæ›´é«˜çº§çš„é™æ€ä¼˜åŒ–ï¼ŒåŒ…æ‹¬ä»»åŠ¡è°ƒåº¦å’Œå†…å­˜è§„åˆ’ï¼Œä»è€Œæå‡æ‰§è¡Œæ•ˆç‡ã€‚

### ç»“è®º  
æœ¬æ–‡ä»‹ç»äº† **SGLang**ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºé«˜æ•ˆç¼–ç¨‹å’Œæ‰§è¡Œç»“æ„åŒ–è¯­è¨€æ¨¡å‹ç¨‹åºçš„æ¡†æ¶ã€‚SGLang é€šè¿‡å¼•å…¥åˆ›æ–°çš„ä¼˜åŒ–æŠ€æœ¯ï¼ˆå¦‚ **RadixAttention**ã€å‹ç¼©æœ‰é™çŠ¶æ€æœºå’Œè¯­è¨€è§£é‡Šå™¨ï¼‰æ˜¾è‘—æå‡äº†å¤æ‚è¯­è¨€æ¨¡å‹ç¨‹åºçš„ååé‡ä¸å»¶è¿Ÿè¡¨ç°ã€‚å®ƒä¸ºé«˜çº§æç¤ºæŠ€æœ¯å’Œæ™ºèƒ½ä»£ç†å·¥ä½œæµçš„å¼€å‘æä¾›äº†æœ‰åŠ›å·¥å…·ã€‚ç›®å‰ï¼ŒSGLang çš„æºç å·²å…¬å¼€ï¼Œå¯ä¾›ç ”ç©¶å’Œåº”ç”¨ã€‚


## Acknowledgement


è¯¥ç« èŠ‚ä¸»è¦å¯¹é¡¹ç›®çš„æ”¯æŒå•ä½å’Œä¸ªäººè¡¨ç¤ºæ„Ÿè°¢ã€‚

- **é¡¹ç›®èµ„åŠ©**ï¼šæœ¬é¡¹ç›®å¾—åˆ°äº† **æ–¯å¦ç¦å¤§å­¦è‡ªåŠ¨æ¨ç†ä¸­å¿ƒ**ï¼ˆStanford Center for Automated Reasoningï¼‰ä»¥åŠå¤šå®¶ä¼ä¸šçš„èµ„åŠ©ï¼ŒåŒ…æ‹¬ **Astronomerã€Googleã€IBMã€Intelã€Laceworkã€Microsoftã€Mohamed Bin Zayedäººå·¥æ™ºèƒ½å¤§å­¦ã€Nexlaã€Samsung SDSã€Uber å’Œ VMware**ã€‚è¿™äº›æ”¯æŒä¸ºé¡¹ç›®çš„å¼€å±•æä¾›äº†é‡è¦çš„èµ„æºã€‚

- **ä¸ªäººèµ„åŠ©**ï¼šå…¶ä¸­ï¼Œ**Lianmin Zheng** çš„ç ”ç©¶å¾—åˆ°äº† **Meta å…¬å¸çš„åšå£«å¥–å­¦é‡‘**ï¼ˆMeta Ph.D. Fellowshipï¼‰çš„æ”¯æŒï¼Œä½“ç°äº†å…¶ä¸ªäººç ”ç©¶çš„é‡è¦ä»·å€¼ã€‚

- **æŠ€æœ¯æ”¯æŒ**ï¼šä½œè€…ç‰¹åˆ«æ„Ÿè°¢ **Yuanhan Zhang å’Œ Bo Li** æä¾›äº†å¯¹ **LLaVA-NeXTï¼ˆè§†é¢‘ï¼‰** çš„æ”¯æŒï¼Œè¿™å¯¹é¡¹ç›®çš„æŸäº›æŠ€æœ¯å®ç°å…·æœ‰å…³é”®ä½œç”¨ã€‚

æ•´ä½“æ¥çœ‹ï¼Œè¯¥ç« èŠ‚è™½ç„¶ç®€çŸ­ï¼Œä½†è¯¦ç»†åˆ—å‡ºäº†é¡¹ç›®çš„é‡è¦æ”¯æŒæ¥æºï¼Œçªå‡ºäº†åˆä½œä¸èµ„åŠ©çš„é‡è¦æ€§ã€‚


## Appendix A Additional Details on RadixAttention


### A.1 Background on the KV Cache

æœ¬èŠ‚ä»‹ç»äº†KV Cacheï¼ˆé”®å€¼ç¼“å­˜ï¼‰åœ¨å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä¸­çš„èƒŒæ™¯å’Œä½œç”¨ã€‚

- **KV Cacheçš„ä½œç”¨**ï¼š
  - LLMåœ¨æ¨ç†è¿‡ç¨‹ä¸­åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š**prefill**ï¼ˆé¢„å¡«å……ï¼‰å’Œ**decoding**ï¼ˆè§£ç ï¼‰ã€‚Prefillé˜¶æ®µå¤„ç†è¾“å…¥åºåˆ—ï¼Œdecodingé˜¶æ®µé€å­—ç”Ÿæˆè¾“å‡ºã€‚
  - æ¯ä¸ªtokençš„å¤„ç†ä¼šç”Ÿæˆä¸­é—´å¼ é‡ï¼ˆå³KV Cacheï¼‰ï¼Œç”¨äºåç»­tokençš„è‡ªæ³¨æ„åŠ›è®¡ç®—ã€‚
  - KV Cacheçš„è®¡ç®—åªä¾èµ–äºå‰é¢çš„tokenï¼Œå› æ­¤**ç›¸åŒå‰ç¼€çš„å¤šä¸ªè¯·æ±‚å¯ä»¥å¤ç”¨KV Cache**ï¼Œä»è€Œå‡å°‘å†—ä½™è®¡ç®—ã€‚

- **KV Cacheé‡ç”¨çš„æŒ‘æˆ˜**ï¼š
  - åœ¨å®é™…çš„LLMç¨‹åºä¸­ï¼Œå¸¸å¸¸éœ€è¦å¤„ç†å¤šä¸ªè¯·æ±‚æˆ–è€…ç”Ÿæˆå¤šä¸ªè¾“å‡ºï¼Œè¿™äº›è¯·æ±‚å¯èƒ½å…±äº«éƒ¨åˆ†å‰ç¼€ã€‚
  - **ç°æœ‰çš„ç³»ç»Ÿæ— æ³•å®Œå…¨è‡ªåŠ¨å¤„ç†å¤æ‚çš„KV Cacheå…±äº«æ¨¡å¼**ï¼Œä¾‹å¦‚æ ‘çŠ¶ç»“æ„å…±äº«ï¼ˆtree-structured sharingï¼‰ã€‚
  - å›¾9å±•ç¤ºäº†å››ç§KV Cacheå…±äº«æ¨¡å¼ï¼ŒåŒ…æ‹¬few-shotå­¦ä¹ ç¤ºä¾‹ã€å¤šè½®å¯¹è¯çš„èŠå¤©å†å²ã€å¤šè¾“å‡ºè‡ªä¸€è‡´æ€§ï¼ˆself-consistencyï¼‰å’Œæ€ç»´æ ‘ï¼ˆtree-of-thoughtï¼‰ä¸­çš„æœç´¢å†å²ã€‚

![](https://img.zhaoweiguo.com/uPic/2025/08/sdBaMW.png)

Figure 9:KV cache sharing examples. Blue boxes represent shareable prompt parts, green boxes indicate non-shareable parts and yellow boxes mark non-shareable model outputs. Shareable elements include few-shot learning examples, questions in self-consistency [53], chat history in multi-turn chat, and search history in tree-of-thought [56].


- **RadixAttentionçš„ä¼˜åŠ¿**ï¼š
  - ä¸ç°æœ‰ç³»ç»Ÿä¸åŒï¼ŒRadixAttentionå¯ä»¥**åœ¨è¿è¡Œæ—¶è‡ªåŠ¨å¤„ç†æ‰€æœ‰å…±äº«æ¨¡å¼**ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚

---

### A.2 Pseudocode for Cache-Aware Scheduling

æœ¬èŠ‚ç»™å‡ºäº†RadixAttentionçš„ç¼“å­˜æ„ŸçŸ¥è°ƒåº¦ç®—æ³•çš„ä¼ªä»£ç ã€‚

- **æ ¸å¿ƒæ€æƒ³**ï¼š
  - é€šè¿‡**å‰ç¼€åŒ¹é…**ï¼ˆprefix matchingï¼‰å’Œ**ç¼“å­˜çŠ¶æ€ç®¡ç†**ï¼ˆé€šè¿‡radixæ ‘å’Œå†…å­˜æ± ï¼‰æ¥é«˜æ•ˆè°ƒåº¦å¤šä¸ªè¯·æ±‚ã€‚
  - **å…³é”®æ­¥éª¤åŒ…æ‹¬**ï¼š
    1. ä»ç­‰å¾…é˜Ÿåˆ—ä¸­è·å–æ‰€æœ‰è¯·æ±‚ã€‚
    2. å¯¹æ¯ä¸ªè¯·æ±‚è¿›è¡Œå‰ç¼€åŒ¹é…ï¼Œæ‰¾åˆ°radixæ ‘ä¸­å¯¹åº”çš„èŠ‚ç‚¹ã€‚
    3. æ ¹æ®åŒ¹é…é•¿åº¦å¯¹è¯·æ±‚æ’åºï¼Œä¼˜å…ˆå¤„ç†åŒ¹é…è¾ƒé•¿çš„è¯·æ±‚ã€‚
    4. ç»„åˆè¯·æ±‚ä¸ºä¸€ä¸ªæ‰¹æ¬¡ï¼ŒåŒæ—¶ç¡®ä¿å†…å­˜å……è¶³æˆ–è¿›è¡Œç¼“å­˜é©±é€ã€‚
    5. è¿è¡Œè¯¥æ‰¹æ¬¡çš„å¤„ç†ï¼Œå¹¶åœ¨å®Œæˆåæ›´æ–°ç¼“å­˜çŠ¶æ€ã€‚

- **é‡ç‚¹æ•°æ®ç»“æ„**ï¼š
  - **Radixæ ‘**ï¼ˆTï¼‰ï¼šç”¨äºç»„ç»‡å’ŒåŒ¹é…è¯·æ±‚çš„å‰ç¼€ã€‚
  - **å†…å­˜æ± **ï¼ˆPï¼‰ï¼šç”¨äºç®¡ç†ç¼“å­˜çš„KV Cacheã€‚
  - **è¿è¡Œæ‰¹**ï¼ˆBï¼‰ï¼šå½“å‰æ­£åœ¨è¿è¡Œçš„è¯·æ±‚ç»„ã€‚
  - **ç­‰å¾…é˜Ÿåˆ—**ï¼ˆQï¼‰ï¼šç­‰å¾…å¤„ç†çš„è¯·æ±‚é˜Ÿåˆ—ã€‚

- **æ€»ç»“**ï¼š
  - è¯¥ç®—æ³•é€šè¿‡**åŠ¨æ€è°ƒåº¦å’Œç¼“å­˜ä¼˜åŒ–**ï¼Œä½¿å¾—å¤šä¸ªå…±äº«å‰ç¼€çš„è¯·æ±‚å¯ä»¥é«˜æ•ˆè¿è¡Œï¼Œæ˜¾è‘—å‡å°‘å†—ä½™è®¡ç®—ã€‚

---

### A.3 Proof of [Theorem 3.1]

æœ¬èŠ‚è¯æ˜äº†**æ·±åº¦ä¼˜å…ˆæœç´¢ï¼ˆDFSï¼‰é¡ºåº**åœ¨ç¼“å­˜å‘½ä¸­ç‡ä¸Šçš„æœ€ä¼˜æ€§ã€‚

- **å®šç†æ ¸å¿ƒ**ï¼š
  - å‡è®¾ä¸€ä¸ªè¯·æ±‚æ‰¹Rï¼Œæ„å»ºçš„radixæ ‘ä¸ºTã€‚
  - å¯¹äºTçš„æ¯æ¡è¾¹eï¼Œå¯¹åº”çš„KV Cacheéœ€è¦è‡³å°‘è®¡ç®—ä¸€æ¬¡ï¼Œå…¶æ€»è®¡ç®—å¤æ‚åº¦ä¸ºCã€‚
  - è¯æ˜äº†DFSé¡ºåºå¯ä»¥**æœ€å°åŒ–C**ï¼Œä»è€Œ**æœ€å¤§åŒ–ç¼“å­˜å‘½ä¸­ç‡**ï¼ˆcache hit rateï¼‰ã€‚

- **å…³é”®ç»“è®º**ï¼š
  - DFSé¡ºåºä¸‹ï¼Œæ¯æ¡è¾¹çš„KV Cacheåªè®¡ç®—ä¸€æ¬¡ã€‚
  - ç¼“å­˜å‘½ä¸­ç‡å…¬å¼ä¸ºï¼š
    $$
    \text{cache hit rate} = 1 - \frac{C}{\sum_{r \in R} \text{number of prefill tokens in } r}
    $$
    - å½“Cæœ€å°åŒ–æ—¶ï¼Œç¼“å­˜å‘½ä¸­ç‡æœ€å¤§ï¼Œè¾¾åˆ°æœ€ä¼˜ã€‚

- **æ‰©å±•ï¼šåœ¨çº¿åœºæ™¯ä¸‹çš„DFSè¡Œä¸º**ï¼š
  - åœ¨æ–°å¢è¯·æ±‚çš„æƒ…å†µä¸‹ï¼Œè™½ç„¶DFSé¡ºåºä¼šè¢«æ‰“æ–­ï¼Œä½†**æœ€é•¿å…±äº«å‰ç¼€ä¼˜å…ˆè°ƒåº¦ï¼ˆlongest-shared-prefix-firstï¼‰ä»èƒ½è¿‘ä¼¼DFSè¡Œä¸º**ã€‚
  - é€šè¿‡ç»´æŠ¤ç¼“å­˜çŠ¶æ€å’Œé€æ­¥å¤„ç†å­æ ‘ï¼Œä»å¯è¾¾åˆ°è‰¯å¥½çš„ç¼“å­˜æ•ˆç‡ã€‚

---

### A.4 Data-Parallel Distributed RadixAttention

æœ¬èŠ‚æ¢è®¨äº†å¦‚ä½•å°†RadixAttentionæ‰©å±•åˆ°**æ•°æ®å¹¶è¡Œ**ï¼ˆdata-parallelï¼‰çš„åˆ†å¸ƒå¼è®¾ç½®ä¸­ã€‚

- **åˆ†å¸ƒå¼è®¾è®¡**ï¼š
  - æ¯ä¸ªworkerç»´æŠ¤ä¸€ä¸ª**å±€éƒ¨çš„å­æ ‘**ï¼ˆsub-treeï¼‰ã€‚
  - è·¯ç”±å™¨ï¼ˆrouterï¼‰ç»´æŠ¤ä¸€ä¸ª**å…ƒæ ‘**ï¼ˆmeta-treeï¼‰ï¼Œè®°å½•æ‰€æœ‰å­æ ‘åŠå…¶æ‰€åœ¨çš„è®¾å¤‡ã€‚
  - æ–°è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œè·¯ç”±å™¨åœ¨å…ƒæ ‘ä¸Šæ‰§è¡Œå‰ç¼€åŒ¹é…ï¼Œå¹¶æ ¹æ®è¯·æ±‚ä¸workerçš„äº²å’Œæ€§ï¼ˆaffinityï¼‰å†³å®šè°ƒåº¦åˆ°å“ªä¸ªworkerã€‚

- **æ›´æ–°ä¸ç¼“å­˜ä¸€è‡´æ€§**ï¼š
  - å„workeråœ¨å¤„ç†æ–°è¯·æ±‚æ—¶ï¼Œ**ç‹¬ç«‹æ›´æ–°è‡ªå·±çš„å­æ ‘**ã€‚
  - å¦‚æœå‘ç”Ÿç¼“å­˜é©±é€ï¼ˆevictionï¼‰ï¼Œworkerå°†é©±é€è®°å½•æäº¤åˆ°é˜Ÿåˆ—ï¼Œç”±è·¯ç”±å™¨åœ¨ä½å³°æ—¶æ®µæ›´æ–°å…ƒæ ‘ã€‚
  - è®¾è®¡ä¸º**å¼±ä¸€è‡´æ€§ç¼“å­˜**ï¼Œåœ¨ä¿è¯æ•ˆç‡çš„åŒæ—¶ç‰ºç‰²éƒ¨åˆ†ä¸€è‡´æ€§ã€‚

- **å®éªŒä¸æ•ˆæœ**ï¼š
  - ä½¿ç”¨å››ä¸ªworkerå’ŒMMLUæ•°æ®é›†è¿›è¡Œæµ‹è¯•ï¼Œç»“æœæ˜¾ç¤ºï¼š
    - **çº¿æ€§æ‰©å±•**ï¼šéšç€workeræ•°é‡å¢åŠ ï¼Œæ€§èƒ½çº¿æ€§æå‡ã€‚
    - **é«˜ç¼“å­˜å‘½ä¸­ç‡**ï¼šå‡ ä¹æ¥è¿‘æœ€ä¼˜ã€‚
    - **ä½å¼€é”€**ï¼šç”±äºå¼±ä¸€è‡´æ€§çš„è®¾è®¡ï¼Œåˆ†å¸ƒå¼ç¼“å­˜çš„é¢å¤–å¼€é”€è¾ƒå°ã€‚

- **æœªæ¥æ–¹å‘**ï¼š
  - **è°ƒåº¦ç­–ç•¥ä¼˜åŒ–**ï¼šæ¢ç´¢æ›´é«˜çº§çš„è°ƒåº¦ç­–ç•¥ï¼Œä»¥å¹³è¡¡æ•°æ®æœ¬åœ°æ€§å’Œå¹¶è¡Œæ•ˆç‡ä¹‹é—´çš„æƒè¡¡ã€‚
  - **ç›¸å…³ç ”ç©¶**ï¼šPrebleçš„å·¥ä½œåŸºäºSGLangçš„æ—©æœŸç‰ˆæœ¬ï¼Œç ”ç©¶äº†æ•°æ®å¹¶è¡Œè°ƒåº¦ã€‚

---

### æ€»ç»“

æœ¬é™„å½•è¯¦ç»†ä»‹ç»äº†RadixAttentionåœ¨KV Cacheç®¡ç†å’Œè°ƒåº¦æ–¹é¢çš„æ ¸å¿ƒæŠ€æœ¯ï¼ŒåŒ…æ‹¬ï¼š

1. **KV Cacheå…±äº«ä¸ä¼˜åŒ–**ï¼šé€šè¿‡radixæ ‘ç»“æ„å®ç°é«˜æ•ˆå…±äº«ï¼Œå‡å°‘å†—ä½™è®¡ç®—ã€‚
2. **ç¼“å­˜æ„ŸçŸ¥è°ƒåº¦ç®—æ³•**ï¼šå®ç°äº†è¿ç»­æ‰¹å¤„ç†ä¸åŠ¨æ€è°ƒåº¦ï¼Œæ”¯æŒå¤æ‚è¯·æ±‚æ¨¡å¼ã€‚
3. **ç†è®ºè¯æ˜**ï¼šDFSé¡ºåºæœ€ä¼˜ï¼Œæœ€é•¿å…±äº«å‰ç¼€è°ƒåº¦å¯è¿‘ä¼¼DFSè¡Œä¸ºã€‚
4. **åˆ†å¸ƒå¼æ‰©å±•**ï¼šæ”¯æŒæ•°æ®å¹¶è¡Œï¼Œé€šè¿‡å…ƒæ ‘å’Œå­æ ‘ç»“æ„å®ç°å¼±ä¸€è‡´æ€§ç¼“å­˜ç®¡ç†ã€‚

è¿™äº›æŠ€æœ¯å…±åŒæå‡äº†å¤§è¯­è¨€æ¨¡å‹åœ¨**å¹¶å‘ã€å¤æ‚è¯·æ±‚åœºæ™¯ä¸‹çš„è¿è¡Œæ•ˆç‡å’Œèµ„æºåˆ©ç”¨ç‡**ã€‚


## Appendix B Additional Details on Compressed Finite State Machine

![](https://img.zhaoweiguo.com/uPic/2025/08/fOqkfh.png)

Figure 10:Example of how regex is converted into FSM and how FSM guides the decoding process. 


æœ¬èŠ‚ä¸»è¦ä»‹ç»å‹ç¼©æœ‰é™çŠ¶æ€æœºçš„èƒŒæ™¯åŠå…¶åœ¨**åŠ é€Ÿçº¦æŸè§£ç **ä¸­çš„å®ç°ç»†èŠ‚ã€‚ç›®æ ‡æ˜¯ä½¿è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è¾“å‡ºçš„å†…å®¹éµå¾ª**æ­£åˆ™è¡¨è¾¾å¼ï¼ˆregexï¼‰**çš„çº¦æŸï¼Œä»è€Œå¯ä»¥ç”¨äºç”Ÿæˆç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚ JSON æ ¼å¼ï¼‰ã€‚ä¸ºæ­¤ï¼Œä½œè€…å°†æ­£åˆ™è¡¨è¾¾å¼è½¬æ¢ä¸º**æœ‰é™çŠ¶æ€æœºï¼ˆFSMï¼‰**ï¼Œå¹¶åœ¨è§£ç è¿‡ç¨‹ä¸­ä½¿ç”¨è¯¥çŠ¶æ€æœºæ¥æŒ‡å¯¼ç”Ÿæˆè¿‡ç¨‹ [[54]](https://arxiv.org/html/2312.07104v2#bib.bib54)ã€‚

### FSM çš„åŸºæœ¬åŸç†

FSM æ˜¯ä¸€ç§ç”±**çŠ¶æ€èŠ‚ç‚¹**å’Œ**å¸¦å­—ç¬¦ä¸²çš„è½¬ç§»è¾¹**æ„æˆçš„å›¾ç»“æ„ã€‚è§£ç è¿‡ç¨‹ä»åˆå§‹çŠ¶æ€å‡ºå‘ï¼Œé€šè¿‡é€‰æ‹©è¾¹ä¸Šçš„å­—ç¬¦ä¸²é€æ­¥è½¬ç§»çŠ¶æ€ï¼Œç›´åˆ°åˆ°è¾¾**ç»ˆæ­¢çŠ¶æ€**ã€‚è¿™ä¸ªæœºåˆ¶å¯ä»¥**è¿‡æ»¤æ‰ä¸ç¬¦åˆ regex çš„ token**ï¼Œä»è€Œå®ç°ç»“æ„åŒ–è¾“å‡ºã€‚å¦‚å›¾ 10 æ‰€ç¤ºï¼ŒLLM åœ¨è§£ç è¿‡ç¨‹ä¸­ä¼šæ ¹æ®å½“å‰ FSM æ‰€å¤„çš„çŠ¶æ€ï¼Œé™åˆ¶ä¸‹ä¸€æ­¥å¯èƒ½ç”Ÿæˆçš„ tokenã€‚

å›¾ 10 å±•ç¤ºäº† regex è½¬æ¢ä¸º FSM çš„è¿‡ç¨‹ï¼Œå¹¶è¯´æ˜ FSM å¦‚ä½•å¼•å¯¼è§£ç æµç¨‹ã€‚

---

### æŒ‘æˆ˜ï¼šå­—ç¬¦ä¸²ä¸ token çš„æ˜ å°„é—®é¢˜

æ­£åˆ™è¡¨è¾¾å¼æ˜¯åŸºäºå­—ç¬¦ä¸²çš„ï¼Œè€Œ LLM æ˜¯åŸºäº token çš„ï¼Œå› æ­¤å­˜åœ¨**å­—ç¬¦ä¸²ä¸ token ä¹‹é—´ç¼ºä¹ä¸€ä¸€å¯¹åº”**çš„é—®é¢˜ï¼Œå¯¼è‡´çº¦æŸè§£ç å¤æ‚åŒ–ã€‚è¿™ä¹Ÿæ˜¯å‹ç¼©æœ‰é™çŠ¶æ€æœºè®¾è®¡çš„ä¸€ä¸ªæ ¸å¿ƒæŒ‘æˆ˜ã€‚

---

æœ¬èŠ‚å†…å®¹æ”¹ç¼–è‡ªä¸€ç¯‡æ—©æœŸåšå®¢[[333]](https://lmsys.org/blog/2024-02-05-compressed-fsm/)ï¼Œå»ºè®®è¯»è€…é˜…è¯»ä»¥è·å¾—æ›´æ·±å…¥çš„èƒŒæ™¯çŸ¥è¯†ã€‚

---

### B.1 å‹ç¼©æœ‰é™çŠ¶æ€æœºçš„å®ç°ç»†èŠ‚

ä¸ºäº†ç®€åŒ–å‹ç¼© FSM çš„æ„å»ºï¼Œä½œè€…é¦–å…ˆåŸºäº**å­—ç¬¦/å­—ç¬¦ä¸²**æ„å»ºåŸå§‹ FSMï¼Œè€Œéç›´æ¥åŸºäº tokenã€‚è¿™ä¸€æ­¥éª¤ä¸ºåç»­çš„å‹ç¼©å¥ å®šäº†åŸºç¡€ã€‚

#### å…³é”®æ¦‚å¿µå®šä¹‰ï¼š

- **Singular transition edgeï¼ˆå•å‘è½¬ç§»è¾¹ï¼‰**ï¼šå¦‚æœä¸€ä¸ªè¾¹çš„**èµ·ç‚¹èŠ‚ç‚¹åªæœ‰ä¸€ä¸ªåç»­èŠ‚ç‚¹**ï¼Œå¹¶ä¸”è¯¥è¾¹**åªæ¥å—ä¸€ä¸ªç‰¹å®šçš„å­—ç¬¦/å­—ç¬¦ä¸²**ï¼Œåˆ™ç§°ä¸ºå•å‘è¾¹ã€‚
- **Compressed edgeï¼ˆå‹ç¼©è¾¹ï¼‰**ï¼šå½“å¤šä¸ªè¿ç»­çš„å•å‘è¾¹å¯ä»¥è¢«å‹ç¼©ä¸ºä¸€ä¸ªè¾¹æ—¶ï¼Œå…¶æ–‡æœ¬ä¸ºè¿™äº›è¾¹æ–‡æœ¬çš„æ‹¼æ¥ã€‚å‹ç¼©ç›´åˆ°æ— æ³•è¿›ä¸€æ­¥å‹ç¼©ä¸ºæ­¢ã€‚

é€šè¿‡é€’å½’åœ°å°†å•å‘è¾¹åˆå¹¶åˆ°å…¶å‰è¾¹ä¸­ï¼Œæœ€ç»ˆè·å¾—ä¸€ä¸ªå‹ç¼©åçš„ FSMã€‚è¿™ç§æ–¹å¼èƒ½æ˜¾è‘—**æå‡è§£ç æ•ˆç‡**ï¼Œå¦‚å›¾ 11 æ‰€ç¤ºï¼Œå±•ç¤ºäº†å‹ç¼© FSM ç›¸æ¯”äºæ™®é€š FSM åœ¨è¿è¡Œæ•ˆç‡ä¸Šçš„æå‡ã€‚

å›¾ 11 å¯¹æ¯”äº†å‹ç¼© FSM ä¸æ™®é€š FSM çš„è§£ç è¿‡ç¨‹ï¼Œå·¦ä¾§æ˜¾ç¤ºæ¯ä¸ªå‰å‘ä¼ æ’­çš„è§£ç è¿‡ç¨‹ï¼Œå³ä¾§è§£é‡Šäº†ç»“æœçš„æ„æˆæ¥æºã€‚

![](https://img.zhaoweiguo.com/uPic/2025/08/SFJB5E.png)

Figure 11:Comparison of decoding using Compressed FSM versus normal FSM: The left subfigure depicts the decoding process per forward pass, while the right subfigure explains the origins of various result components.


---

### B.2 é€šè¿‡é‡åˆ†è¯å¤„ç† token åŒ–ä¼ªå½±ï¼ˆRetokenizationï¼‰

åœ¨ç”Ÿæˆä¸€ä¸ªæ–° token åï¼Œç³»ç»Ÿä¼šè·å–å…¶å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨å½“å‰çŠ¶æ€çš„æ‰€æœ‰å‡ºè¾¹ä¸­æŸ¥æ‰¾åŒ¹é…çš„è¾¹ã€‚è‹¥è¯¥è¾¹æ˜¯å‹ç¼©è¾¹ï¼ˆåŒ…å«è¾ƒé•¿çš„å­—ç¬¦ä¸²ï¼‰ï¼Œåˆ™å¯ä»¥**æå‰é¢„æµ‹åç»­çš„ token å†…å®¹**ï¼Œè¿™ç§æœºåˆ¶ç§°ä¸º**Jump Forwardï¼ˆè·³è·ƒå‰è¿›ï¼‰**ï¼Œä»è€ŒåŠ é€Ÿè§£ç ã€‚

ä½†ç”±äº LLM çš„ token åŒ–æ–¹å¼ä¸ç›´æ¥å­—ç¬¦ä¸²åˆ†å‰²ä¸åŒï¼Œç›´æ¥åˆ†å‰²å­—ç¬¦ä¸²å¯èƒ½ä¼šç ´åè¯­ä¹‰ã€‚ä¾‹å¦‚ï¼Œå‹ç¼©å­—ç¬¦ä¸² `{"summary":` å¯èƒ½è¢«æ­£ç¡® token åŒ–ä¸º `{", summary, ":`ï¼Œè€Œéé”™è¯¯åœ°æ‹†åˆ†ä¸º `{", summa, ry, ...`ã€‚

ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç³»ç»Ÿåœ¨å¤„ç†å‹ç¼©è¾¹æ—¶ï¼Œä½¿ç”¨**åŸå§‹ tokenizer** å¯¹**æ•´ä¸ªå‹ç¼©è¾¹æ–‡æœ¬**è¿›è¡Œé‡åˆ†è¯ï¼Œç¡®ä¿ä¸ LLM çš„è¾“å…¥æ ¼å¼ä¸€è‡´ã€‚è¯¥æ­¥éª¤å¸¦æ¥çš„é¢å¤–å¼€é”€è¾ƒå°ã€‚

---

### B.3 æœªæ¥æ‰©å±•ï¼šå¤„ç†æ¦‚ç‡åˆ†å¸ƒå¤±çœŸé—®é¢˜

ç”±äºå­—ç¬¦ä¸²ä¸ token ä¹‹é—´çš„æ˜ å°„é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´**æ¦‚ç‡åˆ†å¸ƒçš„æ‰­æ›²** [[50]](https://arxiv.org/html/2312.07104v2#bib.bib50)ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå‹ç¼©è¾¹å¯èƒ½å°†å¤šä¸ªå¯èƒ½çš„ token åºåˆ—æ˜ å°„åˆ°åŒä¸€ä¸ªé€‰é¡¹ï¼Œè€Œæ¨¡å‹å¯èƒ½ä¼šé”™è¯¯åœ°é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„é‚£ä¸ªï¼Œä»è€Œå¯¼è‡´è¯­ä¹‰ä¸ä¸€è‡´ã€‚

ä¾‹å¦‚ï¼Œæ­£åˆ™è¡¨è¾¾å¼ `[ABCD][+-]?` ç”¨äºè¡¨ç¤º A+ åˆ° D- çš„æˆç»©ï¼Œä½†è‹¥å°†å…¶æ›¿æ¢ä¸º `Excellent|Above Average|Fair|Below Average`ï¼Œæ¨¡å‹å¯èƒ½é”™è¯¯åœ°å°† "A" æ˜ å°„ä¸º "Above Average"ï¼Œå› ä¸ºåè€…åœ¨å‹ç¼©è¾¹ä¸­å‡ºç°ï¼Œå¯¼è‡´**ç­‰çº§æ’åºæ··ä¹±**ã€‚

è§£å†³æ–¹æ³•ä¹‹ä¸€æ˜¯**åœ¨é¢„å¡«å……æç¤ºï¼ˆprefill promptï¼‰ä¸­åŠ å…¥é€‰é¡¹æˆ– regex**ï¼Œå¼•å¯¼æ¨¡å‹ç”Ÿæˆæ­£ç¡®çš„ token åºåˆ—ã€‚ä½†è¿™ç§æ–¹æ³•ä»…æ˜¯è¡¨é¢è§£å†³ï¼Œ**æ— æ³•ä»æ ¹æœ¬ä¸Šè§£å†³æ¦‚ç‡å¤±çœŸé—®é¢˜**ã€‚å› æ­¤ï¼Œä½œè€…æŒ‡å‡ºè¿™ä¸€æ–¹å‘ä»éœ€è¿›ä¸€æ­¥ç ”ç©¶ï¼Œä»¥æå‡å‹ç¼© FSM çš„å‡†ç¡®æ€§ã€‚

---

### æ€»ç»“

æœ¬èŠ‚è¯¦ç»†ä»‹ç»äº†å‹ç¼©æœ‰é™çŠ¶æ€æœºï¼ˆCompressed FSMï¼‰åœ¨çº¦æŸè§£ç ä¸­çš„å®ç°æœºåˆ¶ï¼ŒåŒ…æ‹¬ï¼š

- å°† regex è½¬æ¢ä¸º FSMï¼Œå¹¶ç”¨äºæ§åˆ¶è§£ç æµç¨‹ï¼›
- é€šè¿‡**å‹ç¼© FSM** æå‡è§£ç æ•ˆç‡ï¼›
- é€šè¿‡**é‡åˆ†è¯**å¤„ç† token åŒ–çš„ä¸ä¸€è‡´æ€§ï¼›
- æŒ‡å‡ºæœªæ¥éœ€è¦è§£å†³çš„**æ¦‚ç‡åˆ†å¸ƒæ‰­æ›²**é—®é¢˜ã€‚

æ•´ä½“æ¥çœ‹ï¼Œå‹ç¼© FSM æ˜¯å®ç°ç»“æ„åŒ–è¾“å‡ºçš„ä¸€ä¸ªå…³é”®æŠ€æœ¯ï¼Œä½†å…¶åœ¨ token åŒ–å’Œæ¦‚ç‡å»ºæ¨¡æ–¹é¢ä»é¢ä¸´æŒ‘æˆ˜ï¼Œéœ€è¦è¿›ä¸€æ­¥ç ”ç©¶ä¸ä¼˜åŒ–ã€‚


## Appendix C Additional Experimental Setups and Results



### å…¶ä»–å®éªŒè®¾ç½®

æœ¬éƒ¨åˆ†ä»‹ç»äº†ä¸€äº›é¢å¤–å®éªŒçš„ç¡¬ä»¶é…ç½®ä¸æ¨¡å‹è¿è¡Œæƒ…å†µï¼š

- **å›¾5** å’Œ **å›¾6** çš„å®éªŒæ˜¯åœ¨å•å— A10Gï¼ˆ24GBï¼‰GPU ä¸Šè¿è¡Œ Llama-7B æ¨¡å‹è·å¾—çš„ã€‚
- **å›¾7** çš„å®éªŒæ˜¯åœ¨ 8 å— A10Gï¼ˆ24GBï¼‰GPU ä¸Šä½¿ç”¨ **å¼ é‡å¹¶è¡Œï¼ˆTensor Parallelismï¼‰** æŠ€æœ¯è¿è¡Œ Mixtral-8x7B æ¨¡å‹è·å¾—çš„ã€‚
- **å›¾8(c)** çš„å®éªŒåŒæ ·æ˜¯åœ¨å•å— A10Gï¼ˆ24GBï¼‰GPU ä¸Šè¿è¡Œ Llama-7B æ¨¡å‹ã€‚
- **å›¾12** çš„å®éªŒæ˜¯åœ¨ 4 å— A100Gï¼ˆ80GBï¼‰GPU ä¸Šè¿è¡Œ Llama-70B æ¨¡å‹ï¼ŒåŒæ ·ä½¿ç”¨äº†å¼ é‡å¹¶è¡Œã€‚
- **è¡¨2** ä¸­çš„å®éªŒåˆ†åˆ«åœ¨å•å— A10Gï¼ˆ24GBï¼‰GPU ä¸Šè¿è¡Œ LLaVA-v1.5-7B æ¨¡å‹ï¼Œä»¥åŠåœ¨å•å— A100Gï¼ˆ80GBï¼‰GPU ä¸Šè¿è¡Œ LLaVA-Next-34B æ¨¡å‹ã€‚

> âš ï¸ æ³¨ï¼šæ¯ä¸ªåŸºå‡†æµ‹è¯•å›¾ä¸­çš„æŸ±çŠ¶å›¾éœ€è¦è¿è¡Œæ•°åˆ†é’Ÿåˆ°ä¸€å°æ—¶ä¸ç­‰ï¼Œè¯´æ˜å®éªŒè€—æ—¶è¾ƒé•¿ï¼Œå¯¹ç¡¬ä»¶è®¾å¤‡è¦æ±‚è¾ƒé«˜ã€‚

---

### å…¶ä»–å®éªŒç»“æœ

- **å›¾13** å±•ç¤ºäº†åœ¨ä¸åŒåŸºå‡†æµ‹è¯•ä¸­ï¼Œ**å®é™…ç¼“å­˜å‘½ä¸­ç‡** ä¸ **ç†æƒ³ç¼“å­˜å‘½ä¸­ç‡** çš„å¯¹æ¯”ï¼Œç”¨äºè¯„ä¼°ç¼“å­˜æ•ˆç‡ã€‚
- **å›¾12ï¼ˆå¦‚å›¾ x12 æ‰€ç¤ºï¼‰** å±•ç¤ºäº†åœ¨ä½¿ç”¨å¼ é‡å¹¶è¡ŒæŠ€æœ¯è¿è¡Œ Llama-2-70B æ¨¡å‹æ—¶çš„**ååé‡ï¼ˆthroughputï¼‰**ã€‚è¯¥å›¾æ˜¾ç¤ºäº†ä¸åŒé…ç½®ä¸‹çš„æ€§èƒ½è¡¨ç°ï¼Œ**å€¼è¶Šé«˜è¶Šå¥½**ã€‚

> âœ… **é‡ç‚¹å†…å®¹**ï¼šå›¾12 å’Œ å›¾13 æ˜¯å…³é”®çš„æ€§èƒ½è¯„ä¼°å›¾ã€‚å›¾12 ç”¨äºè¯„ä¼°å¤§è§„æ¨¡æ¨¡å‹åœ¨å¹¶è¡Œè®¡ç®—ä¸‹çš„ååæ€§èƒ½ï¼Œå›¾13 ç”¨äºè¯„ä¼°ç¼“å­˜æœºåˆ¶çš„ä¼˜åŒ–æ•ˆæœã€‚

---

### SGLang ç¨‹åºä¸æ•°æ®æµå›¾ï¼ˆå›¾14ï¼‰

![](https://img.zhaoweiguo.com/uPic/2025/08/KlfFN4.jpg)

Figure 14: An SGLang program and its corresponding dataflow graph.

å›¾14 åŒ…å«ä¸¤éƒ¨åˆ†å†…å®¹ï¼š

- **å›¾14(a)** å±•ç¤ºäº†ä¸€ä¸ª SGLang ç¨‹åºï¼Œç”¨äºå¹¶è¡Œæç¤ºå»ºè®®ï¼ˆtip suggestionï¼‰ä»»åŠ¡ï¼Œä½¿ç”¨äº†éª¨æ¶æ€ç»´æç¤ºï¼ˆskeleton-of-thought promptingï¼‰çš„æ–¹æ³•ã€‚

- **å›¾14(b)** å±•ç¤ºäº†ä¸Šè¿°ç¨‹åºçš„**è®¡ç®—å›¾ï¼ˆæ•°æ®æµå›¾ï¼‰**ï¼Œå…¶ä¸­ä¸‰ä¸ªæµï¼ˆstreamï¼‰åˆ†åˆ«å¯¹åº”ä¸‰ä¸ªå‡½æ•°è°ƒç”¨ï¼Œä½“ç°äº†ç¨‹åºçš„ç»“æ„åŒ–æ‰§è¡Œæµç¨‹ã€‚

> âœ… **é‡ç‚¹å†…å®¹**ï¼šè¿™éƒ¨åˆ†å±•ç¤ºäº† SGLang çš„ç»“æ„åŒ–æ‰§è¡Œç‰¹æ€§ï¼Œé€šè¿‡æ•°æ®æµå›¾æ¸…æ™°å±•ç¤ºäº†å¹¶è¡Œä¸å‡½æ•°è°ƒç”¨ä¹‹é—´çš„å…³ç³»ï¼Œæ˜¯ç†è§£ SGLang æ‰§è¡Œæœºåˆ¶çš„é‡è¦éƒ¨åˆ†ã€‚


## Appendix D Compiler Mode


## Appendix D ç¼–è¯‘å™¨æ¨¡å¼

é™¤äº†è®ºæ–‡ä¸»ä½“ä¸­ä½¿ç”¨çš„è§£é‡Šå™¨æ¨¡å¼ï¼ŒSGLang ç¨‹åºè¿˜å¯ä»¥é€šè¿‡ç¼–è¯‘ä¸º**è®¡ç®—å›¾**å¹¶åœ¨å›¾æ‰§è¡Œå™¨ä¸­è¿è¡Œã€‚è¿™ç§æ–¹å¼ä¸º**æ›´å¤šçš„ç¼–è¯‘ä¼˜åŒ–**æä¾›äº†å¯èƒ½ï¼Œä¾‹å¦‚å¯¹å›¾è¿›è¡Œé‡å†™å’Œè¿›è¡Œæ›´é™æ€çš„è§„åˆ’ã€‚

---

### D.1 è®¾è®¡ä¸å®ç°

æœ¬èŠ‚ä»‹ç»äº†ä¸º SGLang è®¾è®¡çš„**ä¸­é—´è¡¨ç¤ºï¼ˆIRï¼‰**ï¼Œå®ƒå°† SGLang ç¨‹åºçš„ç»“æ„å’Œæ“ä½œè¡¨ç¤ºä¸ºä¸€ä¸ªè®¡ç®—å›¾ã€‚è¯¥å›¾åŒ…æ‹¬**æ“ä½œç¬¦èŠ‚ç‚¹**å’Œ**ä¾èµ–å…³ç³»è¾¹**ï¼Œç”¨äºè¡¨ç¤ºç¨‹åºä¸­çš„ç»“æ„å’Œæ‰§è¡Œé¡ºåºã€‚

- **èŠ‚ç‚¹ç±»å‹**åŒ…æ‹¬ï¼š`ConstantText`ï¼ˆå¸¸é‡æ–‡æœ¬ï¼‰ã€`Argument`ï¼ˆå‚æ•°ï¼‰ã€`Gen`ï¼ˆç”Ÿæˆï¼‰ã€`Select`ï¼ˆé€‰æ‹©ï¼‰ã€`Variable`ï¼ˆå˜é‡ï¼‰ã€`Fork`ï¼ˆåˆ†å‰ï¼‰ã€`GetForkItem`ï¼ˆè·å–åˆ†å‰é¡¹ï¼‰ã€`Join`ï¼ˆåˆå¹¶ï¼‰ç­‰ã€‚
- **ä¾èµ–å…³ç³»**åˆ†ä¸ºä¸¤ç±»ï¼š
  - **æµå†…ä¾èµ–ï¼ˆintra-streamï¼‰**ï¼šåŒä¸€æµä¸­é€šè¿‡ `+=` æäº¤çš„æ“ä½œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œã€‚
  - **æµé—´ä¾èµ–ï¼ˆinter-streamï¼‰**ï¼šå½“ä¸€ä¸ªæµéœ€è¦ä»å¦ä¸€ä¸ªæµè·å–å˜é‡å€¼æ—¶ï¼Œå¿…é¡»è¿›è¡ŒåŒæ­¥ã€‚
- **å›¾ç”Ÿæˆæ–¹å¼**é€šè¿‡**è¿½è¸ªï¼ˆtracingï¼‰**è¿è¡Œç¨‹åºï¼Œä½¿ç”¨æŠ½è±¡å‚æ•°åŠ¨æ€æ„å»ºå›¾ã€‚è¿™ç§æ–¹å¼**ä¸é€‚ç”¨äºåŒ…å«æ•°æ®ä¾èµ–æ§åˆ¶æµçš„ç¨‹åº**ï¼Œè¿™æ˜¯æœªæ¥éœ€è¦è§£å†³çš„é—®é¢˜ã€‚
- ä¸€æ—¦å›¾æ„å»ºå®Œæˆï¼Œå³å¯é€šè¿‡å›¾æ‰§è¡Œå™¨è¿è¡Œï¼Œæ— éœ€é‡æ–°è§£é‡ŠåŸå§‹ Python ç¨‹åºã€‚è¿™å¸¦æ¥äº†**å›¾é‡å†™ä¼˜åŒ–ã€è¿è¡Œæ—¶å¼€é”€é™ä½å’Œç¨‹åºåºåˆ—åŒ–**ç­‰ä¼˜åŠ¿ã€‚
- æ‰§è¡Œæ—¶ï¼Œä¸ºæ¯ä¸ªæ•°æ®æµå¯åŠ¨ä¸€ä¸ª**æµæ‰§è¡Œå™¨**ï¼Œæ ¹æ®æ‹“æ‰‘é¡ºåºå°† IR èŠ‚ç‚¹åˆ†å‘åˆ°æµä¸­ã€‚

---

### D.2 ç¼–è¯‘ä¼˜åŒ–æ¡ˆä¾‹ç ”ç©¶ï¼šä»£ç ç§»åŠ¨ä»¥æé«˜å‰ç¼€å…±äº«

æœ¬èŠ‚æ¢è®¨äº†ä¸€ç§é’ˆå¯¹ SGLang IR çš„**ç¼–è¯‘ä¼˜åŒ–æŠ€æœ¯**ï¼šé€šè¿‡**ä»£ç ç§»åŠ¨**æ¥**æé«˜å‰ç¼€å…±äº«**ã€‚è¿™ç§ä¼˜åŒ–é€šè¿‡**è°ƒæ•´å›¾ä¸­èŠ‚ç‚¹é¡ºåº**ï¼Œæ¥**å»¶é•¿å¯å…±äº«çš„æ–‡æœ¬å‰ç¼€é•¿åº¦**ã€‚è¿™ç§ä¼˜åŒ–å±äº**æ¿€è¿›ç±»å‹**ï¼Œå› ä¸ºå®ƒ**ä¸ä¸¥æ ¼ä¿æŒåŸè®¡ç®—é¡ºåº**ã€‚

- **ä¼˜åŒ–ç¤ºä¾‹**ï¼šå°†æç¤ºè¯­ä» â€œHere is a question + {question}. Please act as a math expert...â€ é‡å†™ä¸º â€œPlease act as a math expert... Here is a question + {question}.â€ï¼Œä»è€Œä½¿å¾—å‰ç¼€æ›´é•¿ã€å…±äº«æ›´å¥½ã€‚
- **ä¼˜åŒ–å®ç°æ–¹å¼**ï¼šç”±äºä¼ ç»Ÿç¨‹åºåˆ†ææ–¹æ³•éš¾ä»¥å¤„ç†è‡ªç„¶è¯­è¨€ï¼Œæˆ‘ä»¬**ä½¿ç”¨ GPT-4** æ¥å¯¹å›¾èŠ‚ç‚¹è¿›è¡Œé‡æ–°æ’åºã€‚
- **å®éªŒè®¾è®¡**ï¼šæ”¶é›†äº† 20 ä¸ªæç¤ºæ¨¡æ¿ï¼Œå…¶ä¸­ 5 ä¸ªä½œä¸ºç¤ºä¾‹ï¼Œå…¶ä½™ 15 ä¸ªä½œä¸ºæµ‹è¯•ç”¨ä¾‹ã€‚
- **ä¼˜åŒ–æ•ˆæœ**ï¼šåœ¨ 15 ä¸ªæµ‹è¯•æ¨¡æ¿ä¸­ï¼ŒGPT-4 æˆåŠŸå¯¹ 12 ä¸ªè¿›è¡Œäº†æ— è¯­ä¹‰å˜åŒ–çš„é‡æ’åºï¼Œå¹³å‡**å‰ç¼€å…±äº«é•¿åº¦å¢åŠ äº† 60 ä¸ª token**ã€‚
- **å¤±è´¥åŸå› **ï¼šéƒ¨åˆ†å¤±è´¥æ˜¯ç”±äº GPT-4 å¯¹å›¾èŠ‚ç‚¹çš„è¯­ä¹‰ç†è§£ä¸å‡†ç¡®ï¼Œå¯¼è‡´é”™è¯¯åœ°å°†æ‰€æœ‰å¸¸é‡å‰ç½®ï¼Œæ”¹å˜äº†åŸä¹‰ã€‚
- **ç ”ç©¶æ„ä¹‰**ï¼šæœ¬æ¡ˆä¾‹æ¢è®¨äº†**ä½¿ç”¨ GPT-4 å®ç°ç¼–è¯‘å™¨ä¼˜åŒ–çš„å¯è¡Œæ€§**ï¼Œä½†æŒ‡å‡ºæœªæ¥ä»éœ€è¿›ä¸€æ­¥æé«˜è¿™ç±»ä¼˜åŒ–çš„**å¯é æ€§**ã€‚

---

### æ€»ç»“

- **ç¼–è¯‘å™¨æ¨¡å¼**ä¸º SGLang æä¾›äº†æ€§èƒ½ä¼˜åŒ–çš„æ–°æ–¹å‘ï¼šé€šè¿‡å›¾æ‰§è¡Œå™¨æ‰§è¡Œç¨‹åºï¼Œå¸¦æ¥æ›´é«˜æ•ˆã€æ›´çµæ´»çš„æ‰§è¡Œæ–¹å¼ã€‚
- **ä¸­é—´è¡¨ç¤ºï¼ˆIRï¼‰**çš„è®¾è®¡æ˜¯å…³é”®ï¼Œå®ƒæ”¯æŒèŠ‚ç‚¹ä¾èµ–åˆ†æã€å›¾é‡å†™ç­‰é«˜çº§ç¼–è¯‘ä¼˜åŒ–ã€‚
- **ä»£ç ç§»åŠ¨ä¼˜åŒ–**å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨ LLMï¼ˆå¦‚ GPT-4ï¼‰å®ç°è‡ªç„¶è¯­è¨€æ§åˆ¶æµçš„ä¼˜åŒ–ï¼Œè¿™æ˜¯ä¼ ç»Ÿç¼–è¯‘å™¨éš¾ä»¥å¤„ç†çš„é—®é¢˜ã€‚
- **æœªæ¥å·¥ä½œ**åŒ…æ‹¬æ”¯æŒæ•°æ®ä¾èµ–æ§åˆ¶æµã€æé«˜ GPT ç±»æ¨¡å‹åœ¨ç¼–è¯‘ä¼˜åŒ–ä¸­çš„å¯é æ€§ç­‰ã€‚

--- 

ä»¥ä¸Šæ˜¯å¯¹ Appendix D å†…å®¹çš„ç»“æ„åŒ–æ€»ç»“ï¼Œé‡ç‚¹å¼ºè°ƒäº† IR è®¾è®¡ã€å›¾æ‰§è¡Œæœºåˆ¶ã€ä»£ç ç§»åŠ¨ä¼˜åŒ–æ–¹æ³•åŠå…¶å®éªŒç»“æœã€‚
