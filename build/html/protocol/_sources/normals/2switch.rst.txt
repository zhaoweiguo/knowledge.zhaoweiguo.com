2switch交换机
#############

二层交换机
==========

::

    这是一个二层设备
    二层交换机在转发报文时，使用的是 MAC 表。根据 MAC 地址确定目的主机所在端口。


交换机 MAC 地址表(转发表)::

    MAC 地址                网线端口
    f8:a2:d6:eb:82:31        端口2
    1:0:5e:7f:ff:fa          端口5
    ...                      ...

    注: 支持 VLAN 的交换机，转发表也会多 VLAN ID 这个字段

.. note:: 交换机端口的 MAC 模块不具有 MAC 地址。网卡本身具有 MAC 地址，并通过核对收到的包的接收方 MAC 地址判断是不是发给自己的，如果不是发给自己的则丢弃。而交换机的端口不核对接收方 MAC 地址，而是直接接收所有的包并存放到缓冲区中。

.. note:: “交换机”这个词也是从交换电路来的。交换机的全双工模式可以同时发送和接收信号。


.. note:: 在以太网中，当没有数据在传输时，网络中会填充一种被称为连接脉冲的脉冲信号。


其他类似设备::

    集线器
    交叉双绞线

广播风暴
--------

定义::

    如果交换机插口没有插对，形成环路的话，就会导致广播风暴:

    数据包经过交换机 A 到达交换机 B，交换机 B 又将包复制为多份广播出去。
    如整个局域网存在环路，使得数据包又重新回到最开始的交换机 A，这个包又会被 A 复制多份广播出去。
    如此循环，数据包会不停得转发，而且越来越多，最终占满带宽，或者使解析协议的硬件过载


实例::

    交换机，把一条网线的 2 端同时接到交换机了，结果所有连这交换机的电脑都连不上网了
    原因: arp 广播塞满了

STP
---

* STP: Spanning Tree Protocol::
  
    Root Bridge，也就是根交换机
    Designated Bridges，指定交换机
    Bridge Protocol Data Units （BPDU），网桥协议数据单元
    Priority Vector，优先级向量

    对应的算法是 STA（spanning-tree algorithm）

    stp 的缺点就是，当掌门死了或者有新人进入江湖，江湖上就又要经历一场血雨腥风，如果江湖很大的话，就会血雨腥风很久……

* trunk 口: 可以转发属于任何 VLAN 的口。交换机之间可以通过这种口相互连接。


三层交换机
==========

* 三层交换机在转发报文时，使用 ARP 表。根据 IP 地址确定目的 MAC 和所在端口。
* 现在三层交换机是主流










