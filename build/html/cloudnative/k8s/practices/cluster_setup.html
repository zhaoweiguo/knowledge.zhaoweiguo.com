

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>


<!-- start added 2025-04-14   增加对markdown中公式的支持 -->
<script>
window.MathJax = {
    tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true
    },
    options: {
        ignoreHtmlClass: "tex2jax_ignore|mathjax_ignore",
        processHtmlClass: "tex2jax_process|mathjax_process|math|output_area"
    }
};
</script>
<script defer="defer" src="https://fastly.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<!-- end added 2025-04-14   增加对markdown中公式的支持 -->


  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.5.1. Kubernetes集群组建 &mdash; 新溪-gordon V2025.06 文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="next" title="3.5.2. Kubernetes集群重建" href="cluster_rebuild.html" />
    <link rel="prev" title="3.5. k8s实战" href="../practice.html" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>
  <script src="../../_static/js/jquery.min.js"></script>


<!-- 评论插件 gittalk start -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> -->
<!-- 评论插件 gittalk end -->


</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> 新溪-gordon
          

          
          </a>

          
            
            
              <div class="version">
                V2025.06
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">云原生</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../normal.html">1. 常用</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../normals/tmp.html">1.1. 临时</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../normals/OCI.html">1.2. OCI-Open Container Initiative</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../docker.html">2. Docker相关</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../dockers/normal.html">2.1. 常用</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/normals/normal.html">2.1.1. 常用</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/normals/nomad.html">2.1.2. nomad</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/normals/rancher.html">2.1.3. Rancher</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/normals/cri.html">2.1.4. 容器运行时(Container Runtime)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/normals/image-build.html">2.1.5. Image Build</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/normals/openstack.html">2.1.6. openstack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/normals/podman.html">2.1.7. podman</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/normals/skopeo.html">2.1.8. skopeo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/normals/tmp.html">2.1.9. 临时</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dockers/docker.html">2.2. Docker相关</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/dockers/normal.html">2.2.1. docker基本</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/normals/history.html">历史</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/normals/normal.html">基本</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/normals/mac.html">mac路径相关</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/normals/introduce.html">介绍</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/dockers/docker_hub.html">2.2.2. 常用Docker镜像</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/dockers/docker_Dockerfile.html">2.2.3. Dockerfile</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/Dockerfiles/normal.html">常用</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/Dockerfiles/param.html">Dockerfile命令说明 </a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/Dockerfiles/pub.html">常用的Docker镜像</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/Dockerfiles/entrypoint.html">ENTRYPOINT场景</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/Dockerfiles/multistage-build.html">多阶段构建</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/dockers/net.html">2.2.4. 网络相关</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/nets/normal.html">常用</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/nets/practice.html">实践</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/nets/cross-host.html">跨主机容器通信</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/nets/cross-container.html">容器间通信方式</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/nets/tmp.html">临时</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/dockers/docker_cmd.html">2.2.5. docker命令</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/0help.html">帮助</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/0topology.html">拓扑图</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/manages/config.html">docker config</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/manages/container.html">docker container</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/manages/image.html">docker image</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/manages/service.html">docker service</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/manages/network.html">docker network</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/manages/volume.html">docker volume</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/watchs/top.html">docker top</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/watchs/search.html">docker search</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/watchs/inspect.html">docker inspect</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/watchs/images.html">docker images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/watchs/history.html">docker history</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/containers/run.html">docker run</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/containers/exec.html">docker exec</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/containers/attach.html">docker attach</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/containers/logs.html">docker logs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/containers/port.html">docker port</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/containers/ps.html">docker ps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/containers/rm.html">docker rm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/containers/start.html">docker start</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/containers/stop.html">docker stop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/dockerimages/build.html">docker build</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/dockerimages/login.html">docker login</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/dockerimages/pull.html">docker pull</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/dockerimages/push.html">docker push</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/dockerimages/rmi.html">docker rmi</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/dockerimages/tag.html">docker tag命令</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/dockerimages/diff.html">docker diff命令</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/dockerimages/commit.html">docker commit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/dockerimages/import.html">docker import</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/dockerimages/export.html">docker export</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/dockerimages/save.html">docker save</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/dockerimages/load.html">docker load</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_cmds/cmds/cp.html">docker cp命令</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/dockers/gpu.html">2.2.6. GPU专用</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/gpus/normal.html">常用</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/gpus/question.html">常见问题</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/dockers/docker_compose.html">2.2.7. docker-compose命令</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_composes/0help.html">帮助</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_composes/0config.html">配置实例</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_composes/0install.html">安装与卸载</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_composes/0normal.html">常用</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_composes/profile.html">profiles 声明</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_composes/env.html">env环境变量</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_composes/compose_file.html">Compose 模板文件</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/docker_composes/question.html">常见问题</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/dockers/docker_machine.html">2.2.8. docker-machine命令</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/dockers/docker_swarm.html">2.2.9. Docker Swarm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/dockers/question.html">2.2.10. 常见问题</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/dockers/practice.html">2.2.11. docker实战</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/practices/registry.html">运行自己的Docker私有镜像仓库 Registry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/practices/%E6%97%B6%E5%8C%BA.html">时区</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/dockers/example.html">2.2.12. compose实例</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/examples/normal.html">Dockerfile文件实例</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../dockers/dockers/examples/examples.html">compose实例</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dockers/language.html">2.3. 云原生编程语言</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/languages/pulumi.html">2.3.1. Pulumi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/languages/ballerina.html">2.3.2. Ballerina</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../dockers/tool.html">2.4. 工具</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dockers/vm.html">2.5. 虚拟机</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/vms/virtualbox.html">2.5.1. VirtualBox</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/vms/vmware.html">2.5.2. VMware</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/vms/PD.html">2.5.3. Parallels Desktop</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../dockers/vms/vagrant.html">2.5.4. vagrant命令</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../../k8s.html">3. k8s相关</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../normal.html">3.1. kube基本</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../normals/install.html">3.1.1. 安装配置kubectl </a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/volume.html">3.1.2. 卷-磁盘挂载</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/concept.html">3.1.3. 定义</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/principle.html">3.1.4. 原理</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/cluster_testing.html">3.1.5. 集群测试</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/introduce.html">3.1.6. 介绍</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/svc_catalog.html">3.1.7. Catalog服务</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/export_port.html">3.1.8. 暴露端口的方式</a></li>
<li class="toctree-l3"><a class="reference internal" href="../normals/cAdvisor.html">3.1.9. cAdvisor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cmd.html">3.2. kubectl命令</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cmds/0help.html">3.2.1. 帮助</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/1create.html">3.2.2. kubectl create</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/1expose.html">3.2.3. kubectl expose</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/1run.html">3.2.4. kubect run</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/2explain.html">3.2.5. kubectl explain</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/2get.html">3.2.6. kubectl get</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/2delete.html">3.2.7. kubectl delete</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/2edit.html">3.2.8. kubectl edit</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/3scale.html">3.2.9. kubectl scale</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/3rollout.html">3.2.10. kubectl rollout</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/4cluster-info.html">3.2.11. kubectl cluster-info</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/4cordon.html">3.2.12. kubectl cordon</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/4drain.html">3.2.13. kubectl drain</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/4top.html">3.2.14. kubectl top</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/5describe.html">3.2.15. kubectl describe</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/5logs.html">3.2.16. kubectl logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/5port-forward.html">3.2.17. kubectl port-forward</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/5attach.html">3.2.18. kubectl attach</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/5exec.html">3.2.19. kubectl exec</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/5cp.html">3.2.20. kubectl cp</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/5proxy.html">3.2.21. kubectl proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/6apply.html">3.2.22. kubectl apply</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/6patch.html">3.2.23. kubectl patch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/6convert.html">3.2.24. kubectl convert</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/7label.html">3.2.25. kubectl label</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/7annotate.html">3.2.26. kubectl annotate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/8config.html">3.2.27. kubectl config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/8api-versions.html">3.2.28. kubectl api-versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/8version.html">3.2.29. kubectl version</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cmds/8api-resources.html">3.2.30. kubectl api-resources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../principle.html">3.3. k8s 原理</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../principles/normal.html">3.3.1. 整体</a></li>
<li class="toctree-l3"><a class="reference internal" href="../principles/api-server.html">3.3.2. API Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../principles/scheduler.html">3.3.3. scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../principles/client-go.html">3.3.4. client-go</a></li>
<li class="toctree-l3"><a class="reference internal" href="../principles/controller.html">3.3.5. controller manager</a></li>
<li class="toctree-l3"><a class="reference internal" href="../principles/operator.html">3.3.6. Operator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../yaml.html">3.4. kubectl yaml文件</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../yamls/Pod.yml.html">3.4.1. Pod.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/Deployment.yml.html">3.4.2. Deployment.yml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/Job.yml.html">3.4.3. Job.yml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/CronJob.yml.html">3.4.4. CronJob.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/Secret.yml.html">3.4.5. Secret.yml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/Service.yml.html">3.4.6. Service.yml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/Ingress.yml.html">3.4.7. Ingress.yml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/PersistentVolume.yml.html">3.4.8. PersistentVolume</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/StatefulSet.yml.html">3.4.9. StatefulSet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/DaemonSet.yml.html">3.4.10. DaemonSet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/ConfigMap.yml.html">3.4.11. ConfigMap.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/Role.yml.html">3.4.12. Role.yml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/NetworkPolicy.yml.html">3.4.13. NetworkPolicy.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/PodSecurityPolicy.yml.html">3.4.14. PodSecurityPolicy.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/LimitRange.yml.html">3.4.15. LimitRange.yml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/ResourceQuota.yml.html">3.4.16. ResourceQuota.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/ServiceAccount.yml.html">3.4.17. ServiceAccount.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/CustomResourceDefinition.yml.html">3.4.18. CustomResourceDefinition.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/StorageClasses.yml.html">3.4.19. StorageClasses.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/option_securityContext.html">3.4.20. securityContext选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/option_hostNetwork.html">3.4.21. hostNetwork选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/option_hostPort.html">3.4.22. hostPort选项</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yamls/option_lifecycle.html">3.4.23. lifecycle选项</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../practice.html">3.5. k8s实战</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">3.5.1. Kubernetes集群组建</a></li>
<li class="toctree-l3"><a class="reference internal" href="cluster_rebuild.html">3.5.2. Kubernetes集群重建</a></li>
<li class="toctree-l3"><a class="reference internal" href="cluster_node_upgrade.html">3.5.3. 集群结点升级</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_dashboard.html">3.5.4. dashboard服务安装</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin_ingress.html">3.5.5. Ingress(服务暴露) </a></li>
<li class="toctree-l3"><a class="reference internal" href="custom_API_objects.html">3.5.6. Defining custom API objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="git-sync.html">3.5.7. git-sync</a></li>
<li class="toctree-l3"><a class="reference internal" href="secret_dockerpull.html">3.5.8. 私有仓库拉取镜像 </a></li>
<li class="toctree-l3"><a class="reference internal" href="skill_docker_load.html">3.5.9. 小技巧-翻墙才能用的镜像使用方法</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../future.html">3.6. 未来</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tool.html">3.7. 工具</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tools/kt-connect.html">3.7.1. kt-connect工具</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/kubedog.html">3.7.2. kubedog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/kustomize.html">3.7.3. Kustomize</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/kubecm.html">3.7.4. kubecm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/kubewatch.html">3.7.5. kubewatch命令</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/kubeevent.html">3.7.6. kube-eventer</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/kubebuilder.html">3.7.7. kubebuilder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/kubeflow.html">3.7.8. kubeflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/k3s.html">3.7.9. k3s&amp;k3d</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/k9s.html">3.7.10. k9s</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/fleet.html">3.7.11. fleet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/ksonnet.html">3.7.12. ksonnet命令</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/icePanel.html">3.7.13. IcePanel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/ingress_controller.html">3.7.14. Ingress Controllers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tools/minikube.html">3.7.15. Minikube相关</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../helm.html">3.8. Helm Chart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history.html">3.9. 历史版本</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../historys/v1.14.html">3.9.1. 1.14版本</a></li>
<li class="toctree-l3"><a class="reference internal" href="../historys/v1.16.html">3.9.2. v1.16版本</a></li>
<li class="toctree-l3"><a class="reference internal" href="../historys/v1.18.html">3.9.3. 1.18版本</a></li>
<li class="toctree-l3"><a class="reference internal" href="../historys/v1.20.html">3.9.4. v1.20版本</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../question.html">3.10. 常见问题</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../prometheus.html">4. Prometheus</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../prometheus/normal.html">4.1. 常用</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../prometheus/normals/normal.html">4.1.1. 常用</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../prometheus/normals/history.html">4.1.2. 历史</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../prometheus/prometheus.html">4.2. prometheus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../prometheus/exporter.html">4.3. exporter </a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../prometheus/exporters/normal.html">4.3.1. 基本</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../prometheus/exporters/sample_exporter.html">4.3.2. 一个简单的 exporter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../prometheus/exporters/node_exporter.html">4.3.3. node_exporter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../prometheus/alertmanager.html">4.4. alertmanager </a></li>
<li class="toctree-l2"><a class="reference internal" href="../../prometheus/metrics.html">4.5. 指标</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../prometheus/metrics/kubernetes-apiservers.html">4.5.1. kubernetes-apiservers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../prometheus/metrics/kubernetes-cadvisor.html">4.5.2. kubernetes-cadvisor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../prometheus/metrics/kubernetes-nodes.html">4.5.3. kubernetes-nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../prometheus/metrics/kubernetes-pods.html">4.5.4. kubernetes-pods</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../prometheus/metrics/kubernetes-service-endpoints.html">4.5.5. kubernetes-service-endpoints</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../prometheus/thanos.html">4.6. Thanos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../prometheus/port.html">4.7. 端口 </a></li>
<li class="toctree-l2"><a class="reference internal" href="../../prometheus/practice.html">4.8. 实战</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../prometheus/practices/prometheus_cluster.html">4.8.1. Prometheus集群版</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../prometheus/promql.html">4.9. PromQL</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../servicemesh.html">5. 服务网格</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../servicemeshes/normal.html">5.1. 常用</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../servicemeshes/normals/history.html">5.1.1. 历史</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../servicemeshes/normals/concept.html">5.1.2. 定义</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../servicemeshes/istio.html">5.2. Istio</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../servicemeshes/istios/normal.html">5.2.1. 常用</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../servicemeshes/istios/normals/install.html">安装</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../servicemeshes/istios/normals/normal.html">常用</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">新溪-gordon</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../k8s.html"><span class="section-number">3. </span>k8s相关</a> &raquo;</li>
        
          <li><a href="../practice.html"><span class="section-number">3.5. </span>k8s实战</a> &raquo;</li>
        
      <li><span class="section-number">3.5.1. </span>Kubernetes集群组建</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/k8s/practices/cluster_setup.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            <nav id="local-table-of-contents" role="navigation" aria-labelledby="local-table-of-contents-title">
              <h4 id="local-table-of-contents-title">On This Page</h4>
              <ul>
<li><a class="reference internal" href="#">3.5.1. Kubernetes集群组建</a><ul>
<li><a class="reference internal" href="#id2">安装前准备</a></li>
<li><a class="reference internal" href="#docker-kubeadm">安装docker, kubeadm相关(全部结点)</a><ul>
<li><a class="reference internal" href="#centos">Centos</a></li>
<li><a class="reference internal" href="#ubuntu-1">Ubuntu </a></li>
<li><a class="reference internal" href="#debian-3">Debian </a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5">拉取需要的镜像(所有结点都要有这7个镜像)</a><ul>
<li><a class="reference internal" href="#id6">方法一</a></li>
<li><a class="reference internal" href="#id7">方法二</a></li>
<li><a class="reference internal" href="#id8">方法三</a></li>
</ul>
</li>
<li><a class="reference internal" href="#master">初始化集群(Master节点)</a></li>
<li><a class="reference internal" href="#id9">安装网络插件(Master节点)</a></li>
<li><a class="reference internal" href="#id13">加入集群(从结点)</a></li>
<li><a class="reference internal" href="#id14">遇到的问题</a></li>
<li><a class="reference internal" href="#id15">执行命令</a></li>
</ul>
</li>
</ul>

            </nav>
  <table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference external" href="/index.html">主页</a></p></td>
<td><p><a class="reference internal" href="../../genindex.html"><span class="std std-ref">索引</span></a></p></td>
<td><p><a class="reference internal" href="../../py-modindex.html"><span class="std std-ref">模块索引</span></a></p></td>
<td><p><a class="reference internal" href="../../search.html"><span class="std std-ref">搜索页面</span></a></p></td>
</tr>
</tbody>
</table>
<section id="kubernetes">
<h1><span class="section-number">3.5.1. </span>Kubernetes集群组建<a class="headerlink" href="#kubernetes" title="此标题的永久链接">¶</a></h1>
<section id="id2">
<h2>安装前准备<a class="headerlink" href="#id2" title="此标题的永久链接">¶</a></h2>
<p>1、关闭selinux:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1.1 临时方案
$ setenforce 0
1.2 永久禁用
修改文件 /etc/selinux/config
将SELINUX=enforcing更改为SELINUX=permissive
$ sed -i &#39;s/^SELINUX=.*/SELINUX=disabled/&#39; /etc/selinux/config
</pre></div>
</div>
<p>2、添加hosts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// 使各结点能有效联通:
$ cat &gt;&gt; /ets/hosts &lt;&lt;END
k8s01 1.1.1.62
k8s02 1.1.1.63
k8s03 1.1.1.64
END
</pre></div>
</div>
<p>3、配置代理:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="n">proxy</span><span class="o">=</span><span class="n">socks5</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168.190.161</span><span class="p">:</span><span class="mi">1080</span> <span class="o">&gt;&gt;/</span><span class="n">etc</span><span class="o">/</span><span class="n">yum</span><span class="o">.</span><span class="n">conf</span>
<span class="o">%</span> <span class="n">或使用阿里</span><span class="p">,</span><span class="mi">163</span><span class="n">镜像解决</span>
</pre></div>
</div>
<p>4、禁用防火墙:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ systemctl disable firewalld &amp;&amp; systemctl stop firewalld
</pre></div>
</div>
<p>5、禁用交换区:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ swapoff -a &amp;&amp; sed -i &#39;/ swap / s/^/#/&#39; c
</pre></div>
</div>
<p>6、结点要求:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>大于2G的内存
至少2个逻辑 CPU
节点之间网络互通
每个节点具有唯一的主机名、Mac 地址
开放相关端口
关闭swap（很重要）
</pre></div>
</div>
</section>
<section id="docker-kubeadm">
<h2>安装docker, kubeadm相关(全部结点)<a class="headerlink" href="#docker-kubeadm" title="此标题的永久链接">¶</a></h2>
<section id="centos">
<h3>Centos<a class="headerlink" href="#centos" title="此标题的永久链接">¶</a></h3>
<p>Yum仓库添加Kubernetes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// 增加文件/etc/yum.repos.d/kubernetes.repo
1. Google版
[kubernetes]
name=Kubernetes
baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg

2. 上面需要翻墙，可用国内阿里镜像
[kubernetes]
name=Kubernetes
baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg
        http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
</pre></div>
</div>
<p>安装docker, kubelet, kubeadm, kubectl和kubernetes-CNI:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ yum install -y docker kubelet kubeadm kubectl kubernetes-cni
$ systemctl enable docker &amp;&amp; systemctl start docker
$ systemctl enable kubelet &amp;&amp; systemctl start kubelet
// 启用NET.BRIDGE.BRIDGE-NF-CALL-IPTABLES内核选项
$ sysctl -w net.bridge.bridge-nf-call-iptables=1
$ echo &quot;net.bridge.bridge-nf-call-iptables=1&quot; &gt; /etc/sysctl.d/k8s.conf
</pre></div>
</div>
</section>
<section id="ubuntu-1">
<h3>Ubuntu <a class="footnote-reference brackets" href="#id18" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a><a class="headerlink" href="#ubuntu-1" title="此标题的永久链接">¶</a></h3>
<p>使用国内镜像源:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">vim</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">sources</span><span class="o">.</span><span class="n">list</span>
<span class="n">deb</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="o">.</span><span class="n">aliyun</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span> <span class="n">xenial</span> <span class="n">main</span> <span class="n">restricted</span>
<span class="n">deb</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="o">.</span><span class="n">aliyun</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span> <span class="n">xenial</span><span class="o">-</span><span class="n">updates</span> <span class="n">main</span> <span class="n">restricted</span>
<span class="n">deb</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="o">.</span><span class="n">aliyun</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span> <span class="n">xenial</span> <span class="n">universe</span>
<span class="n">deb</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="o">.</span><span class="n">aliyun</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span> <span class="n">xenial</span><span class="o">-</span><span class="n">updates</span> <span class="n">universe</span>
<span class="n">deb</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="o">.</span><span class="n">aliyun</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span> <span class="n">xenial</span> <span class="n">multiverse</span>
<span class="n">deb</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="o">.</span><span class="n">aliyun</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span> <span class="n">xenial</span><span class="o">-</span><span class="n">updates</span> <span class="n">multiverse</span>
<span class="n">deb</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="o">.</span><span class="n">aliyun</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">ubuntu</span><span class="o">/</span> <span class="n">xenial</span><span class="o">-</span><span class="n">backports</span> <span class="n">main</span> <span class="n">restricted</span> <span class="n">universe</span> <span class="n">multiverse</span>
<span class="n">deb</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">mirrors</span><span class="o">.</span><span class="n">aliyun</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">/</span><span class="n">apt</span> <span class="n">kubernetes</span><span class="o">-</span><span class="n">xenial</span> <span class="n">main</span>
</pre></div>
</div>
<p>安装 docker kubelet kubeadm kubectl:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ apt-get update
$ apt-get install apt-transport-https -y
$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -
$ apt-get install docker.io -y

$ sudo curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
$ apt-get update
//如果认证有问题 就加上--allow-unauthenticated
$ apt-get install -y kubelet kubeadm kubectl --allow-unauthenticated
</pre></div>
</div>
<p>镜像加速:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// 鉴于国内网络问题，后续拉取 Docker 镜像十分缓慢，我们可以需要配置加速器来解决
/etc/docker/daemon.json:
{
  &quot;registry-mirrors&quot;: [&quot;http://hub-mirror.c.163.com&quot;]
}
</pre></div>
</div>
</section>
<section id="debian-3">
<h3>Debian <a class="footnote-reference brackets" href="#id20" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a><a class="headerlink" href="#debian-3" title="此标题的永久链接">¶</a></h3>
<p>卸载旧版本:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get remove docker \
           docker-engine \
           docker.io
</pre></div>
</div>
<p>使用 APT 安装依赖:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get update

$ sudo apt-get install \
     apt-transport-https \
     ca-certificates \
     curl \
     gnupg2 \
     lsb-release \
     software-properties-common
</pre></div>
</div>
<p>添加软件源的 GPG 密钥:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># 1. 国内源
$ curl -fsSL https://mirrors.ustc.edu.cn/docker-ce/linux/debian/gpg | sudo apt-key add -

# 2. 官方源
# $ curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -
</pre></div>
</div>
<p>添加 Docker CE 软件源:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo add-apt-repository \
   &quot;deb [arch=amd64] https://mirrors.ustc.edu.cn/docker-ce/linux/debian \
   $(lsb_release -cs) \
   stable&quot;

# 官方源
# $ sudo add-apt-repository \
#    &quot;deb [arch=amd64] https://download.docker.com/linux/debian \
#    $(lsb_release -cs) \
#    stable&quot;
</pre></div>
</div>
<p>安装 Docker CE:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt-get update
$ sudo apt-get install docker-ce
</pre></div>
</div>
</section>
</section>
<section id="id5">
<h2>拉取需要的镜像(所有结点都要有这7个镜像)<a class="headerlink" href="#id5" title="此标题的永久链接">¶</a></h2>
<section id="id6">
<h3>方法一<a class="headerlink" href="#id6" title="此标题的永久链接">¶</a></h3>
<p>原始需要拉取的镜像:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker pull k8s.gcr.io/kube-apiserver:v1.15.0
$ docker pull k8s.gcr.io/kube-controller-manager:v1.15.0
$ docker pull k8s.gcr.io/kube-scheduler:v1.15.0
$ docker pull k8s.gcr.io/kube-proxy:v1.15.0
$ docker pull k8s.gcr.io/pause:3.1
$ docker pull k8s.gcr.io/etcd:3.3.10
$ docker pull k8s.gcr.io/coredns:1.3.1
</pre></div>
</div>
</section>
<section id="id7">
<h3>方法二<a class="headerlink" href="#id7" title="此标题的永久链接">¶</a></h3>
<p>gcr被墙，国内拉不到镜像，docker官方做了镜像备份:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker pull mirrorgooglecontainers/kube-apiserver:v1.15.0
$ docker pull mirrorgooglecontainers/kube-controller-manager:v1.15.0
$ docker pull mirrorgooglecontainers/kube-scheduler:v1.15.0
$ docker pull mirrorgooglecontainers/kube-proxy:v1.15.0
$ docker pull mirrorgooglecontainers/pause:3.1
$ docker pull mirrorgooglecontainers/etcd:3.3.10
$ docker pull coredns/coredns:1.3.1
</pre></div>
</div>
<p>打成k8s.gcr.io镜像:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker tag mirrorgooglecontainers/kube-apiserver:v1.15.0 k8s.gcr.io/kube-apiserver:v1.15.0
$ docker tag mirrorgooglecontainers/kube-controller-manager:v1.15.0 k8s.gcr.io/kube-controller-manager:v1.15.0
$ docker tag mirrorgooglecontainers/kube-scheduler:v1.15.0 k8s.gcr.io/kube-scheduler:v1.15.0
$ docker tag mirrorgooglecontainers/kube-proxy:v1.15.0 k8s.gcr.io/kube-proxy:v1.15.0
$ docker tag mirrorgooglecontainers/pause:3.1  k8s.gcr.io/pause:3.1
$ docker tag mirrorgooglecontainers/etcd:3.3.10 k8s.gcr.io/etcd:3.3.10
$ docker tag mirrorgooglecontainers/coredns:1.3.1 k8s.gcr.io/coredns:1.3.1
$ docker tag mirrorgooglecontainers/flannel:v0.11.0-amd64 quay.io/coreos/flannel:v0.11.0-amd64
</pre></div>
</div>
</section>
<section id="id8">
<h3>方法三<a class="headerlink" href="#id8" title="此标题的永久链接">¶</a></h3>
<p>直接使用本人在aliyun的镜像:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker pull registry.cn-hangzhou.aliyuncs.com/xxxxxxxx/kube-proxy:v1.15.0
$ docker pull registry.cn-hangzhou.aliyuncs.com/xxxxxxxx/kube-apiserver:v1.15.0
$ docker pull registry.cn-hangzhou.aliyuncs.com/xxxxxxxx/kube-controller-manager:v1.15.0
$ docker pull registry.cn-hangzhou.aliyuncs.com/xxxxxxxx/kube-scheduler:v1.15.0
$ docker pull registry.cn-hangzhou.aliyuncs.com/xxxxxxxx/coredns:1.3.1
$ docker pull registry.cn-hangzhou.aliyuncs.com/xxxxxxxx/etcd:3.3.10
$ docker pull registry.cn-hangzhou.aliyuncs.com/xxxxxxxx/pause:3.1
</pre></div>
</div>
<p>打成k8s.gcr.io镜像:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker tag registry.cn-hangzhou.aliyuncs.com/xxxxxxxx/kube-apiserver:v1.15.0 k8s.gcr.io/kube-apiserver:v1.15.0
$ docker tag registry.cn-hangzhou.aliyuncs.com/xxxxxxxx/kube-controller-manager:v1.15.0 k8s.gcr.io/kube-controller-manager:v1.15.0
$ docker tag registry.cn-hangzhou.aliyuncs.com/xxxxxxxx/kube-scheduler:v1.15.0 k8s.gcr.io/kube-scheduler:v1.15.0
$ docker tag registry.cn-hangzhou.aliyuncs.com/xxxxxxxx/kube-proxy:v1.15.0 k8s.gcr.io/kube-proxy:v1.15.0
$ docker tag registry.cn-hangzhou.aliyuncs.com/xxxxxxxx/pause:3.1  k8s.gcr.io/pause:3.1
$ docker tag registry.cn-hangzhou.aliyuncs.com/xxxxxxxx/etcd:3.3.10 k8s.gcr.io/etcd:3.3.10
$ docker tag registry.cn-hangzhou.aliyuncs.com/xxxxxxxx/coredns:1.3.1 k8s.gcr.io/coredns:1.3.1
</pre></div>
</div>
</section>
</section>
<section id="master">
<h2>初始化集群(Master节点)<a class="headerlink" href="#master" title="此标题的永久链接">¶</a></h2>
<p>执行:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubeadm init --kubernetes-version=v1.15.0

// 成功执行显示:
Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

You should now deploy a pod network to the cluster.
Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join 192.168.99.232:6443 --token psvou0.zy4lwqsrkh3kaf4g \
    --discovery-token-ca-cert-hash sha256:dfe3957e15a7c0a3afe8448391db836835824ef3592d8f9e2cbe0c8580f115dd
</pre></div>
</div>
<p>配置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir -p $HOME/.kube
$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
$ sudo chown $(id -u):$(id -g) $HOME/.kube/config
</pre></div>
</div>
<p>查看:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl -n kube-system get nodes
$ kubectl -n kube-system get po -o wide
</pre></div>
</div>
</section>
<section id="id9">
<h2>安装网络插件(Master节点)<a class="headerlink" href="#id9" title="此标题的永久链接">¶</a></h2>
<p>kube插件 <a class="footnote-reference brackets" href="#id19" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p>
<p>方法1: 执行安装Flannel(未实测) <a class="reference internal" href="#id17" id="id11"><span>[附录2]</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/v0.9.1/Documentation/kube-flannel.yml

$ kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/k8s-manifests/kube-flannel-rbac.yml
</pre></div>
</div>
<p>方法2: 执行安装Weave Net <a class="reference internal" href="#id16" id="id12"><span>[附录1]</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="s2">&quot;https://cloud.weave.works/k8s/net?k8s-version=$(kubectl  version | base64 | tr -d &#39;</span><span class="se">\n</span><span class="s2">&#39;)&quot;</span>

<span class="n">使用的资源文件详见附录</span>
</pre></div>
</div>
</section>
<section id="id13">
<h2>加入集群(从结点)<a class="headerlink" href="#id13" title="此标题的永久链接">¶</a></h2>
<p>加入集群:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// 初使化集群
$ kubeadm join 192.168.99.232:6443 --token psvou0.zy4lwqsrkh3kaf4g \
    --discovery-token-ca-cert-hash sha256:dfe3957e15a7c0a3afe8448391db836835824ef3592d8f9e2cbe0c8580f115dd
[preflight] Running pre-flight checks
[preflight] Reading configuration from the cluster...
[preflight] FYI: You can look at this config file with &#39;kubectl -n kube-system get cm kubeadm-config -oyaml&#39;
[kubelet-start] Downloading configuration for the kubelet from the &quot;kubelet-config-1.15&quot; ConfigMap in the kube-system namespace
[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;
[kubelet-start] Activating the kubelet service
[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...

This node has joined the cluster:
* Certificate signing request was sent to apiserver and a response was received.
* The Kubelet was informed of the new secure connection details.

Run &#39;kubectl get nodes&#39; on the control-plane to see this node join the cluster.
</pre></div>
</div>
<p>配置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir -p $HOME/.kube
$ sudo cp -i /etc/kubernetes/kubelet.conf $HOME/.kube/config
$ sudo chown $(id -u):$(id -g) $HOME/.kube/config
</pre></div>
</div>
<p>查看:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>// 在master节点执行 kubectl get nodes，可以检查是否成功加入
$ kubectl get nodes
$ kubectl -n kube-system get po -o wide  // 查看是否所有结点状态都变成Running
$ kubectl -n kube-system describe pod &lt;podName&gt;    // 查看pod详情
</pre></div>
</div>
</section>
<section id="id14">
<h2>遇到的问题<a class="headerlink" href="#id14" title="此标题的永久链接">¶</a></h2>
<ol class="arabic">
<li><p>翻墙问题:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="o">.</span> <span class="n">使用ssh</span> <span class="o">-</span><span class="n">D建立通道</span>
<span class="n">b</span><span class="o">.</span> <span class="n">export</span> <span class="n">all_proxy</span><span class="o">=</span><span class="n">socks5</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">1087</span>
<span class="n">很奇怪使用curl可以</span><span class="p">,</span><span class="n">kubeadm</span> <span class="n">init命令超时</span>
</pre></div>
</div>
</li>
<li><p>docker image在3个结点上都要有:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>2.1 kubeadm init成功后执行如下命令
$ kubectl -n kube-system get po
NAME                                 READY   STATUS              RESTARTS   AGE
coredns-5c98db65d4-59b6p             0/1     ContainerCreating   0          3h41m
coredns-5c98db65d4-phrv2             0/1     ContainerCreating   0          3h41m
etcd-master.k8s                      1/1     Running             0          3h40m
kube-apiserver-master.k8s            1/1     Running             0          3h40m
kube-controller-manager-master.k8s   1/1     Running             0          3h40m
kube-proxy-95g5f                     1/1     Running             0          3h41m
kube-proxy-sm6tp                     0/1     ContainerCreating   0          3h33m
kube-proxy-z9687                     0/1     ImagePullBackOff    0          3h34m
kube-scheduler-master.k8s            1/1     Running             0          3h40m
weave-net-bfj6g                      2/2     Running             0          3h26m
weave-net-d4f94                      1/2     CrashLoopBackOff    31         3h26m
weave-net-k7rtf                      0/2     ContainerCreating   0          3h26m

2.2 查看报错详情
$ kubectl -n kube-system  describe pod weave-net-d4f94
Events:
  Type     Reason                  Age                   From                Message
  ----     ------                  ----                  ----                -------
  Normal   Scheduled               66m                   default-scheduler   Successfully assigned kube-system/weave-net-8tlnl to node2.k8s
  Warning  FailedCreatePodSandBox  4m17s (x12 over 62m)  kubelet, node2.k8s  Failed create pod sandbox: rpc error: code = Unknown desc = failed pullin
g image &quot;k8s.gcr.io/pause:3.1&quot;: Get https://k8s.gcr.io/v1/_ping: dial tcp 74.125.203.82:443: i/o timeout
  Warning  FailedCreatePodSandBox  94s (x14 over 65m)    kubelet, node2.k8s  Failed create pod sandbox: rpc error: code = Unknown desc = failed pullin
g image &quot;k8s.gcr.io/pause:3.1&quot;: Get https://k8s.gcr.io/v1/_ping: dial tcp 108.177.97.82:443: i/o timeout
  Normal   Pulling                 81s                   kubelet, node2.k8s  Pulling image &quot;docker.io/weaveworks/weave-kube:2.5.2&quot;
  Normal   Pulled                  7s                    kubelet, node2.k8s  Successfully pulled image &quot;docker.io/weaveworks/weave-kube:2.5.2&quot;
  Normal   Created                 7s                    kubelet, node2.k8s  Created container weave
  Normal   Started                 7s                    kubelet, node2.k8s  Started container weave
  Normal   Pulling                 7s                    kubelet, node2.k8s  Pulling image &quot;docker.io/weaveworks/weave-npc:2.5.2&quot;

2.3 原因
CrashLoopBackOff大多数原因是因为没有image镜像
我当时就是master结点下载了镜像，在slave结点没有下载镜像
</pre></div>
</div>
</li>
<li><p>要指定ns:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubectl get ns
NAME              STATUS   AGE
default           Active   25h
kube-node-lease   Active   25h
kube-public       Active   25h
kube-system       Active   25h

$ kubectl get pod -n kube-system -o wide
$ kubectl get svc -n kube-system -o wide
</pre></div>
</div>
</li>
</ol>
</section>
<section id="id15">
<h2>执行命令<a class="headerlink" href="#id15" title="此标题的永久链接">¶</a></h2>
<p>$&gt; kubeadm join:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ kubeadm join 192.168.99.232:6443 --token psvou0.zy4lwqsrkh3kaf4g \
    --discovery-token-ca-cert-hash sha256:dfe3957e15a7c0a3afe8448391db836835824ef3592d8f9e2cbe0c8580f115dd
[preflight] Running pre-flight checks
[preflight] Reading configuration from the cluster...
[preflight] FYI: You can look at this config file with &#39;kubectl -n kube-system get cm kubeadm-config -oyaml&#39;
[kubelet-start] Downloading configuration for the kubelet from the &quot;kubelet-config-1.15&quot; ConfigMap in the kube-system namespace
[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;
[kubelet-start] Activating the kubelet service
[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...

This node has joined the cluster:
* Certificate signing request was sent to apiserver and a response was received.
* The Kubelet was informed of the new secure connection details.

Run &#39;kubectl get nodes&#39; on the control-plane to see this node join the cluster.
</pre></div>
</div>
<p>$&gt; kubeadm init:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[root@master ingress-nginx]# kubeadm init
W0716 16:06:00.272095   72486 version.go:98] could not fetch a Kubernetes version from the internet: unable to get URL &quot;https://dl.k8s.io/release/stable-1.txt&quot;: Get https://dl.k8s.io/release/stable-1.txt: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)
W0716 16:06:00.272464   72486 version.go:99] falling back to the local client version: v1.15.0
[init] Using Kubernetes version: v1.15.0
[preflight] Running pre-flight checks
[preflight] Pulling images required for setting up a Kubernetes cluster
[preflight] This might take a minute or two, depending on the speed of your internet connection
[preflight] You can also perform this action in beforehand using &#39;kubeadm config images pull&#39;
[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;
[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
[kubelet-start] Activating the kubelet service
[certs] Using certificateDir folder &quot;/etc/kubernetes/pki&quot;
[certs] Generating &quot;etcd/ca&quot; certificate and key
[certs] Generating &quot;etcd/server&quot; certificate and key
[certs] etcd/server serving cert is signed for DNS names [master.k8s localhost] and IPs [192.168.99.232 127.0.0.1 ::1]
[certs] Generating &quot;etcd/peer&quot; certificate and key
[certs] etcd/peer serving cert is signed for DNS names [master.k8s localhost] and IPs [192.168.99.232 127.0.0.1 ::1]
[certs] Generating &quot;etcd/healthcheck-client&quot; certificate and key
[certs] Generating &quot;apiserver-etcd-client&quot; certificate and key
[certs] Generating &quot;ca&quot; certificate and key
[certs] Generating &quot;apiserver-kubelet-client&quot; certificate and key
[certs] Generating &quot;apiserver&quot; certificate and key
[certs] apiserver serving cert is signed for DNS names [master.k8s kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.99.232]
[certs] Generating &quot;front-proxy-ca&quot; certificate and key
[certs] Generating &quot;front-proxy-client&quot; certificate and key
[certs] Generating &quot;sa&quot; key and public key
[kubeconfig] Using kubeconfig folder &quot;/etc/kubernetes&quot;
[kubeconfig] Writing &quot;admin.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;kubelet.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;controller-manager.conf&quot; kubeconfig file
[kubeconfig] Writing &quot;scheduler.conf&quot; kubeconfig file
[control-plane] Using manifest folder &quot;/etc/kubernetes/manifests&quot;
[control-plane] Creating static Pod manifest for &quot;kube-apiserver&quot;
[control-plane] Creating static Pod manifest for &quot;kube-controller-manager&quot;
[control-plane] Creating static Pod manifest for &quot;kube-scheduler&quot;
[etcd] Creating static Pod manifest for local etcd in &quot;/etc/kubernetes/manifests&quot;
[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory &quot;/etc/kubernetes/manifests&quot;. This can take up to 4m0s
[apiclient] All control plane components are healthy after 37.504192 seconds
[upload-config] Storing the configuration used in ConfigMap &quot;kubeadm-config&quot; in the &quot;kube-system&quot; Namespace
[kubelet] Creating a ConfigMap &quot;kubelet-config-1.15&quot; in namespace kube-system with the configuration for the kubelets in the cluster
[upload-certs] Skipping phase. Please see --upload-certs
[mark-control-plane] Marking the node master.k8s as control-plane by adding the label &quot;node-role.kubernetes.io/master=&#39;&#39;&quot;
[mark-control-plane] Marking the node master.k8s as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]
[bootstrap-token] Using token: ylzhq5.maygo3jvcpue9bi5
[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
[bootstrap-token] Creating the &quot;cluster-info&quot; ConfigMap in the &quot;kube-public&quot; namespace
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy

Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config

You should now deploy a pod network to the cluster.
Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
#192.168.18.128       master.k8s
#192.168.18.129       node1.k8s
#192.168.18.130       node2.k8s


192.168.99.232        master.k8s
192.168.99.205        node1.k8s
192.168.99.221        node2.k8s
...skipping...

Then you can join any number of worker nodes by running the following on each as root:

kubeadm join 192.168.99.232:6443 --token ylzhq5.maygo3jvcpue9bi5 \
    --discovery-token-ca-cert-hash sha256:e1015866efdd2aed6569453b6c9daac30df1dcfbc406c9c755804b33e0500bb1
</pre></div>
</div>
<div role="list" class="citation-list">
<div class="citation" id="id16" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id12">附录1</a><span class="fn-bracket">]</span></span>
<p>Weave Net资源文件net.yml:</p>
</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">List</span>
<span class="n">items</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">ServiceAccount</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
      <span class="n">annotations</span><span class="p">:</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">weave</span><span class="o">.</span><span class="n">works</span><span class="o">/</span><span class="n">launcher</span><span class="o">-</span><span class="n">info</span><span class="p">:</span> <span class="o">|-</span>
          <span class="p">{</span>
            <span class="s2">&quot;original-request&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/k8s/v1.10/net.yaml?k8s-version=Q2xpZW50IFZlcnNpb246IHZlcnNpb24uSW5mb3tNYWpvcjoiMSIsIE1pbm9yOiIxNSIsIEdpdFZlcnNpb246InYxLjE1LjAiLCBHaXRDb21taXQ6ImU4NDYyYjViNWRjMjU4NGZkY2QxOGU2YmNmZTlmMWU0ZDk3MGE1MjkiLCBHaXRUcmVlU3RhdGU6ImNsZWFuIiwgQnVpbGREYXRlOiIyMDE5LTA2LTE5VDE2OjQwOjE2WiIsIEdvVmVyc2lvbjoiZ28xLjEyLjUiLCBDb21waWxlcjoiZ2MiLCBQbGF0Zm9ybToibGludXgvYW1kNjQifQpTZXJ2ZXIgVmVyc2lvbjogdmVyc2lvbi5JbmZve01ham9yOiIxIiwgTWlub3I6IjE1IiwgR2l0VmVyc2lvbjoidjEuMTUuMCIsIEdpdENvbW1pdDoiZTg0NjJiNWI1ZGMyNTg0ZmRjZDE4ZTZiY2ZlOWYxZTRkOTcwYTUyOSIsIEdpdFRyZWVTdGF0ZToiY2xlYW4iLCBCdWlsZERhdGU6IjIwMTktMDYtMTlUMTY6MzI6MTRaIiwgR29WZXJzaW9uOiJnbzEuMTIuNSIsIENvbXBpbGVyOiJnYyIsIFBsYXRmb3JtOiJsaW51eC9hbWQ2NCJ9Cg==&quot;</span><span class="p">,</span>
              <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;Tue Jul 02 2019 07:31:51 GMT+0000 (UTC)&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;email-address&quot;</span><span class="p">:</span> <span class="s2">&quot;support@weave.works&quot;</span>
          <span class="p">}</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
      <span class="n">namespace</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span>
  <span class="o">-</span> <span class="n">apiVersion</span><span class="p">:</span> <span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1beta1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">ClusterRole</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
      <span class="n">annotations</span><span class="p">:</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">weave</span><span class="o">.</span><span class="n">works</span><span class="o">/</span><span class="n">launcher</span><span class="o">-</span><span class="n">info</span><span class="p">:</span> <span class="o">|-</span>
          <span class="p">{</span>
            <span class="s2">&quot;original-request&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/k8s/v1.10/net.yaml?k8s-version=Q2xpZW50IFZlcnNpb246IHZlcnNpb24uSW5mb3tNYWpvcjoiMSIsIE1pbm9yOiIxNSIsIEdpdFZlcnNpb246InYxLjE1LjAiLCBHaXRDb21taXQ6ImU4NDYyYjViNWRjMjU4NGZkY2QxOGU2YmNmZTlmMWU0ZDk3MGE1MjkiLCBHaXRUcmVlU3RhdGU6ImNsZWFuIiwgQnVpbGREYXRlOiIyMDE5LTA2LTE5VDE2OjQwOjE2WiIsIEdvVmVyc2lvbjoiZ28xLjEyLjUiLCBDb21waWxlcjoiZ2MiLCBQbGF0Zm9ybToibGludXgvYW1kNjQifQpTZXJ2ZXIgVmVyc2lvbjogdmVyc2lvbi5JbmZve01ham9yOiIxIiwgTWlub3I6IjE1IiwgR2l0VmVyc2lvbjoidjEuMTUuMCIsIEdpdENvbW1pdDoiZTg0NjJiNWI1ZGMyNTg0ZmRjZDE4ZTZiY2ZlOWYxZTRkOTcwYTUyOSIsIEdpdFRyZWVTdGF0ZToiY2xlYW4iLCBCdWlsZERhdGU6IjIwMTktMDYtMTlUMTY6MzI6MTRaIiwgR29WZXJzaW9uOiJnbzEuMTIuNSIsIENvbXBpbGVyOiJnYyIsIFBsYXRmb3JtOiJsaW51eC9hbWQ2NCJ9Cg==&quot;</span><span class="p">,</span>
              <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;Tue Jul 02 2019 07:31:51 GMT+0000 (UTC)&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;email-address&quot;</span><span class="p">:</span> <span class="s2">&quot;support@weave.works&quot;</span>
          <span class="p">}</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
    <span class="n">rules</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
          <span class="o">-</span> <span class="s1">&#39;&#39;</span>
        <span class="n">resources</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">pods</span>
          <span class="o">-</span> <span class="n">namespaces</span>
          <span class="o">-</span> <span class="n">nodes</span>
        <span class="n">verbs</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">get</span>
          <span class="o">-</span> <span class="nb">list</span>
          <span class="o">-</span> <span class="n">watch</span>
      <span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">networking</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span>
        <span class="n">resources</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">networkpolicies</span>
        <span class="n">verbs</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">get</span>
          <span class="o">-</span> <span class="nb">list</span>
          <span class="o">-</span> <span class="n">watch</span>
      <span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
          <span class="o">-</span> <span class="s1">&#39;&#39;</span>
        <span class="n">resources</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">nodes</span><span class="o">/</span><span class="n">status</span>
        <span class="n">verbs</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">patch</span>
          <span class="o">-</span> <span class="n">update</span>
  <span class="o">-</span> <span class="n">apiVersion</span><span class="p">:</span> <span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1beta1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">ClusterRoleBinding</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
      <span class="n">annotations</span><span class="p">:</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">weave</span><span class="o">.</span><span class="n">works</span><span class="o">/</span><span class="n">launcher</span><span class="o">-</span><span class="n">info</span><span class="p">:</span> <span class="o">|-</span>
          <span class="p">{</span>
            <span class="s2">&quot;original-request&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/k8s/v1.10/net.yaml?k8s-version=Q2xpZW50IFZlcnNpb246IHZlcnNpb24uSW5mb3tNYWpvcjoiMSIsIE1pbm9yOiIxNSIsIEdpdFZlcnNpb246InYxLjE1LjAiLCBHaXRDb21taXQ6ImU4NDYyYjViNWRjMjU4NGZkY2QxOGU2YmNmZTlmMWU0ZDk3MGE1MjkiLCBHaXRUcmVlU3RhdGU6ImNsZWFuIiwgQnVpbGREYXRlOiIyMDE5LTA2LTE5VDE2OjQwOjE2WiIsIEdvVmVyc2lvbjoiZ28xLjEyLjUiLCBDb21waWxlcjoiZ2MiLCBQbGF0Zm9ybToibGludXgvYW1kNjQifQpTZXJ2ZXIgVmVyc2lvbjogdmVyc2lvbi5JbmZve01ham9yOiIxIiwgTWlub3I6IjE1IiwgR2l0VmVyc2lvbjoidjEuMTUuMCIsIEdpdENvbW1pdDoiZTg0NjJiNWI1ZGMyNTg0ZmRjZDE4ZTZiY2ZlOWYxZTRkOTcwYTUyOSIsIEdpdFRyZWVTdGF0ZToiY2xlYW4iLCBCdWlsZERhdGU6IjIwMTktMDYtMTlUMTY6MzI6MTRaIiwgR29WZXJzaW9uOiJnbzEuMTIuNSIsIENvbXBpbGVyOiJnYyIsIFBsYXRmb3JtOiJsaW51eC9hbWQ2NCJ9Cg==&quot;</span><span class="p">,</span>
              <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;Tue Jul 02 2019 07:31:51 GMT+0000 (UTC)&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;email-address&quot;</span><span class="p">:</span> <span class="s2">&quot;support@weave.works&quot;</span>
          <span class="p">}</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
    <span class="n">roleRef</span><span class="p">:</span>
      <span class="n">kind</span><span class="p">:</span> <span class="n">ClusterRole</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
      <span class="n">apiGroup</span><span class="p">:</span> <span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span>
    <span class="n">subjects</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">kind</span><span class="p">:</span> <span class="n">ServiceAccount</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
        <span class="n">namespace</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span>
  <span class="o">-</span> <span class="n">apiVersion</span><span class="p">:</span> <span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1beta1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">Role</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
      <span class="n">annotations</span><span class="p">:</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">weave</span><span class="o">.</span><span class="n">works</span><span class="o">/</span><span class="n">launcher</span><span class="o">-</span><span class="n">info</span><span class="p">:</span> <span class="o">|-</span>
          <span class="p">{</span>
            <span class="s2">&quot;original-request&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/k8s/v1.10/net.yaml?k8s-version=Q2xpZW50IFZlcnNpb246IHZlcnNpb24uSW5mb3tNYWpvcjoiMSIsIE1pbm9yOiIxNSIsIEdpdFZlcnNpb246InYxLjE1LjAiLCBHaXRDb21taXQ6ImU4NDYyYjViNWRjMjU4NGZkY2QxOGU2YmNmZTlmMWU0ZDk3MGE1MjkiLCBHaXRUcmVlU3RhdGU6ImNsZWFuIiwgQnVpbGREYXRlOiIyMDE5LTA2LTE5VDE2OjQwOjE2WiIsIEdvVmVyc2lvbjoiZ28xLjEyLjUiLCBDb21waWxlcjoiZ2MiLCBQbGF0Zm9ybToibGludXgvYW1kNjQifQpTZXJ2ZXIgVmVyc2lvbjogdmVyc2lvbi5JbmZve01ham9yOiIxIiwgTWlub3I6IjE1IiwgR2l0VmVyc2lvbjoidjEuMTUuMCIsIEdpdENvbW1pdDoiZTg0NjJiNWI1ZGMyNTg0ZmRjZDE4ZTZiY2ZlOWYxZTRkOTcwYTUyOSIsIEdpdFRyZWVTdGF0ZToiY2xlYW4iLCBCdWlsZERhdGU6IjIwMTktMDYtMTlUMTY6MzI6MTRaIiwgR29WZXJzaW9uOiJnbzEuMTIuNSIsIENvbXBpbGVyOiJnYyIsIFBsYXRmb3JtOiJsaW51eC9hbWQ2NCJ9Cg==&quot;</span><span class="p">,</span>
              <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;Tue Jul 02 2019 07:31:51 GMT+0000 (UTC)&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;email-address&quot;</span><span class="p">:</span> <span class="s2">&quot;support@weave.works&quot;</span>
          <span class="p">}</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
      <span class="n">namespace</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span>
    <span class="n">rules</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
          <span class="o">-</span> <span class="s1">&#39;&#39;</span>
        <span class="n">resourceNames</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
        <span class="n">resources</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">configmaps</span>
        <span class="n">verbs</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">get</span>
          <span class="o">-</span> <span class="n">update</span>
      <span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
          <span class="o">-</span> <span class="s1">&#39;&#39;</span>
        <span class="n">resources</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">configmaps</span>
        <span class="n">verbs</span><span class="p">:</span>
          <span class="o">-</span> <span class="n">create</span>
  <span class="o">-</span> <span class="n">apiVersion</span><span class="p">:</span> <span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1beta1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">RoleBinding</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
      <span class="n">annotations</span><span class="p">:</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">weave</span><span class="o">.</span><span class="n">works</span><span class="o">/</span><span class="n">launcher</span><span class="o">-</span><span class="n">info</span><span class="p">:</span> <span class="o">|-</span>
          <span class="p">{</span>
            <span class="s2">&quot;original-request&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/k8s/v1.10/net.yaml?k8s-version=Q2xpZW50IFZlcnNpb246IHZlcnNpb24uSW5mb3tNYWpvcjoiMSIsIE1pbm9yOiIxNSIsIEdpdFZlcnNpb246InYxLjE1LjAiLCBHaXRDb21taXQ6ImU4NDYyYjViNWRjMjU4NGZkY2QxOGU2YmNmZTlmMWU0ZDk3MGE1MjkiLCBHaXRUcmVlU3RhdGU6ImNsZWFuIiwgQnVpbGREYXRlOiIyMDE5LTA2LTE5VDE2OjQwOjE2WiIsIEdvVmVyc2lvbjoiZ28xLjEyLjUiLCBDb21waWxlcjoiZ2MiLCBQbGF0Zm9ybToibGludXgvYW1kNjQifQpTZXJ2ZXIgVmVyc2lvbjogdmVyc2lvbi5JbmZve01ham9yOiIxIiwgTWlub3I6IjE1IiwgR2l0VmVyc2lvbjoidjEuMTUuMCIsIEdpdENvbW1pdDoiZTg0NjJiNWI1ZGMyNTg0ZmRjZDE4ZTZiY2ZlOWYxZTRkOTcwYTUyOSIsIEdpdFRyZWVTdGF0ZToiY2xlYW4iLCBCdWlsZERhdGU6IjIwMTktMDYtMTlUMTY6MzI6MTRaIiwgR29WZXJzaW9uOiJnbzEuMTIuNSIsIENvbXBpbGVyOiJnYyIsIFBsYXRmb3JtOiJsaW51eC9hbWQ2NCJ9Cg==&quot;</span><span class="p">,</span>
              <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;Tue Jul 02 2019 07:31:51 GMT+0000 (UTC)&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;email-address&quot;</span><span class="p">:</span> <span class="s2">&quot;support@weave.works&quot;</span>
          <span class="p">}</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
      <span class="n">namespace</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span>
    <span class="n">roleRef</span><span class="p">:</span>
      <span class="n">kind</span><span class="p">:</span> <span class="n">Role</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
      <span class="n">apiGroup</span><span class="p">:</span> <span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span>
    <span class="n">subjects</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">kind</span><span class="p">:</span> <span class="n">ServiceAccount</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
        <span class="n">namespace</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span>
  <span class="o">-</span> <span class="n">apiVersion</span><span class="p">:</span> <span class="n">extensions</span><span class="o">/</span><span class="n">v1beta1</span>
    <span class="n">kind</span><span class="p">:</span> <span class="n">DaemonSet</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
      <span class="n">annotations</span><span class="p">:</span>
        <span class="n">cloud</span><span class="o">.</span><span class="n">weave</span><span class="o">.</span><span class="n">works</span><span class="o">/</span><span class="n">launcher</span><span class="o">-</span><span class="n">info</span><span class="p">:</span> <span class="o">|-</span>
          <span class="p">{</span>
            <span class="s2">&quot;original-request&quot;</span><span class="p">:</span> <span class="p">{</span>
              <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;/k8s/v1.10/net.yaml?k8s-version=Q2xpZW50IFZlcnNpb246IHZlcnNpb24uSW5mb3tNYWpvcjoiMSIsIE1pbm9yOiIxNSIsIEdpdFZlcnNpb246InYxLjE1LjAiLCBHaXRDb21taXQ6ImU4NDYyYjViNWRjMjU4NGZkY2QxOGU2YmNmZTlmMWU0ZDk3MGE1MjkiLCBHaXRUcmVlU3RhdGU6ImNsZWFuIiwgQnVpbGREYXRlOiIyMDE5LTA2LTE5VDE2OjQwOjE2WiIsIEdvVmVyc2lvbjoiZ28xLjEyLjUiLCBDb21waWxlcjoiZ2MiLCBQbGF0Zm9ybToibGludXgvYW1kNjQifQpTZXJ2ZXIgVmVyc2lvbjogdmVyc2lvbi5JbmZve01ham9yOiIxIiwgTWlub3I6IjE1IiwgR2l0VmVyc2lvbjoidjEuMTUuMCIsIEdpdENvbW1pdDoiZTg0NjJiNWI1ZGMyNTg0ZmRjZDE4ZTZiY2ZlOWYxZTRkOTcwYTUyOSIsIEdpdFRyZWVTdGF0ZToiY2xlYW4iLCBCdWlsZERhdGU6IjIwMTktMDYtMTlUMTY6MzI6MTRaIiwgR29WZXJzaW9uOiJnbzEuMTIuNSIsIENvbXBpbGVyOiJnYyIsIFBsYXRmb3JtOiJsaW51eC9hbWQ2NCJ9Cg==&quot;</span><span class="p">,</span>
              <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="s2">&quot;Tue Jul 02 2019 07:31:51 GMT+0000 (UTC)&quot;</span>
            <span class="p">},</span>
            <span class="s2">&quot;email-address&quot;</span><span class="p">:</span> <span class="s2">&quot;support@weave.works&quot;</span>
          <span class="p">}</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
      <span class="n">namespace</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">minReadySeconds</span><span class="p">:</span> <span class="mi">5</span>
      <span class="n">template</span><span class="p">:</span>
        <span class="n">metadata</span><span class="p">:</span>
          <span class="n">labels</span><span class="p">:</span>
            <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
        <span class="n">spec</span><span class="p">:</span>
          <span class="n">containers</span><span class="p">:</span>
            <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">weave</span>
              <span class="n">command</span><span class="p">:</span>
                <span class="o">-</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">weave</span><span class="o">/</span><span class="n">launch</span><span class="o">.</span><span class="n">sh</span>
              <span class="n">env</span><span class="p">:</span>
                <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">HOSTNAME</span>
                  <span class="n">valueFrom</span><span class="p">:</span>
                    <span class="n">fieldRef</span><span class="p">:</span>
                      <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
                      <span class="n">fieldPath</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">nodeName</span>
              <span class="n">image</span><span class="p">:</span> <span class="s1">&#39;docker.io/weaveworks/weave-kube:2.5.2&#39;</span>
              <span class="n">readinessProbe</span><span class="p">:</span>
                <span class="n">httpGet</span><span class="p">:</span>
                  <span class="n">host</span><span class="p">:</span> <span class="mf">127.0.0.1</span>
                  <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">status</span>
                  <span class="n">port</span><span class="p">:</span> <span class="mi">6784</span>
              <span class="n">resources</span><span class="p">:</span>
                <span class="n">requests</span><span class="p">:</span>
                  <span class="n">cpu</span><span class="p">:</span> <span class="mi">10</span><span class="n">m</span>
              <span class="n">securityContext</span><span class="p">:</span>
                <span class="n">privileged</span><span class="p">:</span> <span class="n">true</span>
              <span class="n">volumeMounts</span><span class="p">:</span>
                <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">weavedb</span>
                  <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">weavedb</span>
                <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">cni</span><span class="o">-</span><span class="nb">bin</span>
                  <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">host</span><span class="o">/</span><span class="n">opt</span>
                <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">cni</span><span class="o">-</span><span class="n">bin2</span>
                  <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">host</span><span class="o">/</span><span class="n">home</span>
                <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">cni</span><span class="o">-</span><span class="n">conf</span>
                  <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">host</span><span class="o">/</span><span class="n">etc</span>
                <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">dbus</span>
                  <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">host</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">dbus</span>
                <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">lib</span><span class="o">-</span><span class="n">modules</span>
                  <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">modules</span>
                <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">xtables</span><span class="o">-</span><span class="n">lock</span>
                  <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">xtables</span><span class="o">.</span><span class="n">lock</span>
            <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">npc</span>
              <span class="n">env</span><span class="p">:</span>
                <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">HOSTNAME</span>
                  <span class="n">valueFrom</span><span class="p">:</span>
                    <span class="n">fieldRef</span><span class="p">:</span>
                      <span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
                      <span class="n">fieldPath</span><span class="p">:</span> <span class="n">spec</span><span class="o">.</span><span class="n">nodeName</span>
              <span class="n">image</span><span class="p">:</span> <span class="s1">&#39;docker.io/weaveworks/weave-npc:2.5.2&#39;</span>
              <span class="n">resources</span><span class="p">:</span>
                <span class="n">requests</span><span class="p">:</span>
                  <span class="n">cpu</span><span class="p">:</span> <span class="mi">10</span><span class="n">m</span>
              <span class="n">securityContext</span><span class="p">:</span>
                <span class="n">privileged</span><span class="p">:</span> <span class="n">true</span>
              <span class="n">volumeMounts</span><span class="p">:</span>
                <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">xtables</span><span class="o">-</span><span class="n">lock</span>
                  <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">xtables</span><span class="o">.</span><span class="n">lock</span>
          <span class="n">hostNetwork</span><span class="p">:</span> <span class="n">true</span>
          <span class="n">hostPID</span><span class="p">:</span> <span class="n">true</span>
          <span class="n">restartPolicy</span><span class="p">:</span> <span class="n">Always</span>
          <span class="n">securityContext</span><span class="p">:</span>
            <span class="n">seLinuxOptions</span><span class="p">:</span> <span class="p">{}</span>
          <span class="n">serviceAccountName</span><span class="p">:</span> <span class="n">weave</span><span class="o">-</span><span class="n">net</span>
          <span class="n">tolerations</span><span class="p">:</span>
            <span class="o">-</span> <span class="n">effect</span><span class="p">:</span> <span class="n">NoSchedule</span>
              <span class="n">operator</span><span class="p">:</span> <span class="n">Exists</span>
          <span class="n">volumes</span><span class="p">:</span>
            <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">weavedb</span>
              <span class="n">hostPath</span><span class="p">:</span>
                <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">weave</span>
            <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">cni</span><span class="o">-</span><span class="nb">bin</span>
              <span class="n">hostPath</span><span class="p">:</span>
                <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">opt</span>
            <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">cni</span><span class="o">-</span><span class="n">bin2</span>
              <span class="n">hostPath</span><span class="p">:</span>
                <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span>
            <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">cni</span><span class="o">-</span><span class="n">conf</span>
              <span class="n">hostPath</span><span class="p">:</span>
                <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span>
            <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">dbus</span>
              <span class="n">hostPath</span><span class="p">:</span>
                <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">dbus</span>
            <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">lib</span><span class="o">-</span><span class="n">modules</span>
              <span class="n">hostPath</span><span class="p">:</span>
                <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">modules</span>
            <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">xtables</span><span class="o">-</span><span class="n">lock</span>
              <span class="n">hostPath</span><span class="p">:</span>
                <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">xtables</span><span class="o">.</span><span class="n">lock</span>
                <span class="nb">type</span><span class="p">:</span> <span class="n">FileOrCreate</span>
      <span class="n">updateStrategy</span><span class="p">:</span>
        <span class="nb">type</span><span class="p">:</span> <span class="n">RollingUpdate</span>
</pre></div>
</div>
<div role="list" class="citation-list">
<div class="citation" id="id17" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id11">附录2</a><span class="fn-bracket">]</span></span>
<p>Flannel资源文件net_kube-flannel-rbac.yml和net_kube-flannel-rbac.yml:</p>
</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ClusterRole</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1beta1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">flannel</span>
<span class="n">rules</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
      <span class="o">-</span> <span class="s2">&quot;&quot;</span>
    <span class="n">resources</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">pods</span>
    <span class="n">verbs</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">get</span>
  <span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
      <span class="o">-</span> <span class="s2">&quot;&quot;</span>
    <span class="n">resources</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">nodes</span>
    <span class="n">verbs</span><span class="p">:</span>
      <span class="o">-</span> <span class="nb">list</span>
      <span class="o">-</span> <span class="n">watch</span>
  <span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
      <span class="o">-</span> <span class="s2">&quot;&quot;</span>
    <span class="n">resources</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">nodes</span><span class="o">/</span><span class="n">status</span>
    <span class="n">verbs</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">patch</span>
<span class="o">---</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ClusterRoleBinding</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1beta1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">flannel</span>
<span class="n">roleRef</span><span class="p">:</span>
  <span class="n">apiGroup</span><span class="p">:</span> <span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span>
  <span class="n">kind</span><span class="p">:</span> <span class="n">ClusterRole</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">flannel</span>
<span class="n">subjects</span><span class="p">:</span>
<span class="o">-</span> <span class="n">kind</span><span class="p">:</span> <span class="n">ServiceAccount</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">flannel</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span>
<span class="o">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ServiceAccount</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">flannel</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span>
<span class="o">---</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ConfigMap</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">flannel</span><span class="o">-</span><span class="n">cfg</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">tier</span><span class="p">:</span> <span class="n">node</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">flannel</span>
<span class="n">data</span><span class="p">:</span>
  <span class="n">cni</span><span class="o">-</span><span class="n">conf</span><span class="o">.</span><span class="n">json</span><span class="p">:</span> <span class="o">|</span>
    <span class="p">{</span>
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;cbr0&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;flannel&quot;</span><span class="p">,</span>
      <span class="s2">&quot;delegate&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;isDefaultGateway&quot;</span><span class="p">:</span> <span class="n">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="n">net</span><span class="o">-</span><span class="n">conf</span><span class="o">.</span><span class="n">json</span><span class="p">:</span> <span class="o">|</span>
    <span class="p">{</span>
      <span class="s2">&quot;Network&quot;</span><span class="p">:</span> <span class="s2">&quot;10.244.0.0/16&quot;</span><span class="p">,</span>
      <span class="s2">&quot;Backend&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="s2">&quot;vxlan&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="o">---</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">extensions</span><span class="o">/</span><span class="n">v1beta1</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">DaemonSet</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">flannel</span><span class="o">-</span><span class="n">ds</span>
  <span class="n">namespace</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span>
  <span class="n">labels</span><span class="p">:</span>
    <span class="n">tier</span><span class="p">:</span> <span class="n">node</span>
    <span class="n">app</span><span class="p">:</span> <span class="n">flannel</span>
<span class="n">spec</span><span class="p">:</span>
  <span class="n">template</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span>
      <span class="n">labels</span><span class="p">:</span>
        <span class="n">tier</span><span class="p">:</span> <span class="n">node</span>
        <span class="n">app</span><span class="p">:</span> <span class="n">flannel</span>
    <span class="n">spec</span><span class="p">:</span>
      <span class="n">hostNetwork</span><span class="p">:</span> <span class="n">true</span>
      <span class="n">nodeSelector</span><span class="p">:</span>
        <span class="n">beta</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">arch</span><span class="p">:</span> <span class="n">amd64</span>
      <span class="n">tolerations</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">key</span><span class="p">:</span> <span class="n">node</span><span class="o">-</span><span class="n">role</span><span class="o">.</span><span class="n">kubernetes</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">master</span>
        <span class="n">operator</span><span class="p">:</span> <span class="n">Exists</span>
        <span class="n">effect</span><span class="p">:</span> <span class="n">NoSchedule</span>
      <span class="n">serviceAccountName</span><span class="p">:</span> <span class="n">flannel</span>
      <span class="n">initContainers</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">install</span><span class="o">-</span><span class="n">cni</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">quay</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">coreos</span><span class="o">/</span><span class="n">flannel</span><span class="p">:</span><span class="n">v0</span><span class="mf">.9.1</span><span class="o">-</span><span class="n">amd64</span>
        <span class="n">command</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">cp</span>
        <span class="n">args</span><span class="p">:</span>
        <span class="o">-</span> <span class="o">-</span><span class="n">f</span>
        <span class="o">-</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">kube</span><span class="o">-</span><span class="n">flannel</span><span class="o">/</span><span class="n">cni</span><span class="o">-</span><span class="n">conf</span><span class="o">.</span><span class="n">json</span>
        <span class="o">-</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">cni</span><span class="o">/</span><span class="n">net</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="mi">10</span><span class="o">-</span><span class="n">flannel</span><span class="o">.</span><span class="n">conf</span>
        <span class="n">volumeMounts</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">cni</span>
          <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">cni</span><span class="o">/</span><span class="n">net</span><span class="o">.</span><span class="n">d</span>
        <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">flannel</span><span class="o">-</span><span class="n">cfg</span>
          <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">kube</span><span class="o">-</span><span class="n">flannel</span><span class="o">/</span>
      <span class="n">containers</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">flannel</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">quay</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">coreos</span><span class="o">/</span><span class="n">flannel</span><span class="p">:</span><span class="n">v0</span><span class="mf">.9.1</span><span class="o">-</span><span class="n">amd64</span>
        <span class="n">command</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;/opt/bin/flanneld&quot;</span><span class="p">,</span> <span class="s2">&quot;--ip-masq&quot;</span><span class="p">,</span> <span class="s2">&quot;--kube-subnet-mgr&quot;</span> <span class="p">]</span>
        <span class="n">securityContext</span><span class="p">:</span>
          <span class="n">privileged</span><span class="p">:</span> <span class="n">true</span>
        <span class="n">env</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">POD_NAME</span>
          <span class="n">valueFrom</span><span class="p">:</span>
            <span class="n">fieldRef</span><span class="p">:</span>
              <span class="n">fieldPath</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">name</span>
        <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">POD_NAMESPACE</span>
          <span class="n">valueFrom</span><span class="p">:</span>
            <span class="n">fieldRef</span><span class="p">:</span>
              <span class="n">fieldPath</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">namespace</span>
        <span class="n">volumeMounts</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">run</span>
          <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">run</span>
        <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">flannel</span><span class="o">-</span><span class="n">cfg</span>
          <span class="n">mountPath</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">kube</span><span class="o">-</span><span class="n">flannel</span><span class="o">/</span>
      <span class="n">volumes</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">run</span>
          <span class="n">hostPath</span><span class="p">:</span>
            <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">run</span>
        <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">cni</span>
          <span class="n">hostPath</span><span class="p">:</span>
            <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">cni</span><span class="o">/</span><span class="n">net</span><span class="o">.</span><span class="n">d</span>
        <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">flannel</span><span class="o">-</span><span class="n">cfg</span>
          <span class="n">configMap</span><span class="p">:</span>
            <span class="n">name</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">flannel</span><span class="o">-</span><span class="n">cfg</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the clusterrole and clusterrolebinding:</span>
<span class="c1"># $ kubectl create -f kube-flannel-rbac.yml</span>
<span class="c1"># Create the pod using the same namespace used by the flannel serviceaccount:</span>
<span class="c1"># $ kubectl create --namespace kube-system -f kube-flannel-legacy.yml</span>
<span class="o">---</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ClusterRole</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1beta1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">flannel</span>
<span class="n">rules</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
      <span class="o">-</span> <span class="s2">&quot;&quot;</span>
    <span class="n">resources</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">pods</span>
    <span class="n">verbs</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">get</span>
  <span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
      <span class="o">-</span> <span class="s2">&quot;&quot;</span>
    <span class="n">resources</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">nodes</span>
    <span class="n">verbs</span><span class="p">:</span>
      <span class="o">-</span> <span class="nb">list</span>
      <span class="o">-</span> <span class="n">watch</span>
  <span class="o">-</span> <span class="n">apiGroups</span><span class="p">:</span>
      <span class="o">-</span> <span class="s2">&quot;&quot;</span>
    <span class="n">resources</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">nodes</span><span class="o">/</span><span class="n">status</span>
    <span class="n">verbs</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">patch</span>
<span class="o">---</span>
<span class="n">kind</span><span class="p">:</span> <span class="n">ClusterRoleBinding</span>
<span class="n">apiVersion</span><span class="p">:</span> <span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">v1beta1</span>
<span class="n">metadata</span><span class="p">:</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">flannel</span>
<span class="n">roleRef</span><span class="p">:</span>
  <span class="n">apiGroup</span><span class="p">:</span> <span class="n">rbac</span><span class="o">.</span><span class="n">authorization</span><span class="o">.</span><span class="n">k8s</span><span class="o">.</span><span class="n">io</span>
  <span class="n">kind</span><span class="p">:</span> <span class="n">ClusterRole</span>
  <span class="n">name</span><span class="p">:</span> <span class="n">flannel</span>
<span class="n">subjects</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">kind</span><span class="p">:</span> <span class="n">ServiceAccount</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">flannel</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="n">kube</span><span class="o">-</span><span class="n">system</span>
</pre></div>
</div>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id18" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">1</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://blog.csdn.net/u013171997/article/details/93607025">https://blog.csdn.net/u013171997/article/details/93607025</a></p>
</aside>
<aside class="footnote brackets" id="id19" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">2</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="http://kuber-netes.io/docs/admin/addons/">http://kuber-netes.io/docs/admin/addons/</a></p>
</aside>
<aside class="footnote brackets" id="id20" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">3</a><span class="fn-bracket">]</span></span>
<p><a class="reference external" href="https://yeasy.gitbooks.io/docker_practice/install/debian.html">https://yeasy.gitbooks.io/docker_practice/install/debian.html</a></p>
</aside>
</aside>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference external" href="/index.html">主页</a></p></td>
<td><p><a class="reference internal" href="../../genindex.html"><span class="std std-ref">索引</span></a></p></td>
<td><p><a class="reference internal" href="../../py-modindex.html"><span class="std std-ref">模块索引</span></a></p></td>
<td><p><a class="reference internal" href="../../search.html"><span class="std std-ref">搜索页面</span></a></p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cluster_rebuild.html" class="btn btn-neutral float-right" title="3.5.2. Kubernetes集群重建" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../practice.html" class="btn btn-neutral" title="3.5. k8s实战" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>
  
  <div id="gitalk-container"></div>
  <div role="contentinfo">
    <p>
        &copy; Copyright 2010-2025, 新溪-gordon.

    </p>
  </div>
  <div>备案号 <a href="http://www.beian.miit.gov.cn">京ICP备16018553号</a></div><div>Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a></div>. 


</footer>

<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?042289284b8eb33866001347a3e0b129";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
</script>     
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'V2025.06',
            LANGUAGE:'zh-CN',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/sphinx_highlight.js"></script>
      <script type="text/javascript" src="../../_static/clipboard.min.js"></script>
      <script type="text/javascript" src="../../_static/copybutton.js"></script>
      <script type="text/javascript" src="../../_static/translations.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });


      // var gitalk = new Gitalk({
      //         clientID: '565177626b5d46427009',
      //         clientSecret: 'b2a36e67e1d2a73e43667f46d571c2624f8e1026',
      //         repo: 'knowledge',
      //         owner: 'zhaoweiguo',
      //         admin: ['zhaoweiguo'],
      //         id: location.pathname,      // Ensure uniqueness and length less than 50
      //         distractionFreeMode: false  // Facebook-like distraction free mode
      //       })
      // gitalk.render('gitalk-container')

  </script>


<script type="text/javascript" src="../../_static/js/table-of-contents-sidebar.js"></script>
<!-- <script type="text/javascript" src="https://table-of-contents-sidebar.github.io/table-of-contents-sidebar-lib/table-of-contents-sidebar.js"></script> -->
<script type="text/javascript">
    window.onload = function(e){
        TableOfContents.init({
            basePath: "https://table-of-contents-sidebar.github.io/table-of-contents-sidebar-lib/",
            querySelector: "body" // or other css querySelector
        });
    }
</script> 

</body>
</html>